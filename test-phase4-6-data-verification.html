<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4-6 ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»è¡¨ç¤ºæ¤œè¨¼ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #007bff;
        }
        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
        }
        .btn-phase4 { background: linear-gradient(45deg, #ff9800, #f57c00); }
        .btn-phase5 { background: linear-gradient(45deg, #9c27b0, #7b1fa2); }
        .btn-phase6 { background: linear-gradient(45deg, #4caf50, #2e7d32); }
        .btn-test { background: linear-gradient(45deg, #e91e63, #c2185b); }
        .btn-clear { background: linear-gradient(45deg, #6c757d, #495057); }
        
        .result {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #c62828;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85em;
        }
        .status-ok { background: #c8e6c9; color: #2e7d32; }
        .status-error { background: #ffcdd2; color: #c62828; }
        .status-warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ Phase 4-6 ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»è¡¨ç¤ºæ¤œè¨¼ãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="section">
            <h2>ğŸ“‹ æ¤œè¨¼æ¦‚è¦</h2>
            <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã¯Phase 4-6ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨˜éŒ²ãŒå®Ÿéš›ã«ä¿å­˜ãƒ»è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
            <ul>
                <li><strong>Phase 4:</strong> PerformanceTracker - ãƒ¬ãƒ¼ã‚¹æˆç¸¾è¿½è·¡ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ</li>
                <li><strong>Phase 5:</strong> CalibrationSystem - äºˆæ¸¬ç²¾åº¦æ ¡æ­£ãƒ‡ãƒ¼ã‚¿</li>
                <li><strong>Phase 6:</strong> KellyCapitalManager - ã‚±ãƒªãƒ¼åŸºæº–è³‡é‡‘ç®¡ç†ãƒ‡ãƒ¼ã‚¿</li>
            </ul>
        </div>

        <!-- Phase 4 æ¤œè¨¼ -->
        <div class="section">
            <h3 style="color: #ff9800;">ğŸ¯ Phase 4: PerformanceTracker æ¤œè¨¼</h3>
            <div class="grid">
                <button class="btn btn-phase4" onclick="checkPhase4Data()">ğŸ“Š ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ç¢ºèª</button>
                <button class="btn btn-test" onclick="createPhase4TestData()">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
                <button class="btn btn-phase4" onclick="showPhase4Stats()">ğŸ“ˆ çµ±è¨ˆè¡¨ç¤º</button>
                <button class="btn btn-clear" onclick="clearPhase4Data()">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            </div>
            <div id="phase4Results"></div>
        </div>

        <!-- Phase 5 æ¤œè¨¼ -->
        <div class="section">
            <h3 style="color: #9c27b0;">ğŸ”¬ Phase 5: CalibrationSystem æ¤œè¨¼</h3>
            <div class="grid">
                <button class="btn btn-phase5" onclick="checkPhase5Data()">ğŸ“Š ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ç¢ºèª</button>
                <button class="btn btn-test" onclick="createPhase5TestData()">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
                <button class="btn btn-phase5" onclick="showPhase5Report()">ğŸ“‹ ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º</button>
                <button class="btn btn-clear" onclick="clearPhase5Data()">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            </div>
            <div id="phase5Results"></div>
        </div>

        <!-- Phase 6 æ¤œè¨¼ -->
        <div class="section">
            <h3 style="color: #4caf50;">ğŸ’° Phase 6: KellyCapitalManager æ¤œè¨¼</h3>
            <div class="grid">
                <button class="btn btn-phase6" onclick="checkPhase6Data()">ğŸ“Š ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ç¢ºèª</button>
                <button class="btn btn-test" onclick="createPhase6TestData()">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
                <button class="btn btn-phase6" onclick="showPhase6Report()">ğŸ“‹ ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º</button>
                <button class="btn btn-clear" onclick="clearPhase6Data()">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            </div>
            <div id="phase6Results"></div>
        </div>

        <!-- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ¤œè¨¼ -->
        <div class="section">
            <h3>ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç·åˆæ¤œè¨¼</h3>
            <div class="grid">
                <button class="btn" onclick="checkAllLocalStorage()">ğŸ” å…¨ãƒ‡ãƒ¼ã‚¿ç¢ºèª</button>
                <button class="btn btn-test" onclick="createAllTestData()">ğŸ§ª å…¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
                <button class="btn" onclick="exportAllData()">ğŸ“¤ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearAllData()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            </div>
            <div id="storageResults"></div>
        </div>

        <!-- è¡¨ç¤ºæ©Ÿèƒ½æ¤œè¨¼ -->
        <div class="section">
            <h3>ğŸ“± HTMLè¡¨ç¤ºæ©Ÿèƒ½æ¤œè¨¼</h3>
            <div class="grid">
                <button class="btn" onclick="checkHtmlButtons()">ğŸ”˜ è¡¨ç¤ºãƒœã‚¿ãƒ³ç¢ºèª</button>
                <button class="btn" onclick="testDisplayFunctions()">ğŸ“º è¡¨ç¤ºé–¢æ•°ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="simulateUserFlow()">ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼æ¨¡æ“¬</button>
            </div>
            <div id="displayResults"></div>
        </div>
    </div>

    <!-- å¿…è¦ãªJavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="js/performanceTracker.js"></script>
    <script src="js/calibrationSystem.js"></script>
    <script src="js/kellyCapitalManager.js"></script>

    <script>
        // Phase 4: PerformanceTracker æ¤œè¨¼
        function checkPhase4Data() {
            const resultDiv = document.getElementById('phase4Results');
            try {
                const saved = localStorage.getItem('keiba_race_history');
                const strategyData = localStorage.getItem('keiba_strategy_performance');
                const monthlyData = localStorage.getItem('keiba_monthly_stats');
                
                let status = '<div class="result">';
                status += '=== Phase 4 PerformanceTracker ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ ===\n';
                
                if (saved) {
                    const history = JSON.parse(saved);
                    status += `âœ… ãƒ¬ãƒ¼ã‚¹å±¥æ­´: ${history.length}ä»¶\n`;
                    status += `ğŸ•’ æœ€æ–°ãƒ‡ãƒ¼ã‚¿: ${history.length > 0 ? new Date(history[history.length-1].date).toLocaleString() : 'ãªã—'}\n`;
                } else {
                    status += 'âŒ ãƒ¬ãƒ¼ã‚¹å±¥æ­´: ãƒ‡ãƒ¼ã‚¿ãªã—\n';
                }
                
                if (strategyData) {
                    const strategies = JSON.parse(strategyData);
                    status += `ğŸ“Š æˆ¦ç•¥ãƒ‡ãƒ¼ã‚¿: ${Object.keys(strategies).length}ç¨®é¡\n`;
                } else {
                    status += 'âŒ æˆ¦ç•¥ãƒ‡ãƒ¼ã‚¿: ãƒ‡ãƒ¼ã‚¿ãªã—\n';
                }
                
                if (monthlyData) {
                    const monthly = JSON.parse(monthlyData);
                    status += `ğŸ“… æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿: ${Object.keys(monthly).length}ãƒ¶æœˆåˆ†\n`;
                } else {
                    status += 'âŒ æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿: ãƒ‡ãƒ¼ã‚¿ãªã—\n';
                }
                
                status += '</div>';
                resultDiv.innerHTML = status;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function createPhase4TestData() {
            const resultDiv = document.getElementById('phase4Results');
            try {
                const tracker = new PerformanceTracker();
                
                // ãƒ†ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                const testRaces = [
                    {
                        name: 'ãƒ†ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¹1',
                        horses: [{number: 1}, {number: 2}, {number: 3}],
                        course: 'æ±äº¬'
                    },
                    {
                        name: 'ãƒ†ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¹2', 
                        horses: [{number: 4}, {number: 5}, {number: 6}],
                        course: 'äº¬éƒ½'
                    }
                ];
                
                testRaces.forEach((raceData, index) => {
                    const predictions = [
                        {horse: {number: 1}, score: 75, confidence: 0.8, estimatedOdds: 3.2},
                        {horse: {number: 2}, score: 68, confidence: 0.7, estimatedOdds: 4.1}
                    ];
                    
                    const bettingRecommendations = [
                        {type: 'place', horse: {number: 1}, amount: 1000, strategy: 'test'},
                        {type: 'place', horse: {number: 2}, amount: 800, strategy: 'test'}
                    ];
                    
                    const actualResults = {
                        finishing_order: {1: 1, 2: 3, 3: 5}, // 1ç•ªãŒ1ç€ã€2ç•ªãŒ3ç€
                        payouts: {
                            place: {1: 180, 2: 240}
                        }
                    };
                    
                    tracker.recordRaceResult(raceData, predictions, bettingRecommendations, actualResults);
                });
                
                resultDiv.innerHTML = '<div class="result">âœ… Phase 4ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ\n2ãƒ¬ãƒ¼ã‚¹åˆ†ã®ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™</div>';
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function showPhase4Stats() {
            const resultDiv = document.getElementById('phase4Results');
            try {
                const tracker = new PerformanceTracker();
                const stats = tracker.getOverallStats();
                
                let result = '<div class="result">';
                result += '=== Phase 4 çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆ ===\n';
                result += `ğŸ“Š ç·ãƒ¬ãƒ¼ã‚¹æ•°: ${stats.totalRaces}\n`;
                result += `ğŸ’° ç·æŠ•è³‡é¡: ${stats.totalInvestment?.toLocaleString() || 0}å††\n`;
                result += `ğŸ’µ ç·å›åé¡: ${stats.totalReturns?.toLocaleString() || 0}å††\n`;
                result += `ğŸ“ˆ ROI: ${stats.overallROI?.toFixed(2) || 0}%\n`;
                result += `ğŸ¯ å¹³å‡çš„ä¸­ç‡: ${stats.averageHitRate?.toFixed(1) || 0}%\n`;
                result += `ğŸ“Š åç›Šãƒ¬ãƒ¼ã‚¹ç‡: ${stats.profitableRaceRate?.toFixed(1) || 0}%\n`;
                result += '</div>';
                
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function clearPhase4Data() {
            localStorage.removeItem('keiba_race_history');
            localStorage.removeItem('keiba_strategy_performance');
            localStorage.removeItem('keiba_monthly_stats');
            document.getElementById('phase4Results').innerHTML = '<div class="result">âœ… Phase 4ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
        }

        // Phase 5: CalibrationSystem æ¤œè¨¼
        function checkPhase5Data() {
            const resultDiv = document.getElementById('phase5Results');
            try {
                const status = CalibrationSystem.debugDataStatus();
                
                let result = '<div class="result">';
                result += '=== Phase 5 CalibrationSystem ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ ===\n';
                result += `ğŸ“Š ãƒ‡ãƒ¼ã‚¿çŠ¶æ³: ${status.hasData ? 'âœ… ã‚ã‚Š' : 'âŒ ãªã—'}\n`;
                result += `ğŸ”¢ ç·ã‚µãƒ³ãƒ—ãƒ«æ•°: ${status.totalSamples || 0}\n`;
                result += `ğŸ“‹ ãƒã‚±ãƒƒãƒˆæ•°: ${status.buckets || 0}\n`;
                result += `ğŸ•’ æœ€çµ‚æ›´æ–°: ${status.lastUpdated || 'ãªã—'}\n`;
                
                if (status.error) {
                    result += `âŒ ã‚¨ãƒ©ãƒ¼: ${status.error}\n`;
                }
                
                result += '</div>';
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function createPhase5TestData() {
            const resultDiv = document.getElementById('phase5Results');
            try {
                const testSystem = CalibrationSystem.createTestData();
                resultDiv.innerHTML = '<div class="result">âœ… Phase 5ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ\n8ã‚µãƒ³ãƒ—ãƒ«ã®ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™</div>';
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function showPhase5Report() {
            const resultDiv = document.getElementById('phase5Results');
            try {
                const calibrationSystem = new CalibrationSystem();
                const report = calibrationSystem.generateCalibrationReport();
                
                let result = '<div class="result">';
                result += '=== Phase 5 ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒãƒ¼ãƒˆ ===\n';
                result += `ğŸ“Š ç·ã‚µãƒ³ãƒ—ãƒ«æ•°: ${report.overview.totalSamples}\n`;
                result += `ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ã®ã‚ã‚‹ãƒã‚±ãƒƒãƒˆæ•°: ${report.overview.bucketsWithData}\n`;
                result += `ğŸ•’ æœ€çµ‚æ›´æ–°: ${report.overview.lastUpdated}\n\n`;
                
                result += 'ğŸ“ˆ ãƒã‚±ãƒƒãƒˆåˆ†æ:\n';
                Object.keys(report.bucketAnalysis).forEach(bucket => {
                    const analysis = report.bucketAnalysis[bucket];
                    result += `  ${bucket}ç‚¹å°: ${analysis.samples}ã‚µãƒ³ãƒ—ãƒ«, çš„ä¸­ç‡${analysis.actualHitRate}\n`;
                });
                
                if (report.recommendations.length > 0) {
                    result += '\nğŸ’¡ æ¨å¥¨äº‹é …:\n';
                    report.recommendations.forEach(rec => {
                        result += `  ${rec}\n`;
                    });
                }
                
                result += '</div>';
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function clearPhase5Data() {
            if (typeof resetPhase5Data === 'function') {
                resetPhase5Data();
            } else {
                localStorage.removeItem('phase5_calibration_data');
            }
            document.getElementById('phase5Results').innerHTML = '<div class="result">âœ… Phase 5ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
        }

        // Phase 6: KellyCapitalManager æ¤œè¨¼
        function checkPhase6Data() {
            const resultDiv = document.getElementById('phase6Results');
            try {
                const report = checkKellyCapital();
                
                let result = '<div class="result">';
                result += '=== Phase 6 KellyCapitalManager ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ ===\n';
                result += `ğŸ’° ç¾åœ¨è³‡é‡‘: ${report.capitalStatus.currentCapital.toLocaleString()}å††\n`;
                result += `ğŸ“ˆ ç·åç›Šç‡: ${report.capitalStatus.totalReturnRate.toFixed(2)}%\n`;
                result += `ğŸ¯ ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: ${report.riskManagement.riskLevel}\n`;
                result += `ğŸ“Š æœ€å¤§æŠ•è³‡æ¯”ç‡: ${(report.riskManagement.maxBetRatio * 100)}%\n`;
                result += `ğŸ“‰ ç¾åœ¨ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³: ${(report.capitalStatus.currentDrawdown * 100).toFixed(2)}%\n`;
                result += `ğŸ”¢ ç›´è¿‘ãƒ¬ãƒ¼ã‚¹æ•°: ${report.recentPerformance.totalRaces}\n`;
                result += '</div>';
                
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function createPhase6TestData() {
            const resultDiv = document.getElementById('phase6Results');
            try {
                const manager = new KellyCapitalManager();
                
                // ãƒ†ã‚¹ãƒˆå–å¼•ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                const testRaces = [
                    {
                        bets: [{amount: 1000}, {amount: 1500}],
                        returns: [{amount: 1800}, {amount: 0}] // ä¸€éƒ¨çš„ä¸­
                    },
                    {
                        bets: [{amount: 2000}],
                        returns: [{amount: 3200}] // çš„ä¸­
                    },
                    {
                        bets: [{amount: 1200}, {amount: 800}],
                        returns: [{amount: 0}, {amount: 0}] // å…¨å¤–ã‚Œ
                    }
                ];
                
                testRaces.forEach(raceResult => {
                    manager.updateCapital(raceResult);
                });
                
                resultDiv.innerHTML = '<div class="result">âœ… Phase 6ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ\n3ãƒ¬ãƒ¼ã‚¹åˆ†ã®è³‡é‡‘ç®¡ç†ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™</div>';
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function showPhase6Report() {
            const resultDiv = document.getElementById('phase6Results');
            try {
                const manager = new KellyCapitalManager();
                const report = manager.generateCapitalReport();
                
                let result = '<div class="result">';
                result += '=== Phase 6 è³‡é‡‘ç®¡ç†ãƒ¬ãƒãƒ¼ãƒˆ ===\n';
                result += `ğŸ’° ç¾åœ¨è³‡é‡‘: ${report.capitalStatus.currentCapital.toLocaleString()}å††\n`;
                result += `ğŸ“Š åˆæœŸè³‡é‡‘: ${report.capitalStatus.initialCapital.toLocaleString()}å††\n`;
                result += `ğŸ“ˆ ç·åç›Š: ${report.capitalStatus.totalReturn.toLocaleString()}å††\n`;
                result += `ğŸ“Š åç›Šç‡: ${report.capitalStatus.totalReturnRate.toFixed(2)}%\n`;
                result += `ğŸ” æœ€é«˜è³‡é‡‘: ${report.capitalStatus.capitalPeak.toLocaleString()}å††\n`;
                result += `ğŸ“‰ ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³: ${(report.capitalStatus.currentDrawdown * 100).toFixed(2)}%\n`;
                result += `ğŸ¯ ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: ${report.riskManagement.riskLevel}\n`;
                result += `ğŸ”¢ ç›´è¿‘ãƒ¬ãƒ¼ã‚¹æ•°: ${report.recentPerformance.totalRaces}\n`;
                result += `ğŸ¯ ç›´è¿‘å‹ç‡: ${(report.recentPerformance.winRate * 100).toFixed(1)}%\n`;
                result += `ğŸ“Š ç›´è¿‘ROI: ${report.recentPerformance.averageROI.toFixed(2)}%\n`;
                
                if (report.recommendations.length > 0) {
                    result += '\nğŸ’¡ æ¨å¥¨äº‹é …:\n';
                    report.recommendations.forEach(rec => {
                        result += `  ${rec}\n`;
                    });
                }
                
                result += '</div>';
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function clearPhase6Data() {
            localStorage.removeItem('kelly_capital_data');
            document.getElementById('phase6Results').innerHTML = '<div class="result">âœ… Phase 6ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
        }

        // ç·åˆæ¤œè¨¼æ©Ÿèƒ½
        function checkAllLocalStorage() {
            const resultDiv = document.getElementById('storageResults');
            
            const keys = Object.keys(localStorage);
            const phaseKeys = keys.filter(key => 
                key.includes('keiba_') || 
                key.includes('phase5_') || 
                key.includes('kelly_') ||
                key.includes('learning_') ||
                key.includes('ai_recommendation')
            );
            
            let result = '<div class="result">';
            result += '=== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç·åˆç¢ºèª ===\n';
            result += `ğŸ“Š ç·ã‚­ãƒ¼æ•°: ${keys.length}\n`;
            result += `ğŸ¯ ç«¶é¦¬ã‚¢ãƒ—ãƒªé–¢é€£: ${phaseKeys.length}å€‹\n\n`;
            
            result += 'ğŸ“‹ ç«¶é¦¬ã‚¢ãƒ—ãƒªé–¢é€£ãƒ‡ãƒ¼ã‚¿:\n';
            phaseKeys.forEach(key => {
                const data = localStorage.getItem(key);
                const size = data ? (data.length / 1024).toFixed(2) : 0;
                result += `  ${key}: ${size}KB\n`;
            });
            
            result += '</div>';
            resultDiv.innerHTML = result;
        }

        function createAllTestData() {
            createPhase4TestData();
            createPhase5TestData();
            createPhase6TestData();
            
            document.getElementById('storageResults').innerHTML = '<div class="result">âœ… å…¨ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ</div>';
        }

        function exportAllData() {
            const data = {};
            const keys = Object.keys(localStorage);
            
            keys.forEach(key => {
                if (key.includes('keiba_') || key.includes('phase5_') || key.includes('kelly_')) {
                    data[key] = localStorage.getItem(key);
                }
            });
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `phase4-6-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            document.getElementById('storageResults').innerHTML = '<div class="result">âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ</div>';
        }

        function clearAllData() {
            if (confirm('å…¨ã¦ã®Phase 4-6ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                clearPhase4Data();
                clearPhase5Data();
                clearPhase6Data();
                
                document.getElementById('storageResults').innerHTML = '<div class="result">âœ… å…¨Phase 4-6ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';
            }
        }

        // HTMLè¡¨ç¤ºæ©Ÿèƒ½æ¤œè¨¼
        function checkHtmlButtons() {
            const resultDiv = document.getElementById('displayResults');
            
            // index.htmlã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹è¡¨ç¤ºé–¢æ•°ã‚’ç¢ºèª
            const functions = [
                'showPhase4DynamicStrategy',
                'showPhase5CalibrationReport', 
                'showPhase6KellyCapitalAnalysis',
                'checkPhase5Data',
                'checkKellyCapital',
                'simulateKellyBet'
            ];
            
            let result = '<div class="result">';
            result += '=== HTMLè¡¨ç¤ºæ©Ÿèƒ½ç¢ºèª ===\n';
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    result += `âœ… ${funcName}: å®šç¾©æ¸ˆã¿\n`;
                } else {
                    result += `âŒ ${funcName}: æœªå®šç¾©\n`;
                }
            });
            
            result += '</div>';
            resultDiv.innerHTML = result;
        }

        function testDisplayFunctions() {
            const resultDiv = document.getElementById('displayResults');
            
            let result = '<div class="result">';
            result += '=== è¡¨ç¤ºé–¢æ•°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ===\n';
            
            try {
                // Phase 5ãƒ‡ãƒãƒƒã‚°é–¢æ•°ãƒ†ã‚¹ãƒˆ
                if (typeof checkPhase5Data === 'function') {
                    checkPhase5Data();
                    result += 'âœ… checkPhase5Data: å®Ÿè¡ŒæˆåŠŸ\n';
                } else {
                    result += 'âŒ checkPhase5Data: é–¢æ•°ãªã—\n';
                }
                
                // Phase 6ãƒ‡ãƒãƒƒã‚°é–¢æ•°ãƒ†ã‚¹ãƒˆ
                if (typeof checkKellyCapital === 'function') {
                    const report = checkKellyCapital();
                    result += 'âœ… checkKellyCapital: å®Ÿè¡ŒæˆåŠŸ\n';
                } else {
                    result += 'âŒ checkKellyCapital: é–¢æ•°ãªã—\n';
                }
                
                // ã‚±ãƒªãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                if (typeof simulateKellyBet === 'function') {
                    const simulation = simulateKellyBet(0.4, 3.5, 1.4);
                    result += 'âœ… simulateKellyBet: å®Ÿè¡ŒæˆåŠŸ\n';
                } else {
                    result += 'âŒ simulateKellyBet: é–¢æ•°ãªã—\n';
                }
                
            } catch (error) {
                result += `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}\n`;
            }
            
            result += '</div>';
            resultDiv.innerHTML = result;
        }

        function simulateUserFlow() {
            const resultDiv = document.getElementById('displayResults');
            
            let result = '<div class="result">';
            result += '=== ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼æ¨¡æ“¬ãƒ†ã‚¹ãƒˆ ===\n';
            
            try {
                // 1. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
                createAllTestData();
                result += '1. âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†\n';
                
                // 2. ãƒ‡ãƒ¼ã‚¿ç¢ºèª
                checkAllLocalStorage();
                result += '2. âœ… ãƒ‡ãƒ¼ã‚¿ç¢ºèªå®Œäº†\n';
                
                // 3. å„ãƒ•ã‚§ãƒ¼ã‚ºã®çŠ¶æ³ç¢ºèª
                checkPhase4Data();
                checkPhase5Data();
                checkPhase6Data();
                result += '3. âœ… å„ãƒ•ã‚§ãƒ¼ã‚ºçŠ¶æ³ç¢ºèªå®Œäº†\n';
                
                // 4. ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤ºãƒ†ã‚¹ãƒˆ
                showPhase4Stats();
                showPhase5Report();
                showPhase6Report();
                result += '4. âœ… ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤ºãƒ†ã‚¹ãƒˆå®Œäº†\n';
                
                result += '\nğŸ‰ å…¨å·¥ç¨‹ãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸï¼\n';
                result += 'Phase 4-6ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ã¯æ­£å¸¸ã«æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚\n';
                
            } catch (error) {
                result += `âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}\n`;
            }
            
            result += '</div>';
            resultDiv.innerHTML = result;
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”¬ Phase 4-6 ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ„ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // åˆæœŸçŠ¶æ³ç¢ºèª
            setTimeout(() => {
                checkAllLocalStorage();
            }, 1000);
        });
    </script>
</body>
</html>