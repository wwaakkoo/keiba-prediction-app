<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨æ©Ÿèƒ½è©³ç´°èª¿æŸ»</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-section { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { transform: translateY(-1px); }
        .result-card { background: #f8f9fa; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .warning-card { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error-card { background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .info-card { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .pre-code { background: #f8f9fa; border: 1px solid #e9ecef; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.9em; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨æ©Ÿèƒ½è©³ç´°èª¿æŸ»</h1>
        
        <div class="test-section">
            <h2>ğŸ” ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª</h2>
            <p>å„ç¨®æ¡ä»¶ã§ã®3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <button class="btn" onclick="testBasicMarkedHorses()">ğŸ åŸºæœ¬å°ã¤ãé¦¬ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testMinimalMarkedHorses()">ğŸ“‰ æœ€å°å°æ•°ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testLowEfficiencyHorses()">âš¡ ä½åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testHighEfficiencyHorses()">ğŸš€ é«˜åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testLearningThresholds()">ğŸ§  å­¦ç¿’é–¾å€¤ç¢ºèª</button>
                <button class="btn" onclick="testRealWorldScenario()">ğŸŒ ç¾å®Ÿçš„ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ</button>
            </div>
            
            <div id="testResults"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š åŠ¹ç‡è¨ˆç®—è©³ç´°</h2>
            <div id="efficiencyDetails"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ å­¦ç¿’é–¾å€¤è¨­å®š</h2>
            <div id="thresholdSettings"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”¬ æ¨å¥¨æ¡ä»¶åˆ†æ</h2>
            <div id="conditionAnalysis"></div>
        </div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ -->
    <script src="../js/config.js"></script>
    <script src="../js/learningSystem.js"></script>
    <script src="../js/predictionEngine.js"></script>
    <script src="../js/bettingRecommender.js"></script>
    <script src="../js/reliabilityFilter.js"></script>
    <script src="../js/hitCriteriaSystem.js"></script>
    <script src="../js/dynamicRecommendationAdjuster.js"></script>

    <script>
        // ãƒ†ã‚¹ãƒˆé¦¬ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateTestHorses(scenario) {
            const horses = [];
            
            switch(scenario) {
                case 'basic':
                    horses.push(
                        { name: 'æœ¬å‘½é¦¬', odds: 2.5, winProbability: 25, placeProbability: 60 },
                        { name: 'å¯¾æŠ—é¦¬', odds: 4.0, winProbability: 15, placeProbability: 45 },
                        { name: 'å˜ç©´é¦¬', odds: 8.0, winProbability: 8, placeProbability: 35 },
                        { name: 'é€£è¤‡é¦¬', odds: 12.0, winProbability: 5, placeProbability: 35 },
                        { name: 'äººæ°—è–„é¦¬', odds: 25.0, winProbability: 2, placeProbability: 15 }
                    );
                    break;
                case 'minimal':
                    horses.push(
                        { name: 'æœ¬å‘½é¦¬', odds: 2.0, winProbability: 30, placeProbability: 65 },
                        { name: 'å¯¾æŠ—é¦¬', odds: 5.0, winProbability: 12, placeProbability: 40 },
                        { name: 'ç©´é¦¬', odds: 20.0, winProbability: 3, placeProbability: 20 }
                    );
                    break;
                case 'low_efficiency':
                    horses.push(
                        { name: 'äººæ°—é¦¬A', odds: 1.8, winProbability: 35, placeProbability: 70 },
                        { name: 'äººæ°—é¦¬B', odds: 2.2, winProbability: 25, placeProbability: 60 },
                        { name: 'äººæ°—é¦¬C', odds: 2.8, winProbability: 20, placeProbability: 55 },
                        { name: 'ä¸­äººæ°—é¦¬', odds: 6.0, winProbability: 10, placeProbability: 35 }
                    );
                    break;
                case 'high_efficiency':
                    horses.push(
                        { name: 'ç©´é¦¬A', odds: 15.0, winProbability: 8, placeProbability: 40 },
                        { name: 'ç©´é¦¬B', odds: 20.0, winProbability: 6, placeProbability: 35 },
                        { name: 'ç©´é¦¬C', odds: 25.0, winProbability: 4, placeProbability: 30 },
                        { name: 'å¤§ç©´é¦¬', odds: 40.0, winProbability: 2, placeProbability: 20 }
                    );
                    break;
                case 'realistic':
                    horses.push(
                        { name: 'æœ¬å‘½é¦¬', odds: 3.2, winProbability: 18, placeProbability: 50 },
                        { name: 'å¯¾æŠ—é¦¬', odds: 5.8, winProbability: 12, placeProbability: 42 },
                        { name: 'å˜ç©´é¦¬', odds: 9.5, winProbability: 7, placeProbability: 38 },
                        { name: 'é€£è¤‡é¦¬', odds: 15.2, winProbability: 4, placeProbability: 32 },
                        { name: 'ä¸­ç©´é¦¬', odds: 22.0, winProbability: 3, placeProbability: 25 }
                    );
                    break;
            }
            
            return horses.map((horse, index) => ({
                ...horse,
                number: index + 1,
                age: Math.floor(Math.random() * 4) + 3,
                weight: Math.floor(Math.random() * 60) + 440,
                jockey: `é¨æ‰‹${index + 1}`,
                winExpectedValue: (horse.winProbability / 100) * horse.odds - 1,
                placeExpectedValue: (horse.placeProbability / 100) * (horse.odds * 0.3) - 1
            }));
        }
        
        // åŸºæœ¬å°ã¤ãé¦¬ãƒ†ã‚¹ãƒˆ
        function testBasicMarkedHorses() {
            console.log('ğŸ åŸºæœ¬å°ã¤ãé¦¬ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const results = document.getElementById('testResults');
            
            const horses = generateTestHorses('basic');
            console.log('ãƒ†ã‚¹ãƒˆé¦¬ãƒ‡ãƒ¼ã‚¿:', horses);
            
            // å°åˆ†é¡ã‚’ãƒ†ã‚¹ãƒˆ
            const marks = BettingRecommender.classifyHorses(horses, 
                [...horses].sort((a, b) => b.winProbability - a.winProbability),
                [...horses].sort((a, b) => b.winExpectedValue - a.winExpectedValue)
            );
            
            console.log('å°åˆ†é¡çµæœ:', marks);
            
            // 3é€£è¤‡æ¨å¥¨ç”Ÿæˆ
            const tripleBoxRecs = BettingRecommender.generateTripleBoxRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            // 3é€£å˜æ¨å¥¨ç”Ÿæˆ
            const tripleExactRecs = BettingRecommender.generateTripleExactRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            // å­¦ç¿’é–¾å€¤å–å¾—
            const thresholds = LearningSystem.getComplexBettingThresholds();
            
            results.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ åŸºæœ¬å°ã¤ãé¦¬ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>å°ã¤ãé¦¬æ•°:</strong> ${Object.values(marks).filter(m => m).length}é ­</p>
                    <p><strong>å°åˆ†é¡:</strong></p>
                    <ul>
                        ${marks.honmei ? `<li>â— æœ¬å‘½: ${marks.honmei.name} (å‹ç‡${marks.honmei.winProbability}%)</li>` : ''}
                        ${marks.taikou ? `<li>â—‹ å¯¾æŠ—: ${marks.taikou.name} (å‹ç‡${marks.taikou.winProbability}%)</li>` : ''}
                        ${marks.tanana ? `<li>â–² å˜ç©´: ${marks.tanana.name} (å‹ç‡${marks.tanana.winProbability}%)</li>` : ''}
                        ${marks.renpuku ? `<li>â–³ é€£è¤‡: ${marks.renpuku.name} (å‹ç‡${marks.renpuku.winProbability}%)</li>` : ''}
                    </ul>
                    <p><strong>3é€£è¤‡æ¨å¥¨æ•°:</strong> ${tripleBoxRecs.length}ä»¶</p>
                    <p><strong>3é€£å˜æ¨å¥¨æ•°:</strong> ${tripleExactRecs.length}ä»¶</p>
                    <p><strong>å­¦ç¿’é–¾å€¤:</strong> 3é€£è¤‡ãƒ¡ã‚¤ãƒ³${thresholds.tripleBox.main}, 3é€£å˜ãƒ¡ã‚¤ãƒ³${thresholds.tripleExact.main}</p>
                </div>
                
                ${tripleBoxRecs.length > 0 ? `
                <div class="info-card">
                    <h4>ğŸ“Š 3é€£è¤‡æ¨å¥¨è©³ç´°</h4>
                    ${tripleBoxRecs.map(rec => `
                        <div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>${rec.type}:</strong> ${rec.horse}<br>
                            <strong>åŠ¹ç‡:</strong> ${rec.efficiency.toFixed(3)} (é–¾å€¤: ${rec.type === 'ãƒ¡ã‚¤ãƒ³' ? thresholds.tripleBox.main : thresholds.tripleBox.formation})<br>
                            <strong>çš„ä¸­ç‡:</strong> ${rec.probability}<br>
                            <strong>æ¨å®šé…å½“:</strong> ${rec.odds}
                        </div>
                    `).join('')}
                </div>
                ` : '<div class="warning-card"><h4>âš ï¸ 3é€£è¤‡æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</h4></div>'}
                
                ${tripleExactRecs.length > 0 ? `
                <div class="info-card">
                    <h4>ğŸ“Š 3é€£å˜æ¨å¥¨è©³ç´°</h4>
                    ${tripleExactRecs.map(rec => `
                        <div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>${rec.type}:</strong> ${rec.horse}<br>
                            <strong>åŠ¹ç‡:</strong> ${rec.efficiency.toFixed(3)} (é–¾å€¤: ${rec.type === 'è»¸æµã—' ? thresholds.tripleExact.main : thresholds.tripleExact.formation})<br>
                            <strong>çš„ä¸­ç‡:</strong> ${rec.probability}<br>
                            <strong>æ¨å®šé…å½“:</strong> ${rec.odds}
                        </div>
                    `).join('')}
                </div>
                ` : '<div class="warning-card"><h4>âš ï¸ 3é€£å˜æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</h4></div>'}
            `;
            
            // åŠ¹ç‡è¨ˆç®—è©³ç´°ã‚’è¡¨ç¤º
            displayEfficiencyDetails(marks, horses);
        }
        
        // æœ€å°å°æ•°ãƒ†ã‚¹ãƒˆ
        function testMinimalMarkedHorses() {
            console.log('ğŸ“‰ æœ€å°å°æ•°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const results = document.getElementById('testResults');
            
            const horses = generateTestHorses('minimal');
            
            const marks = BettingRecommender.classifyHorses(horses, 
                [...horses].sort((a, b) => b.winProbability - a.winProbability),
                [...horses].sort((a, b) => b.winExpectedValue - a.winExpectedValue)
            );
            
            const markedCount = Object.values(marks).filter(m => m).length;
            
            const tripleBoxRecs = BettingRecommender.generateTripleBoxRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            const tripleExactRecs = BettingRecommender.generateTripleExactRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            results.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ“‰ æœ€å°å°æ•°ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>å°ã¤ãé¦¬æ•°:</strong> ${markedCount}é ­ (å¿…è¦: 3é ­ä»¥ä¸Š)</p>
                    <p><strong>3é€£è¤‡æ¨å¥¨æ•°:</strong> ${tripleBoxRecs.length}ä»¶</p>
                    <p><strong>3é€£å˜æ¨å¥¨æ•°:</strong> ${tripleExactRecs.length}ä»¶</p>
                    ${markedCount < 3 ? '<p style="color: #dc3545;"><strong>âš ï¸ å°ã¤ãé¦¬ãŒ3é ­æœªæº€ã®ãŸã‚æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“</strong></p>' : ''}
                </div>
            `;
        }
        
        // ä½åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆ
        function testLowEfficiencyHorses() {
            console.log('âš¡ ä½åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const results = document.getElementById('testResults');
            
            const horses = generateTestHorses('low_efficiency');
            
            const marks = BettingRecommender.classifyHorses(horses, 
                [...horses].sort((a, b) => b.winProbability - a.winProbability),
                [...horses].sort((a, b) => b.winExpectedValue - a.winExpectedValue)
            );
            
            const tripleBoxRecs = BettingRecommender.generateTripleBoxRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            const tripleExactRecs = BettingRecommender.generateTripleExactRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            // åŠ¹ç‡è¨ˆç®—
            const markedHorses = Object.values(marks).filter(m => m).slice(0, 3);
            const efficiency = markedHorses.length === 3 ? 
                BettingRecommender.calculateTripleBoxExpectedValue(markedHorses, horses) : 
                { efficiency: 0 };
            
            const thresholds = LearningSystem.getComplexBettingThresholds();
            
            results.innerHTML = `
                <div class="result-card">
                    <h4>âš¡ ä½åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>å°ã¤ãé¦¬æ•°:</strong> ${Object.values(marks).filter(m => m).length}é ­</p>
                    <p><strong>è¨ˆç®—ã•ã‚ŒãŸåŠ¹ç‡:</strong> ${efficiency.efficiency.toFixed(3)}</p>
                    <p><strong>å¿…è¦ãªåŠ¹ç‡é–¾å€¤:</strong> ${thresholds.tripleBox.main}</p>
                    <p><strong>3é€£è¤‡æ¨å¥¨æ•°:</strong> ${tripleBoxRecs.length}ä»¶</p>
                    <p><strong>3é€£å˜æ¨å¥¨æ•°:</strong> ${tripleExactRecs.length}ä»¶</p>
                    ${efficiency.efficiency < thresholds.tripleBox.main ? '<p style="color: #dc3545;"><strong>âš ï¸ åŠ¹ç‡ãŒé–¾å€¤ã‚’ä¸‹å›ã‚‹ãŸã‚æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“</strong></p>' : ''}
                </div>
            `;
        }
        
        // é«˜åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆ
        function testHighEfficiencyHorses() {
            console.log('ğŸš€ é«˜åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const results = document.getElementById('testResults');
            
            const horses = generateTestHorses('high_efficiency');
            
            const marks = BettingRecommender.classifyHorses(horses, 
                [...horses].sort((a, b) => b.winProbability - a.winProbability),
                [...horses].sort((a, b) => b.winExpectedValue - a.winExpectedValue)
            );
            
            const tripleBoxRecs = BettingRecommender.generateTripleBoxRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            const tripleExactRecs = BettingRecommender.generateTripleExactRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            // åŠ¹ç‡è¨ˆç®—
            const markedHorses = Object.values(marks).filter(m => m).slice(0, 3);
            const efficiency = markedHorses.length === 3 ? 
                BettingRecommender.calculateTripleBoxExpectedValue(markedHorses, horses) : 
                { efficiency: 0 };
            
            const thresholds = LearningSystem.getComplexBettingThresholds();
            
            results.innerHTML = `
                <div class="result-card">
                    <h4>ğŸš€ é«˜åŠ¹ç‡é¦¬ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>å°ã¤ãé¦¬æ•°:</strong> ${Object.values(marks).filter(m => m).length}é ­</p>
                    <p><strong>è¨ˆç®—ã•ã‚ŒãŸåŠ¹ç‡:</strong> ${efficiency.efficiency.toFixed(3)}</p>
                    <p><strong>å¿…è¦ãªåŠ¹ç‡é–¾å€¤:</strong> ${thresholds.tripleBox.main}</p>
                    <p><strong>3é€£è¤‡æ¨å¥¨æ•°:</strong> ${tripleBoxRecs.length}ä»¶</p>
                    <p><strong>3é€£å˜æ¨å¥¨æ•°:</strong> ${tripleExactRecs.length}ä»¶</p>
                    ${efficiency.efficiency >= thresholds.tripleBox.main ? '<p style="color: #28a745;"><strong>âœ… åŠ¹ç‡ãŒé–¾å€¤ã‚’ä¸Šå›ã‚‹ãŸã‚æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã™</strong></p>' : ''}
                </div>
            `;
        }
        
        // å­¦ç¿’é–¾å€¤ç¢ºèª
        function testLearningThresholds() {
            console.log('ğŸ§  å­¦ç¿’é–¾å€¤ç¢ºèªé–‹å§‹');
            const thresholds = LearningSystem.getComplexBettingThresholds();
            const learningData = LearningSystem.getLearningData();
            
            const thresholdDiv = document.getElementById('thresholdSettings');
            thresholdDiv.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ§  ç¾åœ¨ã®å­¦ç¿’é–¾å€¤è¨­å®š</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h5>3é€£è¤‡é–¾å€¤</h5>
                            <p><strong>ãƒ¡ã‚¤ãƒ³:</strong> ${thresholds.tripleBox.main}</p>
                            <p><strong>ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:</strong> ${thresholds.tripleBox.formation}</p>
                        </div>
                        <div>
                            <h5>3é€£å˜é–¾å€¤</h5>
                            <p><strong>ãƒ¡ã‚¤ãƒ³:</strong> ${thresholds.tripleExact.main}</p>
                            <p><strong>ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:</strong> ${thresholds.tripleExact.formation}</p>
                        </div>
                    </div>
                    <p><strong>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿æœ‰ç„¡:</strong> ${learningData.complexBetting ? 'âœ… ã‚ã‚Š' : 'âŒ ãªã—'}</p>
                    ${learningData.complexBetting ? `
                        <p><strong>3é€£è¤‡æ¨å¥¨å›æ•°:</strong> ${learningData.complexBetting.tripleBox.totalBets}å›</p>
                        <p><strong>3é€£å˜æ¨å¥¨å›æ•°:</strong> ${learningData.complexBetting.tripleExact.totalBets}å›</p>
                    ` : ''}
                </div>
            `;
        }
        
        // ç¾å®Ÿçš„ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ
        function testRealWorldScenario() {
            console.log('ğŸŒ ç¾å®Ÿçš„ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆé–‹å§‹');
            const results = document.getElementById('testResults');
            
            const horses = generateTestHorses('realistic');
            
            const marks = BettingRecommender.classifyHorses(horses, 
                [...horses].sort((a, b) => b.winProbability - a.winProbability),
                [...horses].sort((a, b) => b.winExpectedValue - a.winExpectedValue)
            );
            
            const tripleBoxRecs = BettingRecommender.generateTripleBoxRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            const tripleExactRecs = BettingRecommender.generateTripleExactRecommendations(
                marks, horses, (name) => horses.findIndex(h => h.name === name) + 1
            );
            
            // è©³ç´°ãªåˆ†æ
            const markedHorses = Object.values(marks).filter(m => m);
            const analysisText = [];
            
            if (markedHorses.length < 3) {
                analysisText.push('âŒ å°ã¤ãé¦¬ãŒ3é ­æœªæº€ã®ãŸã‚æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“');
            } else {
                const topThree = markedHorses.slice(0, 3);
                const tripleBoxEfficiency = BettingRecommender.calculateTripleBoxExpectedValue(topThree, horses);
                const thresholds = LearningSystem.getComplexBettingThresholds();
                
                analysisText.push(`ğŸ§® 3é€£è¤‡åŠ¹ç‡: ${tripleBoxEfficiency.efficiency.toFixed(3)} (é–¾å€¤: ${thresholds.tripleBox.main})`);
                analysisText.push(`ğŸ¯ 3é€£è¤‡çš„ä¸­ç‡: ${tripleBoxEfficiency.hitProbability.toFixed(2)}%`);
                analysisText.push(`ğŸ’° 3é€£è¤‡æ¨å®šé…å½“: ${tripleBoxEfficiency.estimatedDividend}å€`);
                
                if (tripleBoxEfficiency.efficiency >= thresholds.tripleBox.main) {
                    analysisText.push('âœ… åŠ¹ç‡ãŒé–¾å€¤ã‚’ä¸Šå›ã‚‹ãŸã‚3é€£è¤‡æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã™');
                } else {
                    analysisText.push('âŒ åŠ¹ç‡ãŒé–¾å€¤ã‚’ä¸‹å›ã‚‹ãŸã‚3é€£è¤‡æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“');
                }
            }
            
            results.innerHTML = `
                <div class="result-card">
                    <h4>ğŸŒ ç¾å®Ÿçš„ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>å°ã¤ãé¦¬æ•°:</strong> ${markedHorses.length}é ­</p>
                    <p><strong>3é€£è¤‡æ¨å¥¨æ•°:</strong> ${tripleBoxRecs.length}ä»¶</p>
                    <p><strong>3é€£å˜æ¨å¥¨æ•°:</strong> ${tripleExactRecs.length}ä»¶</p>
                    <div style="margin-top: 15px;">
                        ${analysisText.map(text => `<p>${text}</p>`).join('')}
                    </div>
                </div>
            `;
        }
        
        // åŠ¹ç‡è¨ˆç®—è©³ç´°è¡¨ç¤º
        function displayEfficiencyDetails(marks, horses) {
            const efficiencyDiv = document.getElementById('efficiencyDetails');
            const markedHorses = Object.values(marks).filter(m => m);
            
            if (markedHorses.length < 3) {
                efficiencyDiv.innerHTML = `
                    <div class="warning-card">
                        <h4>âš ï¸ åŠ¹ç‡è¨ˆç®—ä¸å¯</h4>
                        <p>å°ã¤ãé¦¬ãŒ3é ­æœªæº€ã®ãŸã‚åŠ¹ç‡è¨ˆç®—ã§ãã¾ã›ã‚“</p>
                    </div>
                `;
                return;
            }
            
            const topThree = markedHorses.slice(0, 3);
            const tripleBoxCalc = BettingRecommender.calculateTripleBoxExpectedValue(topThree, horses);
            const tripleExactCalc = BettingRecommender.calculateTripleExactExpectedValue(topThree, horses);
            
            efficiencyDiv.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ“Š åŠ¹ç‡è¨ˆç®—è©³ç´°</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h5>3é€£è¤‡è¨ˆç®—</h5>
                            <p><strong>å¯¾è±¡é¦¬:</strong> ${topThree.map(h => h.name).join(', ')}</p>
                            <p><strong>è¤‡å‹ç‡:</strong> ${topThree.map(h => h.placeProbability + '%').join(', ')}</p>
                            <p><strong>çš„ä¸­ç‡:</strong> ${tripleBoxCalc.hitProbability.toFixed(2)}%</p>
                            <p><strong>æ¨å®šé…å½“:</strong> ${tripleBoxCalc.estimatedDividend}å€</p>
                            <p><strong>åŠ¹ç‡:</strong> ${tripleBoxCalc.efficiency.toFixed(3)}</p>
                        </div>
                        <div>
                            <h5>3é€£å˜è¨ˆç®—</h5>
                            <p><strong>å¯¾è±¡é¦¬:</strong> ${topThree.map(h => h.name).join(', ')}</p>
                            <p><strong>å‹ç‡:</strong> ${topThree.map(h => h.winProbability + '%').join(', ')}</p>
                            <p><strong>çš„ä¸­ç‡:</strong> ${tripleExactCalc.hitProbability.toFixed(3)}%</p>
                            <p><strong>æ¨å®šé…å½“:</strong> ${tripleExactCalc.estimatedDividend}å€</p>
                            <p><strong>åŠ¹ç‡:</strong> ${tripleExactCalc.efficiency.toFixed(3)}</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // æ¨å¥¨æ¡ä»¶åˆ†æ
        function analyzeRecommendationConditions() {
            const conditionDiv = document.getElementById('conditionAnalysis');
            const thresholds = LearningSystem.getComplexBettingThresholds();
            
            conditionDiv.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ”¬ æ¨å¥¨æ¡ä»¶åˆ†æ</h4>
                    
                    <h5>âœ… 3é€£è¤‡ãƒ»3é€£å˜ãŒè¡¨ç¤ºã•ã‚Œã‚‹æ¡ä»¶</h5>
                    <ul>
                        <li><strong>å°ã¤ãé¦¬æ•°:</strong> 3é ­ä»¥ä¸Šå¿…è¦</li>
                        <li><strong>3é€£è¤‡åŠ¹ç‡é–¾å€¤:</strong> ${thresholds.tripleBox.main}ä»¥ä¸Š</li>
                        <li><strong>3é€£å˜åŠ¹ç‡é–¾å€¤:</strong> ${thresholds.tripleExact.main}ä»¥ä¸Š</li>
                        <li><strong>è¨ˆç®—å¼:</strong> åŠ¹ç‡ = (çš„ä¸­ç‡ Ã— æ¨å®šé…å½“) Ã· 100</li>
                    </ul>
                    
                    <h5>âŒ è¡¨ç¤ºã•ã‚Œãªã„ç†ç”±</h5>
                    <ul>
                        <li>å°ã¤ãé¦¬ãŒ3é ­æœªæº€</li>
                        <li>è¨ˆç®—ã•ã‚ŒãŸåŠ¹ç‡ãŒå­¦ç¿’é–¾å€¤ã‚’ä¸‹å›ã‚‹</li>
                        <li>é¦¬ã®ã‚ªãƒƒã‚ºãƒ»å‹ç‡ãƒ‡ãƒ¼ã‚¿ãŒä¸é©åˆ‡</li>
                        <li>è¤‡å‹ç‡ãŒæ¥µç«¯ã«ä½ã„</li>
                    </ul>
                    
                    <h5>ğŸ¯ åŠ¹ç‡ã‚’é«˜ã‚ã‚‹æ–¹æ³•</h5>
                    <ul>
                        <li>è¤‡å‹ç‡ã®é«˜ã„é¦¬ã‚’é¸ã¶</li>
                        <li>ã‚ªãƒƒã‚ºã®ãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒæ…®ã™ã‚‹</li>
                        <li>ç«¶äº‰æ¿€åŒ–åº¦ã‚’ä¸‹ã’ã‚‹</li>
                        <li>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ã—ã¦é–¾å€¤ã‚’èª¿æ•´ã™ã‚‹</li>
                    </ul>
                </div>
            `;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨æ©Ÿèƒ½èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            analyzeRecommendationConditions();
        });
    </script>
</body>
</html>