<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ ç©´é¦¬å­¦ç¿’æ”¹å–„ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-section { background: #f8f9fa; padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #007bff; }
        .horse-item { padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ddd; }
        .recommended { background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border: 2px solid #4caf50; }
        .candidate { background: linear-gradient(135deg, #fff3e0, #ffe0b2); border: 1px solid #ff9800; }
        .result-hit { color: #4caf50; font-weight: bold; }
        .result-miss { color: #f44336; font-weight: bold; }
        .learning-pattern { background: #e3f2fd; padding: 10px; margin: 5px 0; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ ç©´é¦¬å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç¾åœ¨ã®ä»•çµ„ã¿æ¤œè¨¼</h2>
            <div id="current-system-test">
                <h3>1. ç·‘èƒŒæ™¯è¡¨ç¤ºæ¡ä»¶ãƒ†ã‚¹ãƒˆ</h3>
                <button class="btn-primary" onclick="testGreenBackgroundLogic()">ç·‘èƒŒæ™¯è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
                <div id="green-background-result"></div>
                
                <h3>2. â–²å˜ç©´æ¨å¥¨æ¡ä»¶ãƒ†ã‚¹ãƒˆ</h3>
                <button class="btn-primary" onclick="testTananaRecommendation()">å˜ç©´æ¨å¥¨ãƒ†ã‚¹ãƒˆ</button>
                <div id="tanana-recommendation-result"></div>
                
                <h3>3. ç¾åœ¨ã®ç©´é¦¬å­¦ç¿’æ¡ä»¶ãƒ†ã‚¹ãƒˆ</h3>
                <button class="btn-primary" onclick="testCurrentSleeperLearning()">ç¾åœ¨å­¦ç¿’æ¡ä»¶ãƒ†ã‚¹ãƒˆ</button>
                <div id="current-learning-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ å®Ÿéš›ã®ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆ2025/7/5ã®ãƒ¬ãƒ¼ã‚¹ï¼‰</h2>
            <div id="actual-case-test">
                <div class="horse-item">
                    <strong>ãƒ«ã‚¯ã‚¹ãƒ¡ãƒ³ãƒ‡ã‚¹</strong> - 94.9å€ - <span class="result-hit">1ç€</span>
                    <div>çŠ¶æ…‹: <span id="lukus-status">æ¤œè¨¼ä¸­...</span></div>
                </div>
                <div class="horse-item">
                    <strong>ã‚¨ã‚¤ã‚·ãƒ³ãƒãƒ¼ãƒ«ã‚¹</strong> - 6å€ - <span class="result-hit">2ç€</span>
                    <div>çŠ¶æ…‹: <span id="eishin-status">æ¤œè¨¼ä¸­...</span></div>
                </div>
                <div class="horse-item">
                    <strong>ã‚¸ãƒ¥ãƒ¼ãƒ³ã‚»ãƒ¬ãƒƒã‚½</strong> - 124.8å€ - <span class="result-hit">3ç€</span>
                    <div>çŠ¶æ…‹: <span id="june-status">æ¤œè¨¼ä¸­...</span></div>
                </div>
                <div class="horse-item">
                    <strong>ã‚¨ãƒ¼ã‚°ãƒ«ãƒ‰ãƒ¼ãƒ«</strong> - 6.9å€ - <span class="result-miss">åœå¤–</span>
                    <div>çŠ¶æ…‹: <span id="eagle-status">æ¤œè¨¼ä¸­...</span></div>
                </div>
                <button class="btn-success" onclick="analyzeActualCase()">å®Ÿéš›ã®ã‚±ãƒ¼ã‚¹ã‚’åˆ†æ</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸš€ æ”¹å–„æ¡ˆãƒ†ã‚¹ãƒˆ</h2>
            <div id="improvement-test">
                <h3>æ–°ã—ã„å­¦ç¿’ãƒ«ãƒ¼ãƒ«</h3>
                <div class="learning-pattern">
                    <strong>ãƒ‘ã‚¿ãƒ¼ãƒ³A</strong>: â–²å˜ç©´æ¨å¥¨é¦¬ã®æˆå¦å­¦ç¿’<br>
                    å¯¾è±¡: ã‚¨ãƒ¼ã‚°ãƒ«ãƒ‰ãƒ¼ãƒ«ï¼ˆæ¨å¥¨ â†’ åœå¤–ï¼‰
                </div>
                <div class="learning-pattern">
                    <strong>ãƒ‘ã‚¿ãƒ¼ãƒ³B</strong>: ç©´é¦¬å€™è£œè¦‹è½ã¨ã—å­¦ç¿’<br>
                    å¯¾è±¡: ãƒ«ã‚¯ã‚¹ãƒ¡ãƒ³ãƒ‡ã‚¹ï¼ˆå€™è£œã ãŒéæ¨å¥¨ â†’ 1ç€ï¼‰
                </div>
                <div class="learning-pattern">
                    <strong>ãƒ‘ã‚¿ãƒ¼ãƒ³C</strong>: ç©´é¦¬å€™è£œè¦‹è½ã¨ã—å­¦ç¿’<br>
                    å¯¾è±¡: ã‚¸ãƒ¥ãƒ¼ãƒ³ã‚»ãƒ¬ãƒƒã‚½ï¼ˆå€™è£œã ãŒéæ¨å¥¨ â†’ 3ç€ï¼‰
                </div>
                
                <button class="btn-warning" onclick="testImprovedLearning()">æ”¹å–„æ¡ˆã‚’ãƒ†ã‚¹ãƒˆ</button>
                <div id="improved-learning-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ å­¦ç¿’åŠ¹æœã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <div id="learning-simulation">
                <p>æ”¹å–„å‰å¾Œã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒ</p>
                <div id="before-after-comparison"></div>
                <button class="btn-success" onclick="simulateLearningEffect()">å­¦ç¿’åŠ¹æœã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ å®Ÿè£…äºˆå®šã‚³ãƒ¼ãƒ‰</h2>
            <div id="implementation-preview">
                <textarea id="code-preview" style="width: 100%; height: 200px; font-family: monospace;">
// æ”¹å–„äºˆå®šã®ã‚³ãƒ¼ãƒ‰æ§‹é€ 

class ImprovedSleeperLearning {
    // 1. æ¨å¥¨åˆ¤æ–­ï¼ˆ1é ­ã«çµã‚‹ï¼‰
    static getRecommendedSleeper(predictions) {
        // ç¾åœ¨ã®â–²å˜ç©´æ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¶­æŒ
    }
    
    // 2. å­¦ç¿’å¯¾è±¡æŠ½å‡ºï¼ˆ1-3é ­ã«æ‹¡å¼µï¼‰
    static extractLearningTargets(predictions, recommendations) {
        // â–²å˜ç©´æ¨å¥¨é¦¬ + ç·‘èƒŒæ™¯é«˜ã‚ªãƒƒã‚ºé¦¬
    }
    
    // 3. æ‹¡å¼µå­¦ç¿’å®Ÿè¡Œ
    static learnFromExpandedTargets(learningTargets, actualResults) {
        // æˆåŠŸ/å¤±æ•—/è¦‹è½ã¨ã—å…¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’
    }
}
                </textarea>
                <button class="btn-primary" onclick="updateCodePreview()">å®Ÿè£…ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°</button>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const testRaceData = {
            horses: [
                { name: 'ãƒ«ã‚¯ã‚¹ãƒ¡ãƒ³ãƒ‡ã‚¹', odds: 94.9, actualPosition: 1, popularity: 16 },
                { name: 'ã‚¨ã‚¤ã‚·ãƒ³ãƒãƒ¼ãƒ«ã‚¹', odds: 6.0, actualPosition: 2, popularity: 6 },
                { name: 'ã‚¸ãƒ¥ãƒ¼ãƒ³ã‚»ãƒ¬ãƒƒã‚½', odds: 124.8, actualPosition: 3, popularity: 14 },
                { name: 'ã‚¨ãƒ¼ã‚°ãƒ«ãƒ‰ãƒ¼ãƒ«', odds: 6.9, actualPosition: 0, popularity: 7 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬A', odds: 3.2, actualPosition: 0, popularity: 2 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬B', odds: 15.5, actualPosition: 0, popularity: 10 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬C', odds: 28.3, actualPosition: 0, popularity: 12 }
            ]
        };
        
        // 1. ç·‘èƒŒæ™¯è¡¨ç¤ºæ¡ä»¶ãƒ†ã‚¹ãƒˆ
        function testGreenBackgroundLogic() {
            const result = document.getElementById('green-background-result');
            let output = '<h4>ç·‘èƒŒæ™¯è¡¨ç¤ºæ¡ä»¶: ã‚ªãƒƒã‚º5å€ä»¥ä¸Š</h4>';
            
            testRaceData.horses.forEach(horse => {
                const isGreenBackground = horse.odds >= 5.0;
                const bgClass = isGreenBackground ? 'candidate' : '';
                output += `<div class="horse-item ${bgClass}">
                    ${horse.name} (${horse.odds}å€) - ${isGreenBackground ? 'âœ… ç·‘èƒŒæ™¯' : 'âŒ é€šå¸¸'}
                </div>`;
            });
            
            const greenCount = testRaceData.horses.filter(h => h.odds >= 5.0).length;
            output += `<p><strong>ç·‘èƒŒæ™¯è¡¨ç¤ºé¦¬æ•°: ${greenCount}/${testRaceData.horses.length}é ­</strong></p>`;
            
            result.innerHTML = output;
        }
        
        // 2. â–²å˜ç©´æ¨å¥¨æ¡ä»¶ãƒ†ã‚¹ãƒˆ
        function testTananaRecommendation() {
            const result = document.getElementById('tanana-recommendation-result');
            
            // ç°¡æ˜“çš„ãªå˜ç©´æ¨å¥¨ãƒ­ã‚¸ãƒƒã‚¯å†ç¾
            const candidates = testRaceData.horses.filter(horse => 
                horse.odds >= 5 && horse.odds <= 20 // ä¸­ã‚ªãƒƒã‚ºå¸¯
            );
            
            // æœŸå¾…å€¤ã§ä¸¦ã³æ›¿ãˆï¼ˆç°¡æ˜“è¨ˆç®—ï¼‰
            candidates.forEach(horse => {
                horse.expectedValue = (1/horse.odds) * horse.odds * 0.15; // ä»®ã®æœŸå¾…å€¤
            });
            
            const recommended = candidates.sort((a, b) => b.expectedValue - a.expectedValue)[0];
            
            let output = '<h4>â–²å˜ç©´æ¨å¥¨æ¡ä»¶: ã‚ªãƒƒã‚º5-20å€ã§æœŸå¾…å€¤æœ€é«˜</h4>';
            
            if (recommended) {
                output += `<div class="horse-item recommended">
                    <strong>æ¨å¥¨: ${recommended.name}</strong> (${recommended.odds}å€) 
                    - å®Ÿéš›: ${recommended.actualPosition ? recommended.actualPosition + 'ç€' : 'åœå¤–'}
                    ${recommended.actualPosition && recommended.actualPosition <= 3 ? '<span class="result-hit"> âœ… çš„ä¸­</span>' : '<span class="result-miss"> âŒ å¤–ã‚Œ</span>'}
                </div>`;
            }
            
            result.innerHTML = output;
        }
        
        // 3. ç¾åœ¨ã®ç©´é¦¬å­¦ç¿’æ¡ä»¶ãƒ†ã‚¹ãƒˆ
        function testCurrentSleeperLearning() {
            const result = document.getElementById('current-learning-result');
            
            // ç¾åœ¨ã®å­¦ç¿’æ¡ä»¶ï¼ˆdetectSleeperåŸºæº–ï¼‰ã‚’ç°¡æ˜“å†ç¾
            let output = '<h4>ç¾åœ¨ã®å­¦ç¿’æ¡ä»¶: detectSleeperåˆ¤å®šã®ã¿</h4>';
            
            testRaceData.horses.forEach(horse => {
                // ç°¡æ˜“çš„ãªdetectSleeperæ¡ä»¶
                let sleeperScore = 0;
                if (horse.odds >= 6) sleeperScore += 10;
                if (horse.odds >= 8) sleeperScore += 10;
                // ãã®ä»–ã®æ¡ä»¶ã¯çœç•¥
                
                const isLearningTarget = sleeperScore >= 20;
                const actualHit = horse.actualPosition && horse.actualPosition <= 3;
                
                if (isLearningTarget) {
                    output += `<div class="horse-item ${actualHit ? 'result-hit' : 'result-miss'}">
                        ${horse.name} (${horse.odds}å€) - å­¦ç¿’å¯¾è±¡ - ${actualHit ? 'çš„ä¸­' : 'å¤–ã‚Œ'}
                    </div>`;
                }
            });
            
            result.innerHTML = output;
        }
        
        // 4. å®Ÿéš›ã®ã‚±ãƒ¼ã‚¹åˆ†æ
        function analyzeActualCase() {
            // å„é¦¬ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.getElementById('lukus-status').innerHTML = 'ç·‘èƒŒæ™¯å€™è£œãƒ»éæ¨å¥¨ â†’ <span class="result-hit">è¦‹è½ã¨ã—</span>';
            document.getElementById('eishin-status').innerHTML = 'ç·‘èƒŒæ™¯å€™è£œãƒ»éæ¨å¥¨ â†’ <span class="result-hit">è¦‹è½ã¨ã—</span>';
            document.getElementById('june-status').innerHTML = 'ç·‘èƒŒæ™¯å€™è£œãƒ»éæ¨å¥¨ â†’ <span class="result-hit">è¦‹è½ã¨ã—ï¼ˆç¾åœ¨å­¦ç¿’æ¸ˆã¿ï¼‰</span>';
            document.getElementById('eagle-status').innerHTML = 'ç·‘èƒŒæ™¯å€™è£œãƒ»æ¨å¥¨ â†’ <span class="result-miss">å¤±æ•—</span>';
        }
        
        // 5. æ”¹å–„æ¡ˆãƒ†ã‚¹ãƒˆ
        function testImprovedLearning() {
            const result = document.getElementById('improved-learning-result');
            
            let output = '<h4>æ”¹å–„æ¡ˆã«ã‚ˆã‚‹å­¦ç¿’å¯¾è±¡æ‹¡å¼µ</h4>';
            
            // æ¨å¥¨é¦¬ã®å­¦ç¿’
            output += '<div class="learning-pattern"><strong>æ¨å¥¨é¦¬å­¦ç¿’</strong>: ã‚¨ãƒ¼ã‚°ãƒ«ãƒ‰ãƒ¼ãƒ« â†’ å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’</div>';
            
            // è¦‹è½ã¨ã—é¦¬ã®å­¦ç¿’
            const highOddsHits = testRaceData.horses.filter(h => h.odds >= 15 && h.actualPosition <= 3);
            highOddsHits.forEach(horse => {
                output += `<div class="learning-pattern"><strong>è¦‹è½ã¨ã—å­¦ç¿’</strong>: ${horse.name} (${horse.odds}å€ãƒ»${horse.actualPosition}ç€) â†’ è¦‹è½ã¨ã—è¦å› åˆ†æ</div>`;
            });
            
            output += '<p><strong>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿é‡</strong>: ç¾åœ¨1ä»¶ â†’ æ”¹å–„å¾Œ3ä»¶ï¼ˆ3å€ã®å­¦ç¿’åŠ¹ç‡ï¼‰</p>';
            
            result.innerHTML = output;
        }
        
        // 6. å­¦ç¿’åŠ¹æœã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateLearningEffect() {
            const result = document.getElementById('before-after-comparison');
            
            const simulation = `
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="background: #f8f9fa;">
                    <th style="border: 1px solid #ddd; padding: 8px;">é …ç›®</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">æ”¹å–„å‰</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">æ”¹å–„å¾Œ</th>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">å­¦ç¿’å¯¾è±¡é¦¬æ•°/ãƒ¬ãƒ¼ã‚¹</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">1é ­</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">1-3é ­</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">è¦‹è½ã¨ã—å­¦ç¿’</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">ãªã—</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">ã‚ã‚Š</td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">ãƒ«ã‚¯ã‚¹ãƒ¡ãƒ³ãƒ‡ã‚¹ã‚±ãƒ¼ã‚¹</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">å­¦ç¿’ã•ã‚Œãªã„</td>
                    <td style="border: 1px solid #ddd; padding: 8px;">è¦‹è½ã¨ã—å­¦ç¿’ã•ã‚Œã‚‹</td>
                </tr>
            </table>
            `;
            
            result.innerHTML = simulation;
        }
        
        // 7. å®Ÿè£…ã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        function updateCodePreview() {
            const preview = document.getElementById('code-preview');
            preview.value = `
// ç©´é¦¬å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„å®Ÿè£…ã‚³ãƒ¼ãƒ‰

class ImprovedSleeperLearning {
    
    // å­¦ç¿’å¯¾è±¡æ‹¡å¼µæŠ½å‡º
    static extractExpandedLearningTargets(predictions, bettingRecommendations) {
        const targets = [];
        
        // 1. â–²å˜ç©´æ¨å¥¨é¦¬ã¯å¿…ãšå­¦ç¿’å¯¾è±¡
        if (bettingRecommendations.tanana) {
            targets.push({
                horse: bettingRecommendations.tanana,
                type: 'RECOMMENDED',
                reason: 'å˜ç©´æ¨å¥¨é¦¬'
            });
        }
        
        // 2. ç·‘èƒŒæ™¯ã§é«˜ã‚ªãƒƒã‚ºï¼ˆ15å€ä»¥ä¸Šï¼‰ã®é¦¬ã‚‚å­¦ç¿’å¯¾è±¡
        predictions.forEach(horse => {
            if (horse.isUnderdog && horse.odds >= 15 && 
                !targets.some(t => t.horse.name === horse.name)) {
                targets.push({
                    horse: horse,
                    type: 'HIGH_ODDS_CANDIDATE',
                    reason: 'é«˜ã‚ªãƒƒã‚ºç©´é¦¬å€™è£œ'
                });
            }
        });
        
        return targets;
    }
    
    // æ‹¡å¼µå­¦ç¿’å®Ÿè¡Œ
    static performExpandedLearning(learningTargets, actualTop3) {
        learningTargets.forEach(target => {
            const isHit = actualTop3.some(horse => horse.name === target.horse.name);
            const position = isHit ? actualTop3.findIndex(h => h.name === target.horse.name) + 1 : null;
            
            // å­¦ç¿’ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¤å®š
            let learningPattern;
            if (target.type === 'RECOMMENDED') {
                learningPattern = isHit ? 'RECOMMENDATION_SUCCESS' : 'RECOMMENDATION_FAILURE';
            } else {
                learningPattern = isHit ? 'OVERSIGHT_DISCOVERY' : 'CORRECT_EXCLUSION';
            }
            
            // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«è¨˜éŒ²
            this.recordExpandedLearningPattern({
                date: new Date().toISOString(),
                horseName: target.horse.name,
                odds: target.horse.odds,
                type: target.type,
                pattern: learningPattern,
                isHit: isHit,
                position: position,
                reason: target.reason
            });
        });
    }
}`;
        }
        
        // åˆæœŸè¡¨ç¤º
        window.onload = function() {
            testGreenBackgroundLogic();
        };
    </script>
</body>
</html>