<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 7: å€™è£œè©•ä¾¡ãƒ—ãƒ­ã‚»ã‚¹å¯è¦–åŒ–ãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .test-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .test-btn.primary {
            background: #007bff;
            color: white;
        }
        .test-btn.primary:hover {
            background: #0056b3;
        }
        .test-btn.secondary {
            background: #6c757d;
            color: white;
        }
        .test-btn.secondary:hover {
            background: #545b62;
        }
        .test-btn.success {
            background: #28a745;
            color: white;
        }
        .test-btn.success:hover {
            background: #1e7e34;
        }
        .demo-data-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .demo-data-section h3 {
            margin: 0 0 15px 0;
            color: #495057;
        }
        .demo-scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .scenario-btn {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        .scenario-btn:hover {
            border-color: #007bff;
            background: #e7f3ff;
        }
        .scenario-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .scenario-desc {
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-header">
            <h1>ğŸ” å€™è£œè©•ä¾¡ãƒ—ãƒ­ã‚»ã‚¹å¯è¦–åŒ–ãƒ†ã‚¹ãƒˆ</h1>
            <p>Kelly Criterioné¸è€ƒãƒ—ãƒ­ã‚»ã‚¹ã®å®Œå…¨é€æ˜åŒ–ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div class="test-controls">
            <button class="test-btn primary" onclick="initializeEvaluationTest()">
                ğŸš€ è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            </button>
            <button class="test-btn secondary" onclick="refreshEvaluationData()">
                ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
            </button>
            <button class="test-btn success" onclick="runFullEvaluationDemo()">
                ğŸ¯ ãƒ•ãƒ«ãƒ‡ãƒ¢å®Ÿè¡Œ
            </button>
        </div>

        <div class="demo-data-section">
            <h3>ğŸ“Š ãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ªé¸æŠ</h3>
            <div class="demo-scenarios">
                <div class="scenario-btn" onclick="loadScenario('high_performance')">
                    <div class="scenario-title">é«˜æˆç¸¾ã‚·ãƒŠãƒªã‚ª</div>
                    <div class="scenario-desc">Kellyæ¯”ç‡3-8%ã®å„ªè‰¯å€™è£œ</div>
                </div>
                <div class="scenario-btn" onclick="loadScenario('mixed_performance')">
                    <div class="scenario-title">æ··åˆã‚·ãƒŠãƒªã‚ª</div>
                    <div class="scenario-desc">ãƒ¡ã‚¤ãƒ³ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ»é™¤å¤–æ··åœ¨</div>
                </div>
                <div class="scenario-btn" onclick="loadScenario('low_performance')">
                    <div class="scenario-title">ä½æˆç¸¾ã‚·ãƒŠãƒªã‚ª</div>
                    <div class="scenario-desc">å¤šæ•°ãŒæŠ•è³‡å¯¾è±¡å¤–</div>
                </div>
                <div class="scenario-btn" onclick="loadScenario('conflict_resolution')">
                    <div class="scenario-title">ç«¶åˆè§£æ±ºã‚·ãƒŠãƒªã‚ª</div>
                    <div class="scenario-desc">è¤‡æ•°å€™è£œã®ç«¶åˆå‡¦ç†</div>
                </div>
            </div>
        </div>

        <!-- å€™è£œè©•ä¾¡å¯è¦–åŒ–ã‚³ãƒ³ãƒ†ãƒŠãŒã“ã“ã«å‹•çš„ç”Ÿæˆã•ã‚Œã‚‹ -->
        
    </div>

    <!-- Phase 6 Scripts -->
    <script src="js/kellyCapitalManager.js"></script>
    <script src="js/expectedValueCalculator.js"></script>
    <script src="js/bettingFilter.js"></script>
    <script src="js/phase6Integration.js"></script>
    
    <!-- Phase 7 Scripts -->
    <script src="js/portfolioDashboard.js"></script>
    <script src="js/performanceCharts.js"></script>
    <script src="js/candidateEvaluationVisualizer.js"></script>
    
    <script>
        let evaluationVisualizer = null;
        
        /**
         * è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆåˆæœŸåŒ–
         */
        function initializeEvaluationTest() {
            console.log('ğŸš€ å€™è£œè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆåˆæœŸåŒ–é–‹å§‹');
            
            try {
                // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚Œã°ç ´æ£„
                if (evaluationVisualizer) {
                    evaluationVisualizer.destroy();
                }
                
                // æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
                evaluationVisualizer = new CandidateEvaluationVisualizer();
                evaluationVisualizer.initialize();
                
                showMessage('âœ… å€™è£œè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ', 'success');
                console.log('âœ… è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆåˆæœŸåŒ–å®Œäº†');
            } catch (error) {
                console.error('âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                showMessage('âŒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            }
        }
        
        /**
         * è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
         */
        function refreshEvaluationData() {
            if (!evaluationVisualizer) {
                showMessage('âš ï¸ è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                return;
            }
            
            try {
                evaluationVisualizer.refreshEvaluation();
                showMessage('ğŸ”„ è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'info');
            } catch (error) {
                console.error('âŒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                showMessage('âŒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            }
        }
        
        /**
         * ãƒ•ãƒ«ãƒ‡ãƒ¢ã®å®Ÿè¡Œ
         */
        function runFullEvaluationDemo() {
            console.log('ğŸ¯ ãƒ•ãƒ«è©•ä¾¡ãƒ‡ãƒ¢å®Ÿè¡Œé–‹å§‹');
            
            // ã‚·ãƒŠãƒªã‚ªã‚’é †æ¬¡å®Ÿè¡Œ
            const scenarios = ['high_performance', 'mixed_performance', 'low_performance'];
            let currentIndex = 0;
            
            function runNextScenario() {
                if (currentIndex < scenarios.length) {
                    const scenario = scenarios[currentIndex];
                    showMessage(`ğŸ“Š ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œä¸­: ${getScenarioName(scenario)}`, 'info');
                    
                    setTimeout(() => {
                        loadScenario(scenario);
                        currentIndex++;
                        setTimeout(runNextScenario, 3000); // 3ç§’é–“éš”
                    }, 1000);
                } else {
                    showMessage('ğŸ‰ ãƒ•ãƒ«ãƒ‡ãƒ¢å®Œäº†ï¼', 'success');
                }
            }
            
            runNextScenario();
        }
        
        /**
         * ãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ªã®èª­ã¿è¾¼ã¿
         */
        function loadScenario(scenarioType) {
            console.log('ğŸ“Š ã‚·ãƒŠãƒªã‚ªèª­ã¿è¾¼ã¿:', scenarioType);
            
            if (!evaluationVisualizer) {
                initializeEvaluationTest();
                setTimeout(() => loadScenario(scenarioType), 1000);
                return;
            }
            
            const scenarioData = generateScenarioData(scenarioType);
            
            // LocalStorageã«ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            localStorage.setItem('kellyPortfolioResults', JSON.stringify(scenarioData));
            
            // è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
            evaluationVisualizer.loadEvaluationData();
            evaluationVisualizer.renderEvaluationProcess();
            
            showMessage(`ğŸ“Š ${getScenarioName(scenarioType)}ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'info');
        }
        
        /**
         * ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
         */
        function generateScenarioData(scenarioType) {
            const baseData = {
                totalInvestment: 0,
                expectedReturn: 0,
                riskMultiplier: 1.0,
                conflictResolutions: []
            };
            
            switch (scenarioType) {
                case 'high_performance':
                    return {
                        ...baseData,
                        totalInvestment: 4500,
                        expectedReturn: 5200,
                        riskMultiplier: 0.8,
                        mainCandidates: [
                            createCandidate('å„ªç§€é¦¬A', 1, 85, 3.2, 0.08),
                            createCandidate('å®ŸåŠ›é¦¬B', 3, 78, 4.1, 0.06),
                            createCandidate('ç©´é¦¬C', 7, 72, 6.8, 0.05)
                        ],
                        optionalCandidates: [
                            createCandidate('ä¿é™ºé¦¬D', 5, 65, 5.2, 0.03),
                            createCandidate('ã‚µãƒ–é¦¬E', 9, 60, 7.1, 0.02)
                        ],
                        rejectedCandidates: [
                            createCandidate('é™¤å¤–é¦¬F', 11, 45, 2.1, 0.005)
                        ]
                    };
                    
                case 'mixed_performance':
                    return {
                        ...baseData,
                        totalInvestment: 2800,
                        expectedReturn: 3100,
                        riskMultiplier: 1.1,
                        mainCandidates: [
                            createCandidate('ä¸­å …é¦¬A', 2, 70, 3.8, 0.04),
                            createCandidate('äººæ°—é¦¬B', 1, 68, 2.9, 0.035)
                        ],
                        optionalCandidates: [
                            createCandidate('ç©´å€™è£œC', 8, 58, 8.2, 0.025),
                            createCandidate('ä¿é™ºé¦¬D', 6, 55, 6.5, 0.02),
                            createCandidate('ã‚µãƒ–é¦¬E', 12, 52, 9.1, 0.015)
                        ],
                        rejectedCandidates: [
                            createCandidate('ä½è©•ä¾¡é¦¬F', 14, 38, 12.5, 0.008),
                            createCandidate('é™¤å¤–é¦¬G', 16, 35, 15.8, 0.003),
                            createCandidate('å¯¾è±¡å¤–H', 18, 28, 2.0, 0.001)
                        ]
                    };
                    
                case 'low_performance':
                    return {
                        ...baseData,
                        totalInvestment: 800,
                        expectedReturn: 850,
                        riskMultiplier: 1.3,
                        mainCandidates: [
                            createCandidate('å”¯ä¸€å€™è£œA', 4, 62, 4.5, 0.025)
                        ],
                        optionalCandidates: [
                            createCandidate('å¾®å¦™é¦¬B', 10, 48, 8.8, 0.018)
                        ],
                        rejectedCandidates: [
                            createCandidate('ä½ã‚¹ã‚³ã‚¢é¦¬C', 2, 42, 2.3, 0.008),
                            createCandidate('äººæ°—è–„D', 13, 38, 15.2, 0.005),
                            createCandidate('é™¤å¤–é¦¬E', 15, 35, 18.5, 0.002),
                            createCandidate('å¯¾è±¡å¤–F', 17, 30, 25.8, 0.001),
                            createCandidate('åœå¤–é¦¬G', 18, 25, 45.2, 0.0005)
                        ]
                    };
                    
                case 'conflict_resolution':
                    return {
                        ...baseData,
                        totalInvestment: 3200,
                        expectedReturn: 3600,
                        riskMultiplier: 0.95,
                        mainCandidates: [
                            createCandidate('ç«¶åˆå‹è€…A', 1, 82, 3.1, 0.07),
                            createCandidate('é¸å®šé¦¬B', 5, 75, 4.8, 0.055)
                        ],
                        optionalCandidates: [
                            createCandidate('è£œæ¬ é¦¬C', 8, 64, 6.2, 0.028)
                        ],
                        rejectedCandidates: [
                            createCandidate('ç«¶åˆæ•—è€…D', 2, 80, 3.0, 0.068), // Aã¨ç«¶åˆã—ã¦è½é¸
                            createCandidate('ã‚ªãƒƒã‚ºç«¶åˆE', 6, 73, 4.9, 0.052), // Bã¨ç«¶åˆã—ã¦è½é¸
                            createCandidate('åŸºæº–æœªé”F', 12, 45, 8.5, 0.015)
                        ],
                        conflictResolutions: [
                            {
                                raceId: 'R1',
                                conflictType: 'same_race_multiple_candidates',
                                candidates: ['ç«¶åˆå‹è€…A', 'ç«¶åˆæ•—è€…D'],
                                resolution: 'highest_kelly_selected',
                                winner: 'ç«¶åˆå‹è€…A'
                            },
                            {
                                raceId: 'R2', 
                                conflictType: 'odds_similarity',
                                candidates: ['é¸å®šé¦¬B', 'ã‚ªãƒƒã‚ºç«¶åˆE'],
                                resolution: 'score_priority',
                                winner: 'é¸å®šé¦¬B'
                            }
                        ]
                    };
                    
                default:
                    return generateScenarioData('mixed_performance');
            }
        }
        
        /**
         * å€™è£œãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
         */
        function createCandidate(name, number, score, odds, kellyRatio) {
            const winProbability = score / 100 * 0.3;
            const expectedValue = winProbability * odds;
            
            return {
                horse: { name: name, number: number },
                score: score,
                odds: odds,
                winProbability: winProbability,
                expectedValue: expectedValue,
                kellyRatio: kellyRatio,
                confidence: 0.8,
                raceId: `race_${Math.floor(number / 3) + 1}`,
                amount: Math.round(kellyRatio * 10000) // Kellyæ¯”ç‡Ã—åŸºæº–é¡
            };
        }
        
        /**
         * ã‚·ãƒŠãƒªã‚ªåã®å–å¾—
         */
        function getScenarioName(scenarioType) {
            const names = {
                'high_performance': 'é«˜æˆç¸¾ã‚·ãƒŠãƒªã‚ª',
                'mixed_performance': 'æ··åˆã‚·ãƒŠãƒªã‚ª',
                'low_performance': 'ä½æˆç¸¾ã‚·ãƒŠãƒªã‚ª',
                'conflict_resolution': 'ç«¶åˆè§£æ±ºã‚·ãƒŠãƒªã‚ª'
            };
            return names[scenarioType] || scenarioType;
        }
        
        /**
         * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
         */
        function showMessage(message, type = 'info') {
            // æ—¢å­˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
            const existingMessage = document.querySelector('.test-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `test-message ${type}`;
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;
            
            // ã‚¿ã‚¤ãƒ—åˆ¥ã®ã‚¹ã‚¿ã‚¤ãƒ«
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            messageDiv.style.background = colors[type] || colors.info;
            
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
        }
        
        // CSS ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®è‡ªå‹•åˆæœŸåŒ–
        window.addEventListener('load', () => {
            setTimeout(() => {
                showMessage('ğŸ” å€™è£œè©•ä¾¡ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'info');
                initializeEvaluationTest();
            }, 1000);
        });
    </script>
</body>
</html>