<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 1çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Phase 1: åç›Šæ€§å­¦ç¿’çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>1. ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h2>
        <div id="loadingTest">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</div>
        <button onclick="testSystemLoading()">ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ç¢ºèª</button>
    </div>
    
    <div class="test-section">
        <h2>2. åç›Šæ€§è¨˜éŒ²ãƒ†ã‚¹ãƒˆ</h2>
        <div id="profitabilityTest">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
        <button onclick="testProfitabilityRecording()">åç›Šæ€§è¨˜éŒ²ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div class="test-section">
        <h2>3. æŠ•è³‡åŠ¹ç‡è¨ˆç®—ãƒ†ã‚¹ãƒˆ</h2>
        <div id="efficiencyTest">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
        <button onclick="testInvestmentEfficiency()">æŠ•è³‡åŠ¹ç‡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div class="test-section">
        <h2>4. çµ±åˆãƒ¬ãƒ¼ã‚¹çµæœå‡¦ç†ãƒ†ã‚¹ãƒˆ</h2>
        <div id="integrationTest">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
        <button onclick="testIntegratedProcessing()">çµ±åˆå‡¦ç†ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>
    
    <div class="test-section">
        <h2>5. ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h2>
        <pre id="testLog">ãƒ­ã‚°å¾…æ©Ÿä¸­...</pre>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="js/config.js"></script>
    <script src="js/profitabilityMetrics.js"></script>
    <script src="js/investmentEfficiencyCalculator.js"></script>
    <script src="js/underdogDiscoveryAlgorithm.js"></script>
    <script src="js/riskReturnAnalyzer.js"></script>
    <script src="js/enhancedLearningSystem.js"></script>
    
    <script>
        let testLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            document.getElementById('testLog').textContent = testLog.join('\n');
            console.log(`[Phase1Test] ${message}`);
        }
        
        function clearLog() {
            testLog = [];
            document.getElementById('testLog').textContent = 'ãƒ­ã‚°ã‚¯ãƒªã‚¢æ¸ˆã¿';
        }
        
        function testSystemLoading() {
            log('ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const loadingDiv = document.getElementById('loadingTest');
            
            try {
                // å„ã‚·ã‚¹ãƒ†ãƒ ã®å­˜åœ¨ç¢ºèª
                const systems = [
                    'CONFIG',
                    'ProfitabilityMetrics', 
                    'InvestmentEfficiencyCalculator',
                    'UnderdogDiscoveryAlgorithm',
                    'RiskReturnAnalyzer',
                    'EnhancedLearningSystem'
                ];
                
                let results = [];
                systems.forEach(system => {
                    const exists = typeof window[system] !== 'undefined';
                    results.push(`${system}: ${exists ? 'âœ…' : 'âŒ'}`);
                    log(`${system} èª­ã¿è¾¼ã¿: ${exists ? 'SUCCESS' : 'FAIL'}`, exists ? 'success' : 'error');
                });
                
                loadingDiv.innerHTML = `
                    <div class="${results.every(r => r.includes('âœ…')) ? 'success' : 'error'}">
                        ${results.join('<br>')}
                    </div>
                `;
                
                log('ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                loadingDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                log(`ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        function testProfitabilityRecording() {
            log('åç›Šæ€§è¨˜éŒ²ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const testDiv = document.getElementById('profitabilityTest');
            
            try {
                if (typeof ProfitabilityMetrics === 'undefined') {
                    throw new Error('ProfitabilityMetrics ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
                ProfitabilityMetrics.resetForTest();
                log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                
                // ãƒ†ã‚¹ãƒˆè³­ã‘çµæœ
                const testBet = {
                    horseNumber: '5',
                    horseName: 'ãƒ†ã‚¹ãƒˆç©´é¦¬',
                    odds: 12.0,
                    popularity: 8,
                    betType: 'å˜å‹',
                    betAmount: 1000,
                    isHit: true,
                    returnAmount: 12000
                };
                
                const result = ProfitabilityMetrics.recordBetResult(testBet);
                
                if (result && result.summary) {
                    testDiv.innerHTML = `
                        <div class="success">
                            âœ… åç›Šæ€§è¨˜éŒ²æˆåŠŸ<br>
                            ROI: ${result.summary.roi.toFixed(1)}%<br>
                            åˆ©ç›Š: ${result.summary.totalProfit.toLocaleString()}å††<br>
                            çš„ä¸­ç‡: ${result.summary.hitRate.toFixed(1)}%
                        </div>
                    `;
                    log(`åç›Šæ€§è¨˜éŒ²æˆåŠŸ - ROI: ${result.summary.roi.toFixed(1)}%`);
                } else {
                    throw new Error('åç›Šæ€§è¨˜éŒ²çµæœãŒç„¡åŠ¹');
                }
                
            } catch (error) {
                testDiv.innerHTML = `<div class="error">âŒ ${error.message}</div>`;
                log(`åç›Šæ€§è¨˜éŒ²ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        function testInvestmentEfficiency() {
            log('æŠ•è³‡åŠ¹ç‡è¨ˆç®—ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const testDiv = document.getElementById('efficiencyTest');
            
            try {
                if (typeof InvestmentEfficiencyCalculator === 'undefined') {
                    throw new Error('InvestmentEfficiencyCalculator ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const betData = {
                    odds: 15.0,
                    winProbability: 0.12,
                    betAmount: 1000,
                    confidence: 0.75,
                    popularity: 9
                };
                
                const efficiency = InvestmentEfficiencyCalculator.calculateSingleBetEfficiency(betData);
                
                if (efficiency && efficiency.efficiencyScore !== undefined) {
                    testDiv.innerHTML = `
                        <div class="success">
                            âœ… æŠ•è³‡åŠ¹ç‡è¨ˆç®—æˆåŠŸ<br>
                            åŠ¹ç‡ã‚¹ã‚³ã‚¢: ${efficiency.efficiencyScore}<br>
                            æŠ•è³‡ã‚°ãƒ¬ãƒ¼ãƒ‰: ${efficiency.investmentGrade}<br>
                            ç©´é¦¬åˆ¤å®š: ${efficiency.isUnderdog ? 'YES' : 'NO'}<br>
                            ç©´é¦¬ãƒœãƒ¼ãƒŠã‚¹: ${efficiency.underdogBonus}
                        </div>
                    `;
                    log(`æŠ•è³‡åŠ¹ç‡è¨ˆç®—æˆåŠŸ - ã‚¹ã‚³ã‚¢: ${efficiency.efficiencyScore}, ã‚°ãƒ¬ãƒ¼ãƒ‰: ${efficiency.investmentGrade}`);
                } else {
                    throw new Error('æŠ•è³‡åŠ¹ç‡è¨ˆç®—çµæœãŒç„¡åŠ¹');
                }
                
            } catch (error) {
                testDiv.innerHTML = `<div class="error">âŒ ${error.message}</div>`;
                log(`æŠ•è³‡åŠ¹ç‡è¨ˆç®—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        function testIntegratedProcessing() {
            log('çµ±åˆå‡¦ç†ãƒ†ã‚¹ãƒˆé–‹å§‹');
            const testDiv = document.getElementById('integrationTest');
            
            try {
                // äººæ°—åº¦æ¨å®šé–¢æ•°ï¼ˆmain.jsã‹ã‚‰ï¼‰
                function estimatePopularityFromOdds(odds) {
                    if (odds < 2.0) return 1;
                    if (odds < 3.0) return 2;
                    if (odds < 5.0) return 3;
                    if (odds < 7.0) return 4;
                    if (odds < 10.0) return 6;
                    if (odds < 15.0) return 8;
                    if (odds < 25.0) return 11;
                    return 15;
                }
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®å‹åˆ©é¦¬ãƒ‡ãƒ¼ã‚¿
                const firstHorse = {
                    name: 'çµ±åˆãƒ†ã‚¹ãƒˆé¦¬',
                    odds: 8.5,
                    popularity: 7,
                    number: '3'
                };
                
                // main.jsã®çµ±åˆå‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                let messages = [];
                
                // 1. åç›Šæ€§ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
                if (typeof ProfitabilityMetrics !== 'undefined') {
                    const betResult = {
                        horseNumber: firstHorse.number,
                        horseName: firstHorse.name,
                        odds: firstHorse.odds,
                        popularity: firstHorse.popularity || estimatePopularityFromOdds(firstHorse.odds),
                        betType: 'å˜å‹',
                        betAmount: 1000,
                        isHit: true,
                        returnAmount: firstHorse.odds * 1000
                    };
                    
                    const profitReport = ProfitabilityMetrics.recordBetResult(betResult);
                    if (profitReport) {
                        messages.push(`ğŸ’° åç›Šæ€§æ›´æ–°: ROI ${profitReport.summary.roi.toFixed(1)}%`);
                        log('åç›Šæ€§ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ: SUCCESS');
                    }
                }
                
                // 2. æŠ•è³‡åŠ¹ç‡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
                if (typeof InvestmentEfficiencyCalculator !== 'undefined') {
                    const efficiencyData = {
                        odds: firstHorse.odds,
                        winProbability: 1.0,
                        betAmount: 1000,
                        confidence: 0.8,
                        popularity: firstHorse.popularity || estimatePopularityFromOdds(firstHorse.odds)
                    };
                    
                    const efficiencyResult = InvestmentEfficiencyCalculator.calculateSingleBetEfficiency(efficiencyData);
                    if (efficiencyResult.isUnderdog) {
                        messages.push(`ğŸ ç©´é¦¬çš„ä¸­ï¼ã‚¹ã‚³ã‚¢: ${efficiencyResult.efficiencyScore}`);
                    }
                    log('æŠ•è³‡åŠ¹ç‡ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ: SUCCESS');
                }
                
                testDiv.innerHTML = `
                    <div class="success">
                        âœ… çµ±åˆå‡¦ç†ãƒ†ã‚¹ãƒˆæˆåŠŸ<br>
                        ${messages.join('<br>')}
                        <br><br>
                        <div class="info">
                            ãƒ†ã‚¹ãƒˆé¦¬: ${firstHorse.name}<br>
                            ã‚ªãƒƒã‚º: ${firstHorse.odds}å€<br>
                            æ¨å®šäººæ°—: ${estimatePopularityFromOdds(firstHorse.odds)}ç•ªäººæ°—
                        </div>
                    </div>
                `;
                
                log('çµ±åˆå‡¦ç†ãƒ†ã‚¹ãƒˆå®Œäº†');
                
            } catch (error) {
                testDiv.innerHTML = `<div class="error">âŒ ${error.message}</div>`;
                log(`çµ±åˆå‡¦ç†ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
        document.addEventListener('DOMContentLoaded', () => {
            log('Phase 1çµ±åˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
            log(`CONFIGå¤‰æ•°å­˜åœ¨ç¢ºèª: ${typeof CONFIG !== 'undefined'}`);
            if (typeof CONFIG !== 'undefined') {
                log(`CONFIG.LEARNING_RATE: ${CONFIG.LEARNING_RATE}`);
            }
            
            setTimeout(() => {
                testSystemLoading();
            }, 1000);
        });
    </script>
</body>
</html>