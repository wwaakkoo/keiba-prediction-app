<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 7: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .control-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: scale(1.05);
        }
        .btn-primary { background: linear-gradient(45deg, #2196f3, #1976d2); }
        .btn-success { background: linear-gradient(45deg, #4caf50, #388e3c); }
        .btn-warning { background: linear-gradient(45deg, #ff9800, #f57c00); }
        .btn-danger { background: linear-gradient(45deg, #f44336, #d32f2f); }
        .test-log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="color: #1976d2; text-align: center;">ğŸ¯ Phase 7: Kelly Criterion ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ğŸ® ãƒ†ã‚¹ãƒˆæ“ä½œãƒ‘ãƒãƒ«</h2>
            <div class="control-buttons">
                <button class="btn btn-primary" onclick="initializeDashboard()">
                    ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
                </button>
                <button class="btn btn-success" onclick="updateWithSampleData()">
                    ğŸ“ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°
                </button>
                <button class="btn btn-warning" onclick="simulateKellyUpdate()">
                    âš¡ Kelly ãƒ‡ãƒ¼ã‚¿æ›´æ–°
                </button>
                <button class="btn btn-danger" onclick="clearDashboard()">
                    ğŸ—‘ï¸ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ¶ˆå»
                </button>
            </div>
            
            <div class="control-buttons">
                <button class="btn btn-primary" onclick="testRealTimeUpdates()">
                    ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãƒ†ã‚¹ãƒˆ
                </button>
                <button class="btn btn-success" onclick="generatePerformanceData()">
                    ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
                </button>
                <button class="btn btn-warning" onclick="simulateRiskAdjustment()">
                    âš–ï¸ ãƒªã‚¹ã‚¯èª¿æ•´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                </button>
                <button class="btn btn-danger" onclick="resetAllData()">
                    ğŸ’¥ å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
                </button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h2>
            <div id="testLog" class="test-log">ãƒ†ã‚¹ãƒˆé–‹å§‹ã‚’å¾…æ©Ÿä¸­...\n</div>
        </div>

        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠï¼ˆã“ã“ã«å‹•çš„ç”Ÿæˆï¼‰ -->
        <div id="dashboardTestArea">
            <div class="test-section">
                <h2>ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢</h2>
                <p style="color: #666; text-align: center;">ã€Œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã“ã“ã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
        </div>
    </div>

    <!-- Phase 7 Dashboard Script -->
    <script src="js/portfolioDashboard.js"></script>
    
    <script>
        let dashboardInstance = null;
        let testLogElement = null;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            testLogElement = document.getElementById('testLog');
            log('âœ… Phase 7ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸åˆæœŸåŒ–å®Œäº†');
            log('ğŸ“Š PortfolioDashboard ã‚¯ãƒ©ã‚¹åˆ©ç”¨å¯èƒ½: ' + (typeof PortfolioDashboard !== 'undefined'));
        });

        // ãƒ­ã‚°å‡ºåŠ›
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            if (testLogElement) {
                testLogElement.textContent += logMessage + '\n';
                testLogElement.scrollTop = testLogElement.scrollHeight;
            }
            console.log(logMessage);
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
        function initializeDashboard() {
            log('ğŸ¯ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–é–‹å§‹...');
            
            try {
                if (dashboardInstance) {
                    dashboardInstance.stopRealTimeUpdates();
                }
                
                dashboardInstance = new PortfolioDashboard();
                dashboardInstance.initialize();
                
                log('âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–å®Œäº†');
            } catch (error) {
                log('âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message);
                console.error('Dashboard initialization error:', error);
            }
        }

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        function updateWithSampleData() {
            log('ğŸ“ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°é–‹å§‹...');
            
            if (!dashboardInstance) {
                log('âš ï¸ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœªåˆæœŸåŒ–ã€‚åˆæœŸåŒ–ã‚’å®Ÿè¡Œã—ã¾ã™...');
                initializeDashboard();
                return;
            }

            try {
                dashboardInstance.generateSampleData();
                dashboardInstance.renderDashboard();
                log('âœ… ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†');
            } catch (error) {
                log('âŒ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // Kelly ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateKellyUpdate() {
            log('âš¡ Kelly ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹...');

            // ã‚µãƒ³ãƒ—ãƒ«Kellyãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            const sampleKellyData = {
                totalInvestment: 4200 + Math.random() * 1000,
                expectedReturn: 4800 + Math.random() * 1200,
                mainCandidates: [
                    { name: 'ãƒ†ã‚¹ãƒˆé¦¬A', kellyRatio: 0.09, investment: 900, expectedValue: 1.18 },
                    { name: 'ãƒ†ã‚¹ãƒˆé¦¬B', kellyRatio: 0.06, investment: 600, expectedValue: 1.12 }
                ],
                optionalCandidates: [
                    { name: 'ãƒ†ã‚¹ãƒˆé¦¬C', kellyRatio: 0.04, investment: 400, expectedValue: 1.15 },
                    { name: 'ãƒ†ã‚¹ãƒˆé¦¬D', kellyRatio: 0.025, investment: 250, expectedValue: 1.08 }
                ],
                riskMultiplier: 0.5 + Math.random() * 1.0,
                conflictResolutions: ['3R-ç«¶åˆè§£æ±º', '7R-ã‚ªãƒƒã‚ºæ›´æ–°'],
                portfolioSpread: Math.random() * 0.8 + 0.2,
                avgKellyRatio: 0.03 + Math.random() * 0.05
            };

            localStorage.setItem('kellyPortfolioResults', JSON.stringify(sampleKellyData));

            if (dashboardInstance) {
                dashboardInstance.manualUpdate();
                log('âœ… Kelly ãƒ‡ãƒ¼ã‚¿æ›´æ–°å®Œäº†');
            } else {
                log('âš ï¸ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœªåˆæœŸåŒ–');
            }
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ¶ˆå»
        function clearDashboard() {
            log('ğŸ—‘ï¸ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ¶ˆå»é–‹å§‹...');

            if (dashboardInstance) {
                dashboardInstance.stopRealTimeUpdates();
                dashboardInstance = null;
            }

            const container = document.getElementById('portfolioDashboardContainer');
            if (container) {
                container.remove();
                log('âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ¶ˆå»å®Œäº†');
            } else {
                log('âš ï¸ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãƒ†ã‚¹ãƒˆ
        function testRealTimeUpdates() {
            log('ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãƒ†ã‚¹ãƒˆé–‹å§‹...');

            if (!dashboardInstance) {
                log('âš ï¸ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœªåˆæœŸåŒ–');
                return;
            }

            dashboardInstance.startRealTimeUpdates();
            log('âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°é–‹å§‹ï¼ˆ30ç§’é–“éš”ï¼‰');

            // 10ç§’å¾Œã«ä¸€åº¦æ‰‹å‹•æ›´æ–°ã‚’ãƒ†ã‚¹ãƒˆ
            setTimeout(() => {
                simulateKellyUpdate();
                log('âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿æ›´æ–°');
            }, 10000);
        }

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generatePerformanceData() {
            log('ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–‹å§‹...');

            const performanceData = Array.from({length: 30}, (_, i) => ({
                raceId: `R${i + 1}`,
                date: new Date(Date.now() - (29 - i) * 24 * 60 * 60 * 1000).toLocaleDateString(),
                winRate: Math.random() * 0.5 + 0.1,
                roi: (Math.random() - 0.4) * 0.6,
                cumulativeReturn: i * 150 + Math.random() * 800,
                totalInvestment: 1200 + Math.random() * 1800,
                riskMultiplier: Math.random() * 1.0 + 0.3
            }));

            localStorage.setItem('phase7PerformanceHistory', JSON.stringify(performanceData));

            if (dashboardInstance) {
                dashboardInstance.manualUpdate();
                log('âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ»æ›´æ–°å®Œäº†');
            }
        }

        // ãƒªã‚¹ã‚¯èª¿æ•´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateRiskAdjustment() {
            log('âš–ï¸ ãƒªã‚¹ã‚¯èª¿æ•´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹...');

            const riskAdjustmentData = Array.from({length: 15}, (_, i) => ({
                date: new Date(Date.now() - (14 - i) * 6 * 60 * 60 * 1000).toLocaleDateString(),
                multiplier: Math.random() * 1.0 + 0.3,
                trigger: ['é€£æ•—æ¤œå‡º', 'é«˜å‹ç‡ç¶™ç¶š', 'ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³è­¦å‘Š', 'å¥½èª¿ç¶™ç¶š', 'ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£å¢—åŠ '][Math.floor(Math.random() * 5)],
                reason: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã«åŸºã¥ãè‡ªå‹•èª¿æ•´',
                previousMultiplier: Math.random() * 1.0 + 0.3
            }));

            localStorage.setItem('phase7RiskAdjustmentHistory', JSON.stringify(riskAdjustmentData));

            if (dashboardInstance) {
                dashboardInstance.manualUpdate();
                log('âœ… ãƒªã‚¹ã‚¯èª¿æ•´ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ»æ›´æ–°å®Œäº†');
            }
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
        function resetAllData() {
            log('ğŸ’¥ å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆé–‹å§‹...');

            localStorage.removeItem('kellyPortfolioResults');
            localStorage.removeItem('phase7PerformanceHistory');
            localStorage.removeItem('phase7RiskAdjustmentHistory');

            if (dashboardInstance) {
                dashboardInstance.manualUpdate();
            }

            log('âœ… å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆå®Œäº†');
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1': e.preventDefault(); initializeDashboard(); break;
                    case '2': e.preventDefault(); updateWithSampleData(); break;
                    case '3': e.preventDefault(); simulateKellyUpdate(); break;
                    case '4': e.preventDefault(); clearDashboard(); break;
                }
            }
        });

        // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        setTimeout(() => {
            log('ğŸ’¡ æ“ä½œæ–¹æ³•:');
            log('   - ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å„æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ');
            log('   - Ctrl+1: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–');
            log('   - Ctrl+2: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æ›´æ–°');
            log('   - Ctrl+3: Kelly ãƒ‡ãƒ¼ã‚¿æ›´æ–°');
            log('   - Ctrl+4: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ¶ˆå»');
        }, 1000);
    </script>
</body>
</html>