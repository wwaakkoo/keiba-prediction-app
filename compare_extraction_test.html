<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¡€çµ±æŠ½å‡ºæ¯”è¼ƒãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .comparison { display: flex; gap: 20px; }
        .comparison > div { flex: 1; border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ è¡€çµ±æŠ½å‡ºæ¯”è¼ƒãƒ†ã‚¹ãƒˆ</h1>
    <p>å…ƒã®æˆåŠŸãƒ†ã‚¹ãƒˆ (PedigreeExtractor) vs çµ±åˆãƒ†ã‚¹ãƒˆ (DataConverter) ã®è©³ç´°æ¯”è¼ƒ</p>
    
    <button onclick="runComparisonTest()">æ¯”è¼ƒãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    <div id="results" class="result"></div>

    <script src="pedigree-test/pedigreeExtractor.js"></script>
    <script src="js/dataConverter.js"></script>
    <script>
        function runComparisonTest() {
            const resultsDiv = document.getElementById('results');
            
            console.log('=== è¡€çµ±æŠ½å‡ºæ¯”è¼ƒãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            
            // åŒã˜ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            const testData = `1\t1\t
æ¶ˆ
ãƒ­ãƒ¼ãƒ‰ã‚«ãƒŠãƒ­ã‚¢
ãƒ™ãƒ©ã‚¸ã‚ªã‚ªãƒšãƒ©
ã‚¨ã‚¢ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãƒ³
(ãƒãƒ¼ãƒ“ãƒ³ã‚¸ãƒ£ãƒ¼)
æ —æ±ãƒ»ä¸Šæ‘  
å…ˆä¸­9é€±
510kg(+2)
4.0 (1äººæ°—)
ç‰¡5é¹¿

æ¨ªå±±å’Œ
58.0\t
1\t2\t
æ¶ˆ
ãƒ‰ã‚¥ãƒ©ãƒ¡ãƒ³ãƒ†
ãƒ‰ã‚¥ãƒ¬ãƒƒãƒ„ã‚¡
ãƒ¢ã‚¢ã‚¶ãƒ³ã‚»ã‚¤ã‚¯ãƒªãƒƒãƒ‰
(More Than Ready)
ç¾æµ¦ãƒ»å°¾é–¢  
å…ˆä¸­9é€±
468kg(å‰è¨ˆä¸)
6.7 (4äººæ°—)
ç‰¡5é’é¹¿

æ¨ªå±±æ­¦
58.0\t`;

            let html = '<h3>ğŸ“Š è¡€çµ±æŠ½å‡ºæ¯”è¼ƒçµæœ</h3>';
            
            try {
                // 1. å…ƒã®æˆåŠŸãƒ†ã‚¹ãƒˆ (PedigreeExtractor)
                console.log('=== PedigreeExtractor ãƒ†ã‚¹ãƒˆ ===');
                const pedigreeResults = PedigreeExtractor.parseAllHorses(testData);
                console.log('PedigreeExtractorçµæœ:', pedigreeResults);
                
                // 2. çµ±åˆãƒ†ã‚¹ãƒˆ (DataConverter)
                console.log('=== DataConverter ãƒ†ã‚¹ãƒˆ ===');
                const dataConverterResult = DataConverter.parseNetkeibaData(testData);
                console.log('DataConverterçµæœ:', dataConverterResult);
                
                // 3. æ¯”è¼ƒåˆ†æ
                const dataConverterHorses = dataConverterResult.horses || [];
                
                html += '<div class="comparison">';
                
                // PedigreeExtractorçµæœ
                html += '<div>';
                html += '<h4>ğŸ¯ PedigreeExtractor (æˆåŠŸãƒ†ã‚¹ãƒˆ)</h4>';
                html += `<p><strong>æŠ½å‡ºé¦¬æ•°:</strong> ${pedigreeResults.length}é ­</p>`;
                html += `<p><strong>ãƒ‡ãƒ¼ã‚¿å‹:</strong> ${Array.isArray(pedigreeResults) ? 'Array' : 'Object'}</p>`;
                
                pedigreeResults.forEach((horse, index) => {
                    const pedigreeCount = [horse.sire, horse.dam, horse.damSire].filter(x => x).length;
                    const rate = ((pedigreeCount / 3) * 100).toFixed(1);
                    
                    html += `
                        <div style="border: 1px solid #ddd; padding: 8px; margin: 5px 0; font-size: 12px;">
                            <strong>é¦¬${index + 1}:</strong> ${horse.name || 'æœªæŠ½å‡º'}<br>
                            <strong>çˆ¶:</strong> ${horse.sire || 'æœªæŠ½å‡º'}<br>
                            <strong>æ¯:</strong> ${horse.dam || 'æœªæŠ½å‡º'}<br>
                            <strong>æ¯çˆ¶:</strong> ${horse.damSire || 'æœªæŠ½å‡º'}<br>
                            <strong>æŠ½å‡ºç‡:</strong> ${rate}%
                        </div>
                    `;
                });
                html += '</div>';
                
                // DataConverterçµæœ
                html += '<div>';
                html += '<h4>ğŸ”§ DataConverter (çµ±åˆãƒ†ã‚¹ãƒˆ)</h4>';
                html += `<p><strong>æŠ½å‡ºé¦¬æ•°:</strong> ${dataConverterHorses.length}é ­</p>`;
                html += `<p><strong>ãƒ‡ãƒ¼ã‚¿å‹:</strong> ${Array.isArray(dataConverterResult) ? 'Array' : 'Object'}</p>`;
                html += `<p><strong>æ§‹é€ :</strong> { raceInfo: ${dataConverterResult.raceInfo ? 'ã‚ã‚Š' : 'ãªã—'}, horses: Array }</p>`;
                
                dataConverterHorses.forEach((horse, index) => {
                    const pedigreeCount = [horse.sire, horse.dam, horse.damSire].filter(x => x).length;
                    const rate = ((pedigreeCount / 3) * 100).toFixed(1);
                    
                    html += `
                        <div style="border: 1px solid #ddd; padding: 8px; margin: 5px 0; font-size: 12px;">
                            <strong>é¦¬${index + 1}:</strong> ${horse.name || 'æœªæŠ½å‡º'}<br>
                            <strong>çˆ¶:</strong> ${horse.sire || 'æœªæŠ½å‡º'}<br>
                            <strong>æ¯:</strong> ${horse.dam || 'æœªæŠ½å‡º'}<br>
                            <strong>æ¯çˆ¶:</strong> ${horse.damSire || 'æœªæŠ½å‡º'}<br>
                            <strong>æŠ½å‡ºç‡:</strong> ${rate}%
                        </div>
                    `;
                });
                html += '</div>';
                
                html += '</div>'; // comparisonçµ‚äº†
                
                // 4. å·®åˆ†åˆ†æ
                html += '<h4>ğŸ” å·®åˆ†åˆ†æ</h4>';
                const differences = [];
                
                // é¦¬æ•°æ¯”è¼ƒ
                if (pedigreeResults.length !== dataConverterHorses.length) {
                    differences.push(`é¦¬æ•°ã®é•ã„: PedigreeExtractor=${pedigreeResults.length}é ­ vs DataConverter=${dataConverterHorses.length}é ­`);
                }
                
                // å„é¦¬ã®è©³ç´°æ¯”è¼ƒ
                const maxHorses = Math.max(pedigreeResults.length, dataConverterHorses.length);
                for (let i = 0; i < maxHorses; i++) {
                    const pHorse = pedigreeResults[i];
                    const dHorse = dataConverterHorses[i];
                    
                    if (!pHorse && dHorse) {
                        differences.push(`é¦¬${i + 1}: PedigreeExtractorã«å­˜åœ¨ã—ãªã„é¦¬ãŒDataConverterã«ã‚ã‚Š`);
                    } else if (pHorse && !dHorse) {
                        differences.push(`é¦¬${i + 1}: DataConverterã«å­˜åœ¨ã—ãªã„é¦¬ãŒPedigreeExtractorã«ã‚ã‚Š`);
                    } else if (pHorse && dHorse) {
                        ['name', 'sire', 'dam', 'damSire'].forEach(field => {
                            if (pHorse[field] !== dHorse[field]) {
                                differences.push(`é¦¬${i + 1}ã®${field}: PedigreeExtractor="${pHorse[field] || 'ãªã—'}" vs DataConverter="${dHorse[field] || 'ãªã—'}"`);
                            }
                        });
                    }
                }
                
                if (differences.length === 0) {
                    html += '<p class="success">âœ… ä¸¡æ–¹ã®çµæœãŒå®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ã¾ã™ï¼</p>';
                } else {
                    html += '<div class="error">';
                    html += '<p>âŒ ä»¥ä¸‹ã®é•ã„ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:</p>';
                    html += '<ul>';
                    differences.forEach(diff => {
                        html += `<li>${diff}</li>`;
                    });
                    html += '</ul>';
                    html += '</div>';
                }
                
                // 5. é–¢æ•°å‘¼ã³å‡ºã—æƒ…å ±
                html += '<h4>ğŸ“‹ é–¢æ•°å‘¼ã³å‡ºã—æƒ…å ±</h4>';
                html += '<ul>';
                html += '<li><strong>PedigreeExtractor:</strong> PedigreeExtractor.parseAllHorses(testData) â†’ Array</li>';
                html += '<li><strong>DataConverter:</strong> DataConverter.parseNetkeibaData(testData) â†’ { raceInfo, horses }</li>';
                html += '</ul>';
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ</h3>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
                console.error('æ¯”è¼ƒãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆ©ç”¨å¯èƒ½ãªé–¢æ•°ã‚’ç¢ºèª
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== åˆ©ç”¨å¯èƒ½ãªé–¢æ•°ç¢ºèª ===');
            console.log('PedigreeExtractor:', typeof PedigreeExtractor);
            console.log('PedigreeExtractor.parseAllHorses:', typeof PedigreeExtractor?.parseAllHorses);
            console.log('DataConverter:', typeof DataConverter);
            console.log('DataConverter.parseNetkeibaData:', typeof DataConverter?.parseNetkeibaData);
        });
    </script>
</body>
</html>