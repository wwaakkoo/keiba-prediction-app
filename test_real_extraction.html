<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Ÿéš›ã®è¡€çµ±æŠ½å‡ºãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        textarea { width: 100%; padding: 10px; font-family: monospace; font-size: 12px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .result { background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>ğŸ§ª è¡€çµ±æŠ½å‡ºå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="section">
        <h2>ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
        <div class="form-group">
            <label>netkeibaå½¢å¼ãƒ‡ãƒ¼ã‚¿:</label>
            <textarea id="testInput" rows="15">1    1    
--
ã‚­ã‚¿ã‚µãƒ³ãƒ–ãƒ©ãƒƒã‚¯
ã‚µãƒˆãƒã‚¨ãƒ”ãƒƒã‚¯
ãƒ©ãƒ³ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¼
(Bellamy Road)
ç¾æµ¦ãƒ»å›½æ  
å·®ä¸­13é€±
536kg(+8)
25.5 (7äººæ°—)
ç‰¡4é¹¿

ãƒ‡ã‚£ãƒ¼
57.0

2    2    
â—
ãƒ‡ã‚£ãƒ¼ãƒ—ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ
ãƒªã‚¢ãƒ«ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«
ãƒ—ãƒªãƒ³ã‚»ã‚¹ã‚ªãƒªãƒ“ã‚¢
(Storm Cat)
æ —æ±ãƒ»æ± æ±Ÿ  
å…ˆä¸­8é€±
498kg(-2)
3.2 (1äººæ°—)
ç‰¡5é»’é¹¿

æ­¦è±Š
58.0</textarea>
        </div>
        <button onclick="testExtraction()">ğŸš€ æŠ½å‡ºãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ çµæœã‚¯ãƒªã‚¢</button>
    </div>
    
    <div id="results" class="section" style="display: none;">
        <h2>ğŸ“Š æŠ½å‡ºçµæœ</h2>
        <div id="resultContent"></div>
    </div>
    
    <script>
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºé–¢æ•°
        function showMessage(msg, type = 'info') {
            console.log(`${type}: ${msg}`);
        }
        
        // HorseManagerã®ãƒ¢ãƒƒã‚¯
        window.HorseManager = {
            addHorseFromData: function(horse) {
                console.log('é¦¬ãƒ‡ãƒ¼ã‚¿å—ä¿¡:', horse);
            }
        };
    </script>
    
    <script src="js/dataConverter.js"></script>
    
    <script>
        function testExtraction() {
            const testData = document.getElementById('testInput').value;
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultContent');
            
            console.log('=== è¡€çµ±æŠ½å‡ºãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
            console.log('å…¥åŠ›ãƒ‡ãƒ¼ã‚¿:', testData);
            
            try {
                // DataConverterã§æŠ½å‡ºå®Ÿè¡Œ
                const result = DataConverter.parseNetkeibaData(testData);
                console.log('æŠ½å‡ºçµæœ:', result);
                
                let html = '<h3>ğŸ“Š è¡€çµ±æŠ½å‡ºçµæœ</h3>';
                
                result.horses.forEach((horse, index) => {
                    const pedigreeCount = [horse.sire, horse.dam, horse.damSire].filter(x => x).length;
                    const rate = ((pedigreeCount / 3) * 100).toFixed(1);
                    const status = rate >= 80 ? 'success' : rate >= 50 ? 'warning' : 'error';
                    
                    html += `
                        <div class="result ${status}">
                            <h4>é¦¬${index + 1}: ${horse.name || 'æœªæŠ½å‡º'}</h4>
                            <p><strong>çˆ¶:</strong> ${horse.sire || 'æœªæŠ½å‡º'}</p>
                            <p><strong>æ¯:</strong> ${horse.dam || 'æœªæŠ½å‡º'}</p>
                            <p><strong>æ¯çˆ¶:</strong> ${horse.damSire || 'æœªæŠ½å‡º'}</p>
                            <p><strong>ã‚ªãƒƒã‚º:</strong> ${horse.odds || 'æœªæŠ½å‡º'}å€</p>
                            <p><strong>è„šè³ª:</strong> ${horse.runningStyle || 'æœªæŠ½å‡º'}</p>
                            <p><strong>ä½“é‡å¤‰åŒ–:</strong> ${horse.weightChange || 0}kg</p>
                            <p><strong>è¡€çµ±æŠ½å‡ºç‡:</strong> ${pedigreeCount}/3 (${rate}%)</p>
                            <p><strong>åˆ¤å®š:</strong> ${rate >= 80 ? 'âœ… æŠ½å‡ºè‰¯å¥½' : rate >= 50 ? 'âš ï¸ æŠ½å‡ºä¸å®Œå…¨' : 'âŒ æŠ½å‡ºå¤±æ•—'}</p>
                        </div>
                    `;
                });
                
                // æœŸå¾…çµæœã¨ã®æ¯”è¼ƒ
                const horse1 = result.horses[0];
                html += `
                    <div class="result">
                        <h4>ğŸ” æœŸå¾…çµæœã¨ã®æ¯”è¼ƒ</h4>
                        <p>é¦¬å: ${horse1?.name === 'ã‚µãƒˆãƒã‚¨ãƒ”ãƒƒã‚¯' ? 'âœ…' : 'âŒ'} (æœŸå¾…: ã‚µãƒˆãƒã‚¨ãƒ”ãƒƒã‚¯, å®Ÿéš›: ${horse1?.name})</p>
                        <p>çˆ¶: ${horse1?.sire === 'ã‚­ã‚¿ã‚µãƒ³ãƒ–ãƒ©ãƒƒã‚¯' ? 'âœ…' : 'âŒ'} (æœŸå¾…: ã‚­ã‚¿ã‚µãƒ³ãƒ–ãƒ©ãƒƒã‚¯, å®Ÿéš›: ${horse1?.sire})</p>
                        <p>æ¯: ${horse1?.dam === 'ãƒ©ãƒ³ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¼' ? 'âœ…' : 'âŒ'} (æœŸå¾…: ãƒ©ãƒ³ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ã‚·ãƒ¼, å®Ÿéš›: ${horse1?.dam})</p>
                        <p>æ¯çˆ¶: ${horse1?.damSire === 'Bellamy Road' ? 'âœ…' : 'âŒ'} (æœŸå¾…: Bellamy Road, å®Ÿéš›: ${horse1?.damSire})</p>
                    </div>
                `;
                
                // å…¨ä½“çµ±è¨ˆ
                const totalPedigree = result.horses.reduce((sum, horse) => {
                    return sum + [horse.sire, horse.dam, horse.damSire].filter(x => x).length;
                }, 0);
                const maxPedigree = result.horses.length * 3;
                const overallRate = ((totalPedigree / maxPedigree) * 100).toFixed(1);
                
                html += `
                    <div class="result ${overallRate >= 80 ? 'success' : 'error'}">
                        <h4>ğŸ“ˆ å…¨ä½“çµ±è¨ˆ</h4>
                        <p><strong>ç·åˆè¡€çµ±æŠ½å‡ºç‡:</strong> ${totalPedigree}/${maxPedigree} (${overallRate}%)</p>
                        <p><strong>æŠ½å‡ºã•ã‚ŒãŸé¦¬æ•°:</strong> ${result.horses.length}é ­</p>
                        <p><strong>æœ€çµ‚åˆ¤å®š:</strong> ${overallRate >= 80 ? 'âœ… è¡€çµ±æŠ½å‡ºæˆåŠŸï¼' : 'âš ï¸ æ”¹å–„ãŒå¿…è¦'}</p>
                    </div>
                `;
                
                contentDiv.innerHTML = html;
                resultsDiv.style.display = 'block';
                
            } catch (error) {
                contentDiv.innerHTML = `<div class="result error">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                resultsDiv.style.display = 'block';
                console.error('æŠ½å‡ºã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        function clearResults() {
            document.getElementById('results').style.display = 'none';
        }
        
        // åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        console.log('âœ… è¡€çµ±æŠ½å‡ºãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº†');
        console.log('ã€ŒæŠ½å‡ºãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„');
    </script>
</body>
</html>