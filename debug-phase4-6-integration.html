<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4-6çµ±åˆå­¦ç¿’ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #007bff;
        }
        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
        }
        .result {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #c62828;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ Phase 4-6çµ±åˆå­¦ç¿’ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="section">
            <h2>ğŸ“‹ å‹•ä½œç¢ºèªæ¦‚è¦</h2>
            <p>çµ±åˆå­¦ç¿’ã®è‡ªå‹•Phase 4-6å®Ÿè¡Œæ©Ÿèƒ½ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
            <div class="warning">
                <strong>âš ï¸ æ³¨æ„:</strong> ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å‰ã«ã€ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã§é¦¬ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã¨äºˆæ¸¬å®Ÿè¡Œã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚
            </div>
        </div>

        <div class="section">
            <h3>ğŸ” äº‹å‰çŠ¶æ…‹ç¢ºèª</h3>
            <button class="btn" onclick="checkPrerequisites()">ğŸ“Š å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯</button>
            <div id="prerequisitesResult"></div>
        </div>

        <div class="section">
            <h3>ğŸš€ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°çŠ¶æ…‹ç¢ºèª</h3>
            <button class="btn" onclick="checkGlobalVariables()">ğŸ” Phase 4-6å¤‰æ•°ç¢ºèª</button>
            <div id="globalVariablesResult"></div>
        </div>

        <div class="section">
            <h3>ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèª</h3>
            <button class="btn" onclick="checkLocalStorage()">ğŸ“¦ ä¿å­˜ãƒ‡ãƒ¼ã‚¿ç¢ºèª</button>
            <div id="localStorageResult"></div>
        </div>

        <div class="section">
            <h3>ğŸ§ª é–¢æ•°å®Ÿè¡Œãƒ†ã‚¹ãƒˆ</h3>
            <button class="btn" onclick="testPhase4Function()">ğŸ“Š Phase 4é–¢æ•°ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn" onclick="testPhase6Function()">ğŸ’° Phase 6é–¢æ•°ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn" onclick="testUnifiedLearning()">ğŸš€ çµ±åˆå­¦ç¿’ãƒ†ã‚¹ãƒˆ</button>
            <div id="functionTestResult"></div>
        </div>

        <div class="section">
            <h3>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</h3>
            <button class="btn" onclick="testPerformanceDisplay()">ğŸ“Š å…¨çµ±è¨ˆè¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
            <div id="performanceTestResult"></div>
        </div>

        <div class="section">
            <h3>ğŸ§¹ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</h3>
            <button class="btn" onclick="clearTestData()" style="background: linear-gradient(45deg, #f44336, #d32f2f);">ğŸ—‘ï¸ å…¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
            <div id="clearDataResult"></div>
        </div>
    </div>

    <script>
        function checkPrerequisites() {
            const resultDiv = document.getElementById('prerequisitesResult');
            
            try {
                let result = '<div class="result">';
                result += '=== å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯çµæœ ===\n';
                
                // PredictionEngineã®ç¢ºèª
                if (typeof PredictionEngine !== 'undefined') {
                    const predictions = PredictionEngine.getCurrentPredictions();
                    result += `âœ… PredictionEngine: åˆ©ç”¨å¯èƒ½\n`;
                    result += `ğŸ“Š ç¾åœ¨ã®äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿: ${predictions ? predictions.length : 0}é ­\n`;
                } else {
                    result += `âŒ PredictionEngine: æœªå®šç¾©\n`;
                }
                
                // å¿…è¦ãªã‚¯ãƒ©ã‚¹ã®ç¢ºèª
                const requiredClasses = [
                    'PerformanceTracker',
                    'KellyCapitalManager', 
                    'CalibrationSystem',
                    'EnhancedPredictionEngine'
                ];
                
                result += '\nğŸ“‹ å¿…è¦ãªã‚¯ãƒ©ã‚¹ã®ç¢ºèª:\n';
                requiredClasses.forEach(className => {
                    if (typeof window[className] !== 'undefined') {
                        result += `  âœ… ${className}: åˆ©ç”¨å¯èƒ½\n`;
                    } else {
                        result += `  âŒ ${className}: æœªå®šç¾©\n`;
                    }
                });
                
                // å¿…è¦ãªé–¢æ•°ã®ç¢ºèª
                const requiredFunctions = [
                    'showPhase4DynamicStrategy',
                    'showPhase6KellyCapitalAnalysis',
                    'processUnifiedRaceResult'
                ];
                
                result += '\nğŸ”§ å¿…è¦ãªé–¢æ•°ã®ç¢ºèª:\n';
                requiredFunctions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        result += `  âœ… ${funcName}: å®šç¾©æ¸ˆã¿\n`;
                    } else {
                        result += `  âŒ ${funcName}: æœªå®šç¾©\n`;
                    }
                });
                
                result += '</div>';
                resultDiv.innerHTML = result;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function checkGlobalVariables() {
            const resultDiv = document.getElementById('globalVariablesResult');
            
            try {
                let result = '<div class="result">';
                result += '=== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°çŠ¶æ…‹ ===\n';
                
                // Phase 4å¤‰æ•°
                if (window.lastDynamicBettingResult) {
                    result += 'âœ… window.lastDynamicBettingResult: å­˜åœ¨\n';
                    result += `ğŸ“Š æ¨å¥¨æ•°: ${window.lastDynamicBettingResult.recommendations?.length || 0}\n`;
                    result += `ğŸ’° ç·æŠ•è³‡é¡: ${window.lastDynamicBettingResult.totalAmount || 0}å††\n`;
                } else {
                    result += 'âŒ window.lastDynamicBettingResult: æœªè¨­å®š\n';
                }
                
                // Phase 6å¤‰æ•°
                if (window.lastKellyAnalysis) {
                    result += '\nâœ… window.lastKellyAnalysis: å­˜åœ¨\n';
                    result += `ğŸ“Š æ¨å¥¨æ•°: ${window.lastKellyAnalysis.recommendations?.length || 0}\n`;
                    result += `ğŸ’° ç¾åœ¨è³‡é‡‘: ${window.lastKellyAnalysis.capital || 'N/A'}å††\n`;
                } else {
                    result += '\nâŒ window.lastKellyAnalysis: æœªè¨­å®š\n';
                }
                
                result += '</div>';
                resultDiv.innerHTML = result;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function checkLocalStorage() {
            const resultDiv = document.getElementById('localStorageResult');
            
            try {
                let result = '<div class="result">';
                result += '=== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèª ===\n';
                
                // Phase 4ãƒ‡ãƒ¼ã‚¿
                const phase4Data = localStorage.getItem('keiba_race_history');
                if (phase4Data) {
                    const data = JSON.parse(phase4Data);
                    result += `âœ… Phase 4ãƒ‡ãƒ¼ã‚¿: ${data.length}ä»¶ã®ãƒ¬ãƒ¼ã‚¹å±¥æ­´\n`;
                } else {
                    result += `âŒ Phase 4ãƒ‡ãƒ¼ã‚¿: ãªã—\n`;
                }
                
                // Phase 5ãƒ‡ãƒ¼ã‚¿
                const phase5Data = localStorage.getItem('phase5_calibration_data');
                if (phase5Data) {
                    const data = JSON.parse(phase5Data);
                    const totalSamples = Object.values(data.calibrationData || {})
                        .reduce((sum, bucket) => sum + (bucket.totalPredictions || 0), 0);
                    result += `âœ… Phase 5ãƒ‡ãƒ¼ã‚¿: ${totalSamples}ã‚µãƒ³ãƒ—ãƒ«\n`;
                } else {
                    result += `âŒ Phase 5ãƒ‡ãƒ¼ã‚¿: ãªã—\n`;
                }
                
                // Phase 6ãƒ‡ãƒ¼ã‚¿
                const phase6Data = localStorage.getItem('kelly_capital_data');
                if (phase6Data) {
                    const data = JSON.parse(phase6Data);
                    result += `âœ… Phase 6ãƒ‡ãƒ¼ã‚¿: ç¾åœ¨è³‡é‡‘${data.currentCapital || 0}å††\n`;
                    result += `ğŸ“ˆ å±¥æ­´ä»¶æ•°: ${data.performanceHistory?.length || 0}ä»¶\n`;
                } else {
                    result += `âŒ Phase 6ãƒ‡ãƒ¼ã‚¿: ãªã—\n`;
                }
                
                result += '</div>';
                resultDiv.innerHTML = result;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function testPhase4Function() {
            const resultDiv = document.getElementById('functionTestResult');
            
            try {
                if (typeof showPhase4DynamicStrategy === 'function') {
                    showPhase4DynamicStrategy();
                    resultDiv.innerHTML = '<div class="result">âœ… Phase 4é–¢æ•°å®Ÿè¡Œå®Œäº†\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ showPhase4DynamicStrategyé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Phase 4é–¢æ•°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function testPhase6Function() {
            const resultDiv = document.getElementById('functionTestResult');
            
            try {
                if (typeof showPhase6KellyCapitalAnalysis === 'function') {
                    showPhase6KellyCapitalAnalysis();
                    resultDiv.innerHTML = '<div class="result">âœ… Phase 6é–¢æ•°å®Ÿè¡Œå®Œäº†\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ showPhase6KellyCapitalAnalysisé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Phase 6é–¢æ•°ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function testUnifiedLearning() {
            const resultDiv = document.getElementById('functionTestResult');
            
            try {
                // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¬ãƒ¼ã‚¹çµæœã‚’è¨­å®š
                if (document.getElementById('unifiedFirst')) {
                    document.getElementById('unifiedFirst').value = '1';
                    document.getElementById('unifiedSecond').value = '2';
                    document.getElementById('unifiedThird').value = '3';
                    
                    if (typeof processUnifiedRaceResult === 'function') {
                        processUnifiedRaceResult();
                        resultDiv.innerHTML = '<div class="result">âœ… çµ±åˆå­¦ç¿’ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„\n\nè¨­å®šå€¤:\n1ç€: 1ç•ª\n2ç€: 2ç•ª\n3ç€: 3ç•ª</div>';
                    } else {
                        resultDiv.innerHTML = '<div class="error">âŒ processUnifiedRaceResulté–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                    }
                } else {
                    resultDiv.innerHTML = '<div class="warning">âš ï¸ ãƒ¡ã‚¤ãƒ³ç”»é¢ã§ãƒ¬ãƒ¼ã‚¹çµæœå…¥åŠ›æ¬„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\nãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦ã‹ã‚‰ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">çµ±åˆå­¦ç¿’ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function testPerformanceDisplay() {
            const resultDiv = document.getElementById('performanceTestResult');
            
            try {
                let result = '<div class="result">';
                result += '=== ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¡¨ç¤ºãƒ†ã‚¹ãƒˆ ===\n';
                
                // Phase 4çµ±è¨ˆãƒ†ã‚¹ãƒˆ
                if (typeof showPhase4PerformanceStats === 'function') {
                    showPhase4PerformanceStats();
                    result += 'âœ… Phase 4çµ±è¨ˆè¡¨ç¤º: å®Ÿè¡Œå®Œäº†\n';
                } else {
                    result += 'âŒ Phase 4çµ±è¨ˆè¡¨ç¤º: é–¢æ•°æœªå®šç¾©\n';
                }
                
                // Phase 5ãƒ‡ãƒ¼ã‚¿çŠ¶æ³ãƒ†ã‚¹ãƒˆ
                if (typeof checkPhase5Data === 'function') {
                    checkPhase5Data();
                    result += 'âœ… Phase 5ãƒ‡ãƒ¼ã‚¿ç¢ºèª: å®Ÿè¡Œå®Œäº†\n';
                } else {
                    result += 'âŒ Phase 5ãƒ‡ãƒ¼ã‚¿ç¢ºèª: é–¢æ•°æœªå®šç¾©\n';
                }
                
                // Phase 6çµ±è¨ˆãƒ†ã‚¹ãƒˆ
                if (typeof showPhase6PerformanceStats === 'function') {
                    showPhase6PerformanceStats();
                    result += 'âœ… Phase 6çµ±è¨ˆè¡¨ç¤º: å®Ÿè¡Œå®Œäº†\n';
                } else {
                    result += 'âŒ Phase 6çµ±è¨ˆè¡¨ç¤º: é–¢æ•°æœªå®šç¾©\n';
                }
                
                result += '\nğŸ“‹ ã‚¢ãƒ©ãƒ¼ãƒˆã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>';
                resultDiv.innerHTML = result;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¡¨ç¤ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        function clearTestData() {
            const resultDiv = document.getElementById('clearDataResult');
            
            if (confirm('å…¨ã¦ã®Phase 4-6ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                try {
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªã‚¢
                    localStorage.removeItem('keiba_race_history');
                    localStorage.removeItem('keiba_strategy_performance');
                    localStorage.removeItem('keiba_monthly_stats');
                    localStorage.removeItem('phase5_calibration_data');
                    localStorage.removeItem('kelly_capital_data');
                    
                    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚¯ãƒªã‚¢
                    window.lastDynamicBettingResult = null;
                    window.lastKellyAnalysis = null;
                    
                    resultDiv.innerHTML = '<div class="result">âœ… å…¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ\n\nå‰Šé™¤é …ç›®:\n- Phase 4ãƒ¬ãƒ¼ã‚¹å±¥æ­´\n- Phase 4æˆ¦ç•¥ãƒ‡ãƒ¼ã‚¿\n- Phase 4æœˆæ¬¡çµ±è¨ˆ\n- Phase 5ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿\n- Phase 6è³‡é‡‘ç®¡ç†ãƒ‡ãƒ¼ã‚¿\n- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°</div>';
                    
                } catch (error) {
                    resultDiv.innerHTML = `<div class="error">ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                }
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è‡ªå‹•ãƒã‚§ãƒƒã‚¯
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”¬ Phase 4-6çµ±åˆå­¦ç¿’ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            setTimeout(checkPrerequisites, 1000);
        });
    </script>
</body>
</html>