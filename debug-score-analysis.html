<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ã‚³ã‚¢åˆ¥çš„ä¸­ç‡åˆ†æãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .section { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #007bff; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .result { background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; margin: 10px 0; border-radius: 8px; white-space: pre-wrap; font-family: monospace; }
        .error { background: #ffebee; border: 1px solid #f44336; padding: 15px; margin: 10px 0; border-radius: 8px; color: #c62828; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ã‚¹ã‚³ã‚¢åˆ¥çš„ä¸­ç‡ãƒ»æœŸå¾…å€¤åˆ†æãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="section">
            <h3>ğŸ“Š 1. ã‚¹ã‚³ã‚¢åˆ¥è¤‡å‹çš„ä¸­ç‡åˆ†æ</h3>
            <button class="btn" onclick="analyzeScoreHitRates()">ã‚¹ã‚³ã‚¢åˆ¥çš„ä¸­ç‡ã‚’åˆ†æ</button>
            <div id="scoreAnalysisResult"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ¯ 2. æœŸå¾…å€¤ä¸Šä½é¦¬ã®çµæœåˆ†æ</h3>
            <button class="btn" onclick="analyzeExpectedValueResults()">æœŸå¾…å€¤ä¸Šä½é¦¬ã®æˆç¸¾ã‚’åˆ†æ</button>
            <div id="expectedValueResult"></div>
        </div>
        
        <div class="section">
            <h3>âš™ï¸ 3. ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢æ§‹æˆè©³ç´°</h3>
            <button class="btn" onclick="analyzeConfidenceScore()">ä¿¡é ¼åº¦è¨ˆç®—ã®å†…è¨³ã‚’åˆ†æ</button>
            <div id="confidenceAnalysisResult"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ”§ 4. æœŸå¾…å€¤è¨ˆç®—ãƒ†ã‚¹ãƒˆ</h3>
            <p>ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã§æœŸå¾…å€¤è¨ˆç®—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</p>
            <button class="btn" onclick="testExpectedValueCalculation()">æœŸå¾…å€¤è¨ˆç®—ã‚’ãƒ†ã‚¹ãƒˆ</button>
            <div id="calculationTestResult"></div>
        </div>
    </div>

    <script>
        function analyzeScoreHitRates() {
            const resultDiv = document.getElementById('scoreAnalysisResult');
            
            try {
                let result = '=== ã‚¹ã‚³ã‚¢åˆ¥è¤‡å‹çš„ä¸­ç‡åˆ†æ ===\n\n';
                
                // LearningSystemã‹ã‚‰å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                if (typeof LearningSystem !== 'undefined' && LearningSystem.learningData) {
                    const learningData = LearningSystem.learningData;
                    
                    result += `ç·å­¦ç¿’ãƒ‡ãƒ¼ã‚¿æ•°: ${learningData.accuracy?.totalPredictions || 0}ãƒ¬ãƒ¼ã‚¹\n`;
                    result += `è¤‡å‹çš„ä¸­æ•°: ${learningData.accuracy?.placePredictions || 0}å›\n`;
                    result += `è¤‡å‹çš„ä¸­ç‡: ${learningData.accuracy?.totalPredictions > 0 ? ((learningData.accuracy.placePredictions / learningData.accuracy.totalPredictions) * 100).toFixed(1) : 0}%\n\n`;
                    
                    // å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¹ã‚³ã‚¢åˆ¥åˆ†æ
                    if (learningData.history && learningData.history.length > 0) {
                        const scoreRanges = [
                            { min: 90, max: 100, label: '90-100' },
                            { min: 80, max: 89, label: '80-89' },
                            { min: 70, max: 79, label: '70-79' },
                            { min: 60, max: 69, label: '60-69' },
                            { min: 50, max: 59, label: '50-59' },
                            { min: 0, max: 49, label: '0-49' }
                        ];
                        
                        result += 'ã€ã‚¹ã‚³ã‚¢åˆ¥çš„ä¸­ç‡åˆ†æã€‘\n';
                        
                        scoreRanges.forEach(range => {
                            const rangeData = analyzeScoreRange(learningData.history, range.min, range.max);
                            if (rangeData.total > 0) {
                                result += `ã‚¹ã‚³ã‚¢${range.label}: ${rangeData.hits}/${rangeData.total} = ${((rangeData.hits/rangeData.total)*100).toFixed(1)}%\n`;
                            }
                        });
                    } else {
                        result += 'å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ã‚ˆã‚Šå¤šãã®ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™ã€‚\n';
                    }
                } else {
                    result += 'LearningSystemãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚\n';
                }
                
                resultDiv.innerHTML = `<div class="result">${result}</div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        function analyzeScoreRange(history, minScore, maxScore) {
            let hits = 0;
            let total = 0;
            
            history.forEach(entry => {
                if (entry.predictedWinner && entry.actualWinner) {
                    const score = entry.predictedWinner.score || entry.predictedWinner.placeProbability || 0;
                    if (score >= minScore && score <= maxScore) {
                        total++;
                        // è¤‡å‹çš„ä¸­åˆ¤å®šï¼ˆ1-3ç€ï¼‰
                        if (entry.placeCorrect || entry.winCorrect) {
                            hits++;
                        }
                    }
                }
            });
            
            return { hits, total };
        }
        
        function analyzeExpectedValueResults() {
            const resultDiv = document.getElementById('expectedValueResult');
            
            try {
                let result = '=== æœŸå¾…å€¤ä¸Šä½é¦¬ã®çµæœåˆ†æ ===\n\n';
                
                // Phase 4ã‚„PerformanceTrackerã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                if (typeof PerformanceTracker !== 'undefined') {
                    const tracker = new PerformanceTracker();
                    const recentRaces = tracker.performanceHistory || [];
                    
                    result += `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å±¥æ­´: ${recentRaces.length}ä»¶\n\n`;
                    
                    if (recentRaces.length > 0) {
                        const recent = recentRaces.slice(-10); // ç›´è¿‘10ãƒ¬ãƒ¼ã‚¹
                        result += 'ã€ç›´è¿‘10ãƒ¬ãƒ¼ã‚¹ã®æœŸå¾…å€¤åˆ†æã€‘\n';
                        
                        recent.forEach((race, index) => {
                            result += `ãƒ¬ãƒ¼ã‚¹${index + 1}: æŠ•è³‡${race.investment}å†† â†’ å›å${race.return}å†† (ROI: ${((race.return/race.investment - 1) * 100).toFixed(1)}%)\n`;
                        });
                    }
                } else {
                    result += 'PerformanceTrackerãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚\n';
                }
                
                // Kellyè³‡é‡‘ç®¡ç†ã‹ã‚‰ã‚‚æƒ…å ±å–å¾—
                if (typeof KellyCapitalManager !== 'undefined') {
                    const manager = new KellyCapitalManager();
                    const report = manager.generateCapitalReport();
                    
                    result += '\nã€Kellyè³‡é‡‘ç®¡ç†çµ±è¨ˆã€‘\n';
                    result += `ç¾åœ¨è³‡é‡‘: ${report.capitalStatus.currentCapital.toLocaleString()}å††\n`;
                    result += `ç·åç›Šç‡: ${report.capitalStatus.totalReturnRate.toFixed(2)}%\n`;
                    result += `ç›´è¿‘å‹ç‡: ${(report.recentPerformance.winRate * 100).toFixed(1)}%\n`;
                }
                
                resultDiv.innerHTML = `<div class="result">${result}</div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        function analyzeConfidenceScore() {
            const resultDiv = document.getElementById('confidenceAnalysisResult');
            
            try {
                let result = '=== ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢æ§‹æˆè©³ç´°åˆ†æ ===\n\n';
                
                // ãƒ†ã‚¹ãƒˆç”¨ã®é¦¬ãƒ‡ãƒ¼ã‚¿ã§ä¿¡é ¼åº¦è¨ˆç®—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const testHorses = [
                    { name: 'é«˜ã‚¹ã‚³ã‚¢äººæ°—é¦¬', score: 90, odds: 2.5, popularity: 'favorite' },
                    { name: 'ä¸­ã‚¹ã‚³ã‚¢ä¸­äººæ°—', score: 70, odds: 5.0, popularity: 'midrange' },
                    { name: 'ä½ã‚¹ã‚³ã‚¢ç©´é¦¬', score: 40, odds: 15.0, popularity: 'outsider' }
                ];
                
                if (typeof ExpectedValueCalculator !== 'undefined') {
                    result += 'ã€ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ†ã‚¹ãƒˆã€‘\n\n';
                    
                    testHorses.forEach(horse => {
                        const analysis = { popularity: horse.popularity, estimatedProbability: 0.3 };
                        const confidenceScore = ExpectedValueCalculator.calculateConfidenceScore(horse, analysis);
                        
                        result += `${horse.name}:\n`;
                        result += `  ã‚¹ã‚³ã‚¢: ${horse.score} â†’ ã‚¹ã‚³ã‚¢è£œæ­£: ${getScoreMultiplier(horse.score)}å€\n`;
                        result += `  ã‚ªãƒƒã‚º: ${horse.odds} â†’ ã‚ªãƒƒã‚ºè£œæ­£: ${getOddsMultiplier(horse.odds)}å€\n`;
                        result += `  äººæ°—: ${horse.popularity} â†’ äººæ°—è£œæ­£: ${getPopularityMultiplier(horse.popularity)}å€\n`;
                        result += `  æœ€çµ‚ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢: ${confidenceScore.toFixed(3)}\n\n`;
                    });
                    
                    result += 'ã€ä¿¡é ¼åº¦è¨ˆç®—å¼ã®è©³ç´°ã€‘\n';
                    result += 'åŸºæº–å€¤: 1.0\n';
                    result += 'ã‚¹ã‚³ã‚¢è£œæ­£: 90ä»¥ä¸Šâ†’Ã—1.3, 80ä»¥ä¸Šâ†’Ã—1.2, 70ä»¥ä¸Šâ†’Ã—1.1, 60ä»¥ä¸Šâ†’Ã—1.0, 50ä»¥ä¸Šâ†’Ã—0.9, 40ä»¥ä¸Šâ†’Ã—0.8, 40æœªæº€â†’Ã—0.7\n';
                    result += 'äººæ°—è£œæ­£: favoriteâ†’Ã—1.15, midrangeâ†’Ã—1.0, outsiderâ†’Ã—0.85\n';
                    result += 'ã‚ªãƒƒã‚ºè£œæ­£: 1.5æœªæº€â†’Ã—0.9, 3.0ä»¥ä¸‹â†’Ã—1.1, 7.0ä»¥ä¸‹â†’Ã—1.0, 15.0ä»¥ä¸‹â†’Ã—0.95, 30.0ä»¥ä¸‹â†’Ã—0.85, 30.0è¶…â†’Ã—0.7\n';
                    result += 'æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯: ã‚ªãƒƒã‚ºã¨ç¢ºç‡ã®ä¸æ•´åˆâ†’Ã—0.9\n';
                    result += 'ç¯„å›²åˆ¶é™: 0.5ï½1.5\n';
                    
                } else {
                    result += 'ExpectedValueCalculatorãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚\n';
                }
                
                resultDiv.innerHTML = `<div class="result">${result}</div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        function getScoreMultiplier(score) {
            if (score >= 90) return 1.3;
            if (score >= 80) return 1.2;
            if (score >= 70) return 1.1;
            if (score >= 60) return 1.0;
            if (score >= 50) return 0.9;
            if (score >= 40) return 0.8;
            return 0.7;
        }
        
        function getOddsMultiplier(odds) {
            if (odds < 1.5) return 0.9;
            if (odds <= 3.0) return 1.1;
            if (odds <= 7.0) return 1.0;
            if (odds <= 15.0) return 0.95;
            if (odds <= 30.0) return 0.85;
            return 0.7;
        }
        
        function getPopularityMultiplier(popularity) {
            switch (popularity) {
                case 'favorite': return 1.15;
                case 'midrange': return 1.0;
                case 'outsider': return 0.85;
                default: return 1.0;
            }
        }
        
        function testExpectedValueCalculation() {
            const resultDiv = document.getElementById('calculationTestResult');
            
            try {
                let result = '=== æœŸå¾…å€¤è¨ˆç®—ãƒ†ã‚¹ãƒˆ ===\n\n';
                
                if (typeof ExpectedValueCalculator !== 'undefined') {
                    const testHorses = [
                        { name: 'ãƒã‚¤ã‚¼ãƒ³ã‚¹ãƒ¬ã‚¤', score: 85, odds: 2.0, placeProbability: 85 },
                        { name: 'ã‚±ãƒ³ã‚°ãƒ­ãƒªã‚¢', score: 45, odds: 8.0, placeProbability: 45 },
                        { name: 'ã‚¸ãƒ¼ãƒ†ã‚£ãƒ¼ãƒ¬ã‚¤ãƒŠ', score: 50, odds: 12.0, placeProbability: 50 }
                    ];
                    
                    result += 'ã€æœŸå¾…å€¤è¨ˆç®—ã®è©³ç´°åˆ†æã€‘\n\n';
                    
                    testHorses.forEach(horse => {
                        const analysis = ExpectedValueCalculator.calculateHorseExpectedValue(horse, 'place');
                        
                        result += `${horse.name}ã®è¨ˆç®—è©³ç´°:\n`;
                        result += `  å…¥åŠ›: ã‚¹ã‚³ã‚¢${horse.score}, ã‚ªãƒƒã‚º${horse.odds}å€\n`;
                        result += `  æ¨å®šç¢ºç‡: ${(analysis.estimatedProbability * 100).toFixed(1)}%\n`;
                        result += `  æ¨å®šé…å½“: ${analysis.estimatedOdds}å††\n`;
                        result += `  ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢: ${analysis.confidenceScore.toFixed(3)}\n`;
                        result += `  æœŸå¾…å€¤: ${analysis.expectedValue.toFixed(3)}\n`;
                        result += `  ã‚±ãƒªãƒ¼ä¿‚æ•°: ${(analysis.kellyRatio * 100).toFixed(2)}%\n`;
                        result += `  æ¨å¥¨: ${analysis.recommendation}\n\n`;
                    });
                    
                    result += 'ã€è¨ˆç®—ãƒ—ãƒ­ã‚»ã‚¹ã®å•é¡Œç‚¹ã€‘\n';
                    result += '1. ã‚ªãƒƒã‚ºä¿‚æ•°ãŒä½ã™ãã‚‹å¯èƒ½æ€§ï¼ˆ0.25-0.45ï¼‰\n';
                    result += '2. ç¢ºç‡ä¿‚æ•°ã‚‚ä¿å®ˆçš„ï¼ˆ0.4+0.1ï¼‰\n';
                    result += '3. èƒ´å…ƒæ‰‹æ•°æ–™20%ãŒéå¤§\n';
                    result += '4. è¤‡æ•°ã®è£œæ­£ã®ç©ã¿é‡ã­ã§æœŸå¾…å€¤ãŒå¤§å¹…æ¸›å°‘\n';
                    
                } else {
                    result += 'ExpectedValueCalculatorãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚\n';
                }
                
                resultDiv.innerHTML = `<div class="result">${result}</div>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” ã‚¹ã‚³ã‚¢åˆ¥çš„ä¸­ç‡åˆ†æãƒ„ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        });
    </script>
</body>
</html>