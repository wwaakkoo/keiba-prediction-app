# 競馬予測アプリ開発ロードマップ

## プロジェクト概要
feature/phone-modeブランチの完成度分析と今後の開発課題をまとめたロードマップです。

**現在の状態**: 実戦投入可能レベル（総合完成度: 92%）
**最終更新**: 2025-06-27

---

## 📊 現在の完成度状況

| システム | 完成度 | 主要課題 |
|----------|--------|---------|
| データ抽出システム | 95% | データソース拡張、エラーハンドリング強化 |
| AI推奨システム | 90% | API統合完了、プロンプト最適化 |
| 機械学習システム | 95% | 高度学習機能、過学習防止 |
| レース分析エンジン | 85% | ペース分析、環境条件分析 |
| 買い目推奨システム | 90% | 複雑馬券対応、資金管理 |
| UI/UX | 92% | モバイル最適化、アクセシビリティ |

---

## 🚨 最優先課題（緊急）

### 1. AI API統合の完全実装
**ファイル**: `js/aiRecommendationService.js`
**問題**: 現在は模擬実装のみ
```javascript
// 対象箇所: aiRecommendationService.js:30-40
async generateRecommendation(analysisData) {
    // TODO: 実際のClaude API呼び出し実装
    // 現在は模擬的なAI分析のみ
}
```
**実装内容**:
- Claude API実際の呼び出し処理
- レート制限・タイムアウト処理
- APIキー管理システム
- 回答品質評価機能

### 2. エラーハンドリング強化
**ファイル**: `js/dataConverter.js`, `js/aiRecommendationService.js`
**問題**: エラー復旧処理が不完全
```javascript
// 高リスク箇所
// aiRecommendationService.js:356
throw new Error(`HTTP エラー: ${response.status}`);
// → ユーザーエクスペリエンスに影響

// dataConverter.js: 複数箇所
// → catch文はあるが復旧処理不足
```
**実装内容**:
- 段階的エラー復旧処理
- ユーザーフレンドリーなエラーメッセージ
- データ部分抽出失敗時の代替処理

### 3. データ検証機能追加
**ファイル**: `js/dataConverter.js`
**問題**: 抽出データの妥当性チェックが弱い
**実装内容**:
- 異常オッズ検出（0倍、1000倍超等）
- 異常タイム検出（物理的に不可能な記録）
- データ整合性チェック機能

---

## 🔥 高優先課題

### 4. ペース分析機能追加
**ファイル**: `js/raceAnalysisEngine.js`
**現状**: 基本的な展開予想のみ
**実装内容**:
- ラップタイム分析機能
- セクションタイム考慮機能
- ペース変化による着順影響分析
```javascript
// 追加予定の機能
class PaceAnalyzer {
    analyzeLapTimes(raceData) {
        // ラップタイム解析
    }
    
    calculateSectionImpact(horseData) {
        // セクション別影響度計算
    }
}
```

### 5. 複雑馬券種対応
**ファイル**: `js/bettingRecommender.js`
**現状**: 単勝・複勝・ワイド・馬連のみ
**実装内容**:
- 3連複・3連単推奨機能
- WIN5等特殊馬券対応
- 組み合わせ期待値計算
```javascript
// 追加予定の機能
static generateTripleBetting(predictions) {
    // 3連複・3連単推奨
}

static calculateWin5Recommendation(multipleRaces) {
    // WIN5推奨
}
```

### 6. モバイルUI最適化
**ファイル**: `styles/main.css`, `index.html`
**現状**: 基本的なレスポンシブ対応
**実装内容**:
- タッチ操作最適化
- 画面回転時レイアウト調整
- スワイプジェスチャー対応
- 片手操作モード

---

## 📈 中優先課題

### 7. 馬場差分析実装
**ファイル**: `js/raceAnalysisEngine.js`
**実装内容**:
- 同日他レースとの馬場差比較
- 時間経過による馬場変化考慮
- 馬場状態の定量化

### 8. 高度な学習機能
**ファイル**: `js/learningSystem.js`
**実装内容**:
- 過学習防止アルゴリズム
- 特徴量自動発見機能
- アンサンブル学習
- クロスバリデーション

### 9. アクセシビリティ改善
**ファイル**: 全UI関連ファイル
**実装内容**:
- スクリーンリーダー対応
- キーボードナビゲーション
- 色覚異常対応
- 音声入力対応

### 10. パフォーマンス最適化
**ファイル**: 全JSファイル
**実装内容**:
- 大量データ表示の仮想化
- 画像遅延読み込み
- コード分割・lazy loading
- メモリ使用量最適化

---

## 🔧 低優先課題

### 11. データソース拡張
**ファイル**: `js/dataConverter.js`
**実装内容**:
- 競馬ブック対応
- JRA公式データ対応
- PDF・画像データ抽出
- 複数ソース統合機能

### 12. 高度な資金管理
**ファイル**: `js/bettingRecommender.js`
**実装内容**:
- ケリー基準実装
- リスク分散投資法
- 資金推移グラフ
- 損益管理システム

### 13. 環境条件分析
**ファイル**: `js/raceAnalysisEngine.js`
**実装内容**:
- 風向・風速・湿度分析
- 季節要因分析
- 開催時刻影響分析
- 騎手・馬の相性分析

### 14. リアルタイム機能
**ファイル**: 新規作成 `js/realtimeSystem.js`
**実装内容**:
- リアルタイムオッズ取得
- オッズ変動アラート
- レース直前予想更新
- ライブ分析機能

---

## 🎯 特別プロジェクト

### A. 血統分析システム統合
**ブランチ**: `feature/pedigree-extraction`（完成版保存済み）
**実装内容**:
- 血統データベース統合
- 配合理論実装
- 血統適性分析
- 系統別成績分析

### B. ダークモード対応
**ファイル**: `styles/main.css`, 新規 `styles/dark-theme.css`
**実装内容**:
- ダーク・ライトテーマ切り替え
- 目に優しい配色
- 時間帯自動切り替え
- ユーザー設定保存

### C. マルチレース分析
**ファイル**: 新規作成 `js/multiRaceAnalyzer.js`
**実装内容**:
- 複数レース同時分析
- レース間相関分析
- 全レース最適化買い目
- 1日収支シミュレーション

---

## 🐛 既知の課題・バグ

### 修正が必要な箇所

#### 1. 数値計算のNaN処理
```javascript
// 複数ファイルで発生
parseFloat(horse.odds) || 10  // NaN検証が不十分
// → 適切なデフォルト値設定とバリデーション追加が必要
```

#### 2. LocalStorage容量制限
```javascript
// learningSystem.js
// 学習データ蓄積による容量上限到達の可能性
// → データ圧縮・古いデータ自動削除機能追加が必要
```

#### 3. ブラウザ互換性
```javascript
// ES6機能使用箇所
// 古いブラウザでの動作確認・ポリフィル追加が必要
```

---

## 📝 実装時の注意事項

### コーディング規約
- 既存のコメント・ログ出力スタイルを維持
- 各機能のテスト関数を併せて実装
- パフォーマンスへの影響を常に考慮
- エラーハンドリングを必須実装

### テスト項目
- 各機能の単体テスト
- 統合テスト（他システムとの連携）
- パフォーマンステスト
- ユーザビリティテスト

### デプロイメント
- 段階的リリース（機能単位でのテスト）
- ロールバック計画の準備
- ユーザーデータの互換性確保

---

## 📊 成功指標

### 技術指標
- エラー発生率: 1%未満
- レスポンス時間: 2秒以内
- 予測精度: 複勝率70%以上
- ユーザー満足度: 90%以上

### 機能指標
- データ抽出成功率: 99%以上
- AI推奨機能利用率: 80%以上
- 学習システム活用率: 70%以上
- モバイル利用率: 60%以上

---

## 🔄 更新履歴
- 2025-06-27: 初版作成（feature/phone-mode分析完了時）
- 今後の更新時は日付と変更内容を記録

---

## 📞 連絡先・参考情報
- メインブランチ: `feature/phone-mode`
- 血統機能ブランチ: `feature/pedigree-extraction`
- 開発環境: Node.js + Vanilla JavaScript
- 主要ライブラリ: Chart.js (グラフ表示)

**このロードマップは開発進捗に応じて随時更新してください。**