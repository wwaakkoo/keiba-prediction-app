<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ æ‹¡å¼µæ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        .horse-data { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 10px; margin: 10px 0; }
        .confidence-debug { background: #f8f9fa; border-left: 4px solid #007bff; padding: 10px; margin: 5px 0; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>ğŸ¯ æ‹¡å¼µæ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒãƒƒã‚°</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ãƒ‡ãƒãƒƒã‚°ç›®çš„</h2>
        <p>æ‹¡å¼µæ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ ã®ä¿¡é ¼åº¦è¨ˆç®—ã¨åˆ†é¡ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <ul>
            <li>ä¿¡é ¼åº¦è¨ˆç®—ã®è©³ç´°åˆ†æ</li>
            <li>å‹•çš„é–¾å€¤èª¿æ•´ã®ç¢ºèª</li>
            <li>æ³¨ç›®é¦¬åˆ†é¡ã®é©åˆ‡æ€§æ¤œè¨¼</li>
            <li>æˆ¦ç•¥æ¨å¥¨ã®å¦¥å½“æ€§ç¢ºèª</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‡ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®š</h2>
        <button onclick="setupTestData()">æ¨™æº–ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</button>
        <button onclick="setupHighOddsData()">é«˜ã‚ªãƒƒã‚ºåé‡ãƒ‡ãƒ¼ã‚¿</button>
        <button onclick="setupBalancedData()">ãƒãƒ©ãƒ³ã‚¹å‹ãƒ‡ãƒ¼ã‚¿</button>
        <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        
        <div id="testHorses" class="info test-section" style="display: none;">
            <h4>ãƒ†ã‚¹ãƒˆé¦¬ãƒ‡ãƒ¼ã‚¿</h4>
            <div id="horseDataDisplay"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” ä¿¡é ¼åº¦è¨ˆç®—ãƒ‡ãƒãƒƒã‚°</h2>
        <button onclick="runConfidenceDebug()">ä¿¡é ¼åº¦è¨ˆç®—ãƒ†ã‚¹ãƒˆ</button>
        
        <div id="confidenceResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æ³¨ç›®é¦¬åˆ†é¡çµæœ</h2>
        <div id="watchListResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ’¡ æˆ¦ç•¥æ¨å¥¨çµæœ</h2>
        <div id="strategyResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h2>
        <pre id="debugLog">ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...\n</pre>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="../js/config.js"></script>
    <script src="../js/enhancedRecommendationSystem.js"></script>
    
    <script>
        let testData = [];
        let debugLogs = [];
        
        // ãƒ­ã‚°é–¢æ•°ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            debugLogs.push(args.join(' '));
            originalConsoleLog.apply(console, args);
            updateDebugLog();
        };
        
        function updateDebugLog() {
            document.getElementById('debugLog').textContent = debugLogs.slice(-20).join('\n');
        }
        
        function addDebugLog(message) {
            debugLogs.push(`[DEBUG] ${new Date().toLocaleTimeString()} ${message}`);
            updateDebugLog();
        }
        
        function clearLog() {
            debugLogs = [];
            updateDebugLog();
        }
        
        // æ¨™æº–ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
        function setupTestData() {
            testData = [
                {
                    name: "ã‚µãƒ³ãƒ©ã‚¤ã‚ºãƒ›ãƒ¼ãƒ—",
                    odds: 2.1,
                    winProbability: 25.3,
                    placeProbability: 65.2,
                    winExpectedValue: 1.2,
                    efficiencyScore: 75,
                    score: 82
                },
                {
                    name: "ãƒŸãƒ©ã‚¯ãƒ«ã‚¹ã‚¿ãƒ¼",
                    odds: 4.5,
                    winProbability: 18.7,
                    placeProbability: 58.1,
                    winExpectedValue: 0.8,
                    efficiencyScore: 68,
                    score: 74
                },
                {
                    name: "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒœãƒ«ãƒˆ",
                    odds: 7.2,
                    winProbability: 12.4,
                    placeProbability: 45.3,
                    winExpectedValue: 0.9,
                    efficiencyScore: 62,
                    score: 65
                },
                {
                    name: "ã‚·ãƒ«ãƒãƒ¼ã‚¢ãƒ­ãƒ¼",
                    odds: 12.8,
                    winProbability: 8.1,
                    placeProbability: 38.7,
                    winExpectedValue: 1.0,
                    efficiencyScore: 58,
                    score: 59
                },
                {
                    name: "ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ",
                    odds: 18.4,
                    winProbability: 5.2,
                    placeProbability: 28.9,
                    winExpectedValue: 0.95,
                    efficiencyScore: 45,
                    score: 48
                }
            ];
            
            displayTestData();
            addDebugLog('æ¨™æº–ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ');
        }
        
        // é«˜ã‚ªãƒƒã‚ºåé‡ãƒ‡ãƒ¼ã‚¿
        function setupHighOddsData() {
            testData = [
                {
                    name: "å¤§ç©´ã‚¹ãƒšã‚·ãƒ£ãƒ«",
                    odds: 70.0,
                    winProbability: 2.5,
                    placeProbability: 12.1,
                    winExpectedValue: 1.75,
                    efficiencyScore: 95,
                    score: 45
                },
                {
                    name: "ãƒŸãƒ‰ãƒ«ç©´é¦¬",
                    odds: 25.0,
                    winProbability: 4.8,
                    placeProbability: 22.3,
                    winExpectedValue: 1.2,
                    efficiencyScore: 78,
                    score: 52
                },
                {
                    name: "äººæ°—è–„",
                    odds: 15.0,
                    winProbability: 7.2,
                    placeProbability: 28.5,
                    winExpectedValue: 1.08,
                    efficiencyScore: 65,
                    score: 58
                },
                {
                    name: "ä¸­äººæ°—",
                    odds: 8.0,
                    winProbability: 12.5,
                    placeProbability: 42.1,
                    winExpectedValue: 1.0,
                    efficiencyScore: 62,
                    score: 65
                },
                {
                    name: "æœ¬å‘½",
                    odds: 2.5,
                    winProbability: 35.2,
                    placeProbability: 72.8,
                    winExpectedValue: 0.88,
                    efficiencyScore: 58,
                    score: 85
                }
            ];
            
            displayTestData();
            addDebugLog('é«˜ã‚ªãƒƒã‚ºåé‡ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ');
        }
        
        // ãƒãƒ©ãƒ³ã‚¹å‹ãƒ‡ãƒ¼ã‚¿
        function setupBalancedData() {
            testData = [
                {
                    name: "ãƒãƒ©ãƒ³ã‚¹æœ¬å‘½",
                    odds: 3.2,
                    winProbability: 28.5,
                    placeProbability: 68.2,
                    winExpectedValue: 0.91,
                    efficiencyScore: 72,
                    score: 78
                },
                {
                    name: "ãƒãƒ©ãƒ³ã‚¹å¯¾æŠ—",
                    odds: 5.1,
                    winProbability: 18.2,
                    placeProbability: 55.7,
                    winExpectedValue: 0.93,
                    efficiencyScore: 68,
                    score: 71
                },
                {
                    name: "ãƒãƒ©ãƒ³ã‚¹æ³¨ç›®",
                    odds: 8.5,
                    winProbability: 11.8,
                    placeProbability: 42.3,
                    winExpectedValue: 1.0,
                    efficiencyScore: 65,
                    score: 63
                },
                {
                    name: "ãƒãƒ©ãƒ³ã‚¹è­¦æˆ’",
                    odds: 14.2,
                    winProbability: 7.1,
                    placeProbability: 32.1,
                    winExpectedValue: 1.01,
                    efficiencyScore: 58,
                    score: 55
                },
                {
                    name: "ãƒãƒ©ãƒ³ã‚¹ç©´",
                    odds: 22.8,
                    winProbability: 4.4,
                    placeProbability: 23.5,
                    winExpectedValue: 1.0,
                    efficiencyScore: 52,
                    score: 48
                }
            ];
            
            displayTestData();
            addDebugLog('ãƒãƒ©ãƒ³ã‚¹å‹ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ');
        }
        
        function displayTestData() {
            const container = document.getElementById('horseDataDisplay');
            let html = '<table><tr><th>é¦¬å</th><th>ã‚ªãƒƒã‚º</th><th>å‹ç‡</th><th>è¤‡å‹ç‡</th><th>æœŸå¾…å€¤</th><th>åŠ¹ç‡</th><th>ã‚¹ã‚³ã‚¢</th></tr>';
            
            testData.forEach(horse => {
                html += `<tr>
                    <td><strong>${horse.name}</strong></td>
                    <td>${horse.odds}å€</td>
                    <td>${horse.winProbability}%</td>
                    <td>${horse.placeProbability}%</td>
                    <td>${horse.winExpectedValue}</td>
                    <td>${horse.efficiencyScore}</td>
                    <td>${horse.score}</td>
                </tr>`;
            });
            
            html += '</table>';
            container.innerHTML = html;
            document.getElementById('testHorses').style.display = 'block';
        }
        
        function runConfidenceDebug() {
            if (testData.length === 0) {
                alert('ã¾ãšãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }
            
            addDebugLog('ä¿¡é ¼åº¦è¨ˆç®—ãƒ‡ãƒãƒƒã‚°ã‚’é–‹å§‹');
            
            // ä¿¡é ¼åº¦è¨ˆç®—ã®è©³ç´°è¡¨ç¤º
            const confidenceResults = document.getElementById('confidenceResults');
            let html = '<h4>ä¿¡é ¼åº¦è¨ˆç®—è©³ç´°</h4>';
            
            testData.forEach(horse => {
                const confidence = EnhancedRecommendationSystem.calculateHorseConfidence(horse);
                
                html += `
                    <div class="confidence-debug">
                        <h5>${horse.name} - ä¿¡é ¼åº¦: ${confidence.toFixed(1)}ç‚¹</h5>
                        <div style="font-size: 0.9em;">
                            <div>å‹ç‡åŸºç¤ç‚¹: ${Math.min(horse.winProbability * 2.5, 50).toFixed(1)}ç‚¹ (å‹ç‡${horse.winProbability}% Ã— 2.5)</div>
                            <div>è¤‡å‹ç‡åŠ ç‚¹: ${horse.placeProbability > 70 ? 15 : horse.placeProbability > 50 ? 10 : horse.placeProbability > 30 ? 5 : 0}ç‚¹</div>
                            <div>ã‚ªãƒƒã‚ºèª¿æ•´: ${getOddsAdjustment(horse.odds)}ç‚¹ (${horse.odds}å€)</div>
                            <div>æœŸå¾…å€¤è£œæ­£: ${getExpectedValueAdjustment(horse.winExpectedValue)}ç‚¹</div>
                            <div>åŠ¹ç‡è£œæ­£: ${getEfficiencyAdjustment(horse.efficiencyScore)}ç‚¹</div>
                            <div>ã‚¹ã‚³ã‚¢è£œæ­£: ${getScoreAdjustment(horse.score)}ç‚¹</div>
                        </div>
                    </div>
                `;
            });
            
            confidenceResults.innerHTML = html;
            
            // æ³¨ç›®é¦¬ãƒªã‚¹ãƒˆç”Ÿæˆãƒ†ã‚¹ãƒˆ
            const watchList = EnhancedRecommendationSystem.generateWatchList(testData);
            displayWatchListResults(watchList);
            
            // æˆ¦ç•¥ç”Ÿæˆãƒ†ã‚¹ãƒˆ
            const strategies = EnhancedRecommendationSystem.generateBettingStrategies(watchList);
            displayStrategyResults(strategies);
            
            addDebugLog('ä¿¡é ¼åº¦è¨ˆç®—ãƒ‡ãƒãƒƒã‚°å®Œäº†');
        }
        
        function getOddsAdjustment(odds) {
            if (odds <= 2) return 20;
            if (odds <= 3) return 15;
            if (odds <= 5) return 10;
            if (odds <= 8) return 5;
            if (odds <= 15) return 0;
            if (odds <= 30) return -5;
            return -10;
        }
        
        function getExpectedValueAdjustment(ev) {
            if (ev > 1.2) return 10;
            if (ev > 1.0) return 5;
            if (ev < 0.8) return -5;
            return 0;
        }
        
        function getEfficiencyAdjustment(eff) {
            if (eff > 85) return 8;
            if (eff > 70) return 5;
            if (eff < 50) return -3;
            return 0;
        }
        
        function getScoreAdjustment(score) {
            if (score > 80) return 10;
            if (score > 70) return 5;
            if (score < 50) return -5;
            return 0;
        }
        
        function displayWatchListResults(watchList) {
            const container = document.getElementById('watchListResults');
            let html = '<h4>æ³¨ç›®é¦¬åˆ†é¡çµæœ</h4>';
            
            html += `<div class="info test-section">
                <h5>å‹•çš„é–¾å€¤</h5>
                <div>æœ€æœ‰åŠ›: ${watchList.adjustedThresholds.highest.threshold}ç‚¹ä»¥ä¸Š</div>
                <div>æœ‰åŠ›: ${watchList.adjustedThresholds.high.threshold}ç‚¹ä»¥ä¸Š</div>
                <div>æ³¨ç›®: ${watchList.adjustedThresholds.medium.threshold}ç‚¹ä»¥ä¸Š</div>
                <div>è­¦æˆ’: ${watchList.adjustedThresholds.watch.threshold}ç‚¹ä»¥ä¸Š</div>
            </div>`;
            
            Object.entries(EnhancedRecommendationSystem.confidenceLevels).forEach(([level, config]) => {
                const horses = watchList.byLevel[level] || [];
                if (horses.length > 0) {
                    html += `
                        <div class="horse-data" style="border-left: 4px solid ${config.color};">
                            <h5>${config.symbol} ${config.name} (${horses.length}é ­)</h5>
                            ${horses.map(horse => `
                                <div>${horse.name}: ${horse.confidence.toFixed(1)}ç‚¹ (å‹ç‡${horse.winProbability}%, ã‚ªãƒƒã‚º${horse.odds}å€)</div>
                            `).join('')}
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        function displayStrategyResults(strategies) {
            const container = document.getElementById('strategyResults');
            let html = '<h4>æˆ¦ç•¥æ¨å¥¨çµæœ</h4>';
            
            Object.entries(strategies).forEach(([key, strategy]) => {
                html += `
                    <div class="horse-data ${strategy.recommended ? 'success' : ''}">
                        <h5>${strategy.name} ${strategy.recommended ? '(æ¨å¥¨)' : ''}</h5>
                        <div>é¸å®šé¦¬æ•°: ${strategy.horses.length}é ­</div>
                        <div>çš„ä¸­ç‡: ${strategy.expectedHitRate}%</div>
                        <div>æŠ•è³‡é¡: ${strategy.totalInvestment}å††</div>
                        <div>æœŸå¾…å€¤: ${strategy.expectedValue.toFixed(2)}</div>
                        <div>é¸å®šé¦¬: ${strategy.horses.map(h => h.name).join(', ')}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function clearResults() {
            document.getElementById('confidenceResults').innerHTML = '';
            document.getElementById('watchListResults').innerHTML = '';
            document.getElementById('strategyResults').innerHTML = '';
            document.getElementById('testHorses').style.display = 'none';
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addDebugLog('æ‹¡å¼µæ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ');
        });
    </script>
</body>
</html>