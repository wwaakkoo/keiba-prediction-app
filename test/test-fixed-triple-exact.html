<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ… ä¿®æ­£æ¸ˆã¿3é€£å˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        .recommendation-item { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 10px 0; border-left: 4px solid #007bff; }
        .triple-exact { border-left-color: #dc3545; }
        .triple-box { border-left-color: #28a745; }
        .win-place { border-left-color: #ffc107; }
    </style>
</head>
<body>
    <h1>âœ… ä¿®æ­£æ¸ˆã¿3é€£å˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ğŸ”§ ä¿®æ­£å†…å®¹</h2>
        <div class="info test-section">
            <h4>å•é¡Œã¨ä¿®æ­£</h4>
            <p><strong>å•é¡Œ:</strong> 3é€£å˜æ¨å¥¨ãŒãƒ¡ã‚¤ãƒ³é–¢æ•°ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã¦ã„ãªã‹ã£ãŸ</p>
            <p><strong>ä¿®æ­£:</strong> generateBettingRecommendations() ã«3é€£è¤‡ãƒ»3é€£å˜ã®å‘¼ã³å‡ºã—ã‚’è¿½åŠ </p>
            <p><strong>å‰Šé™¤:</strong> generateRecommendationsFromMarks() å†…ã®é‡è¤‡å‘¼ã³å‡ºã—ã‚’å‰Šé™¤</p>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‡ ä¿®æ­£ç‰ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
        <button onclick="setupTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®š</button>
        <button onclick="runFixedTest()">ä¿®æ­£ç‰ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        
        <div id="testInfo" class="info test-section" style="display: none;">
            <h4>ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</h4>
            <div id="horseInfo"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æ¨å¥¨ç”Ÿæˆçµæœ</h2>
        <div id="recommendationResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
        <pre id="executionLog">ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...\n</pre>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="../js/config.js"></script>
    <script src="../js/bettingRecommender.js"></script>
    
    <script>
        let testPredictions = [];
        let logs = [];
        
        // ãƒ­ã‚°é–¢æ•°
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`${timestamp} ${message}`);
            document.getElementById('executionLog').textContent = logs.slice(-20).join('\n');
        }
        
        // ãƒ¢ãƒƒã‚¯å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ 
        class LearningSystem {
            static getLearningData() {
                return {
                    adjustments: { oddsWeight: 1.0, timeWeight: 1.0, jockeyWeight: 1.0 }
                };
            }
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®š
        function setupTestData() {
            testPredictions = [
                {
                    name: "ã‚µãƒ³ãƒ©ã‚¤ã‚ºãƒ›ãƒ¼ãƒ—",
                    odds: 2.1,
                    winProbability: 25.3,
                    placeProbability: 65.2,
                    winExpectedValue: 1.2
                },
                {
                    name: "ãƒŸãƒ©ã‚¯ãƒ«ã‚¹ã‚¿ãƒ¼",
                    odds: 4.5,
                    winProbability: 18.7,
                    placeProbability: 58.1,
                    winExpectedValue: 0.8
                },
                {
                    name: "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒœãƒ«ãƒˆ",
                    odds: 7.2,
                    winProbability: 12.4,
                    placeProbability: 45.3,
                    winExpectedValue: 0.9
                },
                {
                    name: "ã‚·ãƒ«ãƒãƒ¼ã‚¢ãƒ­ãƒ¼",
                    odds: 12.8,
                    winProbability: 8.1,
                    placeProbability: 38.7,
                    winExpectedValue: 1.0
                },
                {
                    name: "ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ",
                    odds: 18.4,
                    winProbability: 5.2,
                    placeProbability: 28.9,
                    winExpectedValue: 0.95
                }
            ];
            
            const horseInfo = document.getElementById('horseInfo');
            horseInfo.innerHTML = testPredictions.map((horse, i) => `
                <p><strong>${i+1}. ${horse.name}</strong> - ã‚ªãƒƒã‚º:${horse.odds}å€ å‹ç‡:${horse.winProbability}% è¤‡å‹ç‡:${horse.placeProbability}%</p>
            `).join('');
            
            document.getElementById('testInfo').style.display = 'block';
            addLog('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸï¼ˆ5é ­ï¼‰');
        }
        
        function getHorseNumber(horseName) {
            const index = testPredictions.findIndex(h => h.name === horseName);
            return index !== -1 ? index + 1 : '?';
        }
        
        function runFixedTest() {
            if (testPredictions.length === 0) {
                alert('ã¾ãšãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }
            
            addLog('ä¿®æ­£ç‰ˆ3é€£å˜ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹');
            
            try {
                // Step 1: å°åˆ†é¡
                addLog('Step 1: å°åˆ†é¡ã‚’å®Ÿè¡Œ...');
                const sortedByWinProbability = [...testPredictions].sort((a, b) => b.winProbability - a.winProbability);
                const sortedByWinExpected = [...testPredictions].sort((a, b) => b.winExpectedValue - a.winExpectedValue);
                
                const horseMarks = BettingRecommender.classifyHorses(
                    testPredictions,
                    sortedByWinProbability,
                    sortedByWinExpected
                );
                
                addLog(`å°åˆ†é¡å®Œäº†: æœ¬å‘½=${horseMarks.honmei?.name}, å¯¾æŠ—=${horseMarks.taikou?.name}, å˜ç©´=${horseMarks.tanana?.name}, é€£è¤‡=${horseMarks.renpuku?.name}`);
                
                // Step 2: åŸºæœ¬æ¨å¥¨ç”Ÿæˆ
                addLog('Step 2: åŸºæœ¬æ¨å¥¨ã‚’ç”Ÿæˆ...');
                const basicRecommendations = BettingRecommender.generateRecommendationsFromMarks(horseMarks, getHorseNumber);
                addLog(`åŸºæœ¬æ¨å¥¨ç”Ÿæˆå®Œäº†: ${basicRecommendations.length}ä»¶`);
                
                // Step 3: 3é€£è¤‡æ¨å¥¨ç”Ÿæˆ
                addLog('Step 3: 3é€£è¤‡æ¨å¥¨ã‚’ç”Ÿæˆ...');
                const tripleBoxRecommendations = BettingRecommender.generateTripleBoxRecommendations(
                    horseMarks, 
                    testPredictions, 
                    getHorseNumber
                );
                addLog(`3é€£è¤‡æ¨å¥¨ç”Ÿæˆå®Œäº†: ${tripleBoxRecommendations.length}ä»¶`);
                
                // Step 4: 3é€£å˜æ¨å¥¨ç”Ÿæˆ
                addLog('Step 4: 3é€£å˜æ¨å¥¨ã‚’ç”Ÿæˆ...');
                const tripleExactRecommendations = BettingRecommender.generateTripleExactRecommendations(
                    horseMarks,
                    testPredictions,
                    getHorseNumber
                );
                addLog(`3é€£å˜æ¨å¥¨ç”Ÿæˆå®Œäº†: ${tripleExactRecommendations.length}ä»¶`);
                
                // çµ±åˆ
                const allRecommendations = [
                    ...basicRecommendations,
                    ...tripleBoxRecommendations,
                    ...tripleExactRecommendations
                ];
                
                addLog(`å…¨æ¨å¥¨çµ±åˆå®Œäº†: åˆè¨ˆ${allRecommendations.length}ä»¶`);
                
                // çµæœè¡¨ç¤º
                displayResults(allRecommendations);
                
                addLog('ä¿®æ­£ç‰ˆãƒ†ã‚¹ãƒˆå®Œäº† âœ…');
                
            } catch (error) {
                addLog(`ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message} âŒ`);
                console.error('ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        function displayResults(recommendations) {
            const container = document.getElementById('recommendationResults');
            
            if (recommendations.length === 0) {
                container.innerHTML = `
                    <div class="error test-section">
                        <h4>âŒ æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</h4>
                        <p>æ¡ä»¶ã‚’æº€ãŸã™æ¨å¥¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    </div>
                `;
                return;
            }
            
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«åˆ†é¡
            const winPlace = recommendations.filter(r => r.category === 'å˜å‹' || r.category === 'è¤‡å‹');
            const wide = recommendations.filter(r => r.category === 'ãƒ¯ã‚¤ãƒ‰');
            const tripleBox = recommendations.filter(r => r.category === '3é€£è¤‡');
            const tripleExact = recommendations.filter(r => r.category === '3é€£å˜');
            
            let html = `
                <div class="success test-section">
                    <h4>âœ… æ¨å¥¨ç”ŸæˆæˆåŠŸ</h4>
                    <p>ç·æ¨å¥¨æ•°: ${recommendations.length}ä»¶</p>
                    <p>å†…è¨³: å˜å‹ãƒ»è¤‡å‹ ${winPlace.length}ä»¶, ãƒ¯ã‚¤ãƒ‰ ${wide.length}ä»¶, 3é€£è¤‡ ${tripleBox.length}ä»¶, 3é€£å˜ ${tripleExact.length}ä»¶</p>
                </div>
            `;
            
            // å„ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤º
            if (winPlace.length > 0) {
                html += createCategorySection('å˜å‹ãƒ»è¤‡å‹æ¨å¥¨', winPlace, 'win-place');
            }
            
            if (wide.length > 0) {
                html += createCategorySection('ãƒ¯ã‚¤ãƒ‰æ¨å¥¨', wide, 'win-place');
            }
            
            if (tripleBox.length > 0) {
                html += createCategorySection('3é€£è¤‡æ¨å¥¨', tripleBox, 'triple-box');
            }
            
            if (tripleExact.length > 0) {
                html += createCategorySection('3é€£å˜æ¨å¥¨', tripleExact, 'triple-exact');
            } else {
                html += `
                    <div class="error test-section">
                        <h4>âŒ 3é€£å˜æ¨å¥¨ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</h4>
                        <p>åŠ¹ç‡åŸºæº–ã‚’æº€ãŸã™3é€£å˜ã®çµ„ã¿åˆã‚ã›ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function createCategorySection(title, recommendations, cssClass) {
            let html = `<h4>${title}</h4>`;
            
            recommendations.forEach((rec, index) => {
                html += `
                    <div class="recommendation-item ${cssClass}">
                        <h5>${rec.category} #${index + 1}</h5>
                        <p><strong>å°:</strong> ${rec.mark}</p>
                        <p><strong>ã‚¿ã‚¤ãƒ—:</strong> ${rec.type}</p>
                        <p><strong>é¦¬:</strong> ${rec.horse}</p>
                        <p><strong>ã‚ªãƒƒã‚º:</strong> ${rec.odds}</p>
                        <p><strong>ç¢ºç‡:</strong> ${rec.probability}</p>
                        <p><strong>æ¨å¥¨é‡‘é¡:</strong> ${rec.amount}</p>
                        ${rec.efficiency ? `<p><strong>åŠ¹ç‡:</strong> ${rec.efficiency.toFixed(3)}</p>` : ''}
                        ${rec.strategy ? `<p><strong>æˆ¦ç•¥:</strong> ${rec.strategy}</p>` : ''}
                    </div>
                `;
            });
            
            return html;
        }
        
        function clearResults() {
            document.getElementById('recommendationResults').innerHTML = '';
            document.getElementById('testInfo').style.display = 'none';
        }
        
        function clearLog() {
            logs = [];
            document.getElementById('executionLog').textContent = 'ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...\n';
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ä¿®æ­£ç‰ˆ3é€£å˜ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ');
        });
    </script>
</body>
</html>