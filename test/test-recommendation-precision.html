<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨å¥¨ç²¾åº¦ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #2196f3;
            border-bottom: 2px solid #2196f3;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-result {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 14px;
        }
        .test-error {
            background: #fff5f5;
            border-left: 4px solid #dc3545;
            color: #dc3545;
        }
        .btn {
            background: linear-gradient(45deg, #2196f3, #1976d2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .criteria-selector {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .comparison-table th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ æ¨å¥¨ç²¾åº¦ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
    
    <!-- çš„ä¸­åŸºæº–é¸æŠ -->
    <div class="test-section">
        <h2 class="test-title">ğŸ“Š çš„ä¸­åˆ¤å®šåŸºæº–è¨­å®š</h2>
        <div class="criteria-selector">
            <label for="hitCriteria">çš„ä¸­åˆ¤å®šåŸºæº–ã‚’é¸æŠ:</label>
            <select id="hitCriteria" onchange="updateHitCriteria()">
                <option value="place">è¤‡å‹çš„ä¸­ï¼ˆä¸Šä½3ä½äºˆæƒ³ã®ã†ã¡1é ­ãŒ3ç€ä»¥å†…ï¼‰</option>
                <option value="win">å˜å‹çš„ä¸­ï¼ˆ1ä½äºˆæƒ³ãŒå®Ÿéš›ã«1ç€ï¼‰</option>
                <option value="recommended">æ¨å¥¨ç¾¤çš„ä¸­ï¼ˆæ¨å¥¨é¦¬ç¾¤ã®ã†ã¡1é ­ãŒ3ç€ä»¥å†…ï¼‰</option>
                <option value="first">1ä½çš„ä¸­ï¼ˆ1ä½äºˆæƒ³ãŒ1ç€ï¼‰</option>
                <option value="top2">ä¸Šä½2ä½çš„ä¸­ï¼ˆä¸Šä½2ä½äºˆæƒ³ã®ã†ã¡1é ­ãŒ2ç€ä»¥å†…ï¼‰</option>
            </select>
            <button class="btn" onclick="showCriteriaDetails()">åŸºæº–è©³ç´°ã‚’è¡¨ç¤º</button>
        </div>
        <div id="criteriaDetails" class="test-result" style="display:none;"></div>
    </div>
    
    <!-- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ»è¨­å®š -->
    <div class="test-section">
        <h2 class="test-title">ğŸ² ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</h2>
        <button class="btn" onclick="generateTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ</button>
        <button class="btn" onclick="loadSampleResults()">ã‚µãƒ³ãƒ—ãƒ«çµæœã‚’èª­ã¿è¾¼ã¿</button>
        <button class="btn" onclick="clearTestData()">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
        <div id="testDataStatus" class="test-result" style="display:none;"></div>
    </div>
    
    <!-- æ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2 class="test-title">âš–ï¸ æ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒãƒ†ã‚¹ãƒˆ</h2>
        <button class="btn" onclick="runComparisonTest()">å¾“æ¥vsæ–°ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒ</button>
        <div class="metrics" id="comparisonMetrics" style="display:none;">
            <div class="metric">
                <div class="metric-value" id="oldSystemHitRate">-</div>
                <div class="metric-label">å¾“æ¥ã‚·ã‚¹ãƒ†ãƒ çš„ä¸­ç‡</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="newSystemHitRate">-</div>
                <div class="metric-label">æ–°ã‚·ã‚¹ãƒ†ãƒ çš„ä¸­ç‡</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="improvementRate">-</div>
                <div class="metric-label">æ”¹å–„ç‡</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="confidenceImprovement">-</div>
                <div class="metric-label">ä¿¡é ¼åº¦å‘ä¸Š</div>
            </div>
        </div>
        <div id="comparisonResult" class="test-result" style="display:none;"></div>
    </div>
    
    <!-- ä¿¡é ¼åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°åŠ¹æœãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2 class="test-title">ğŸ” ä¿¡é ¼åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°åŠ¹æœãƒ†ã‚¹ãƒˆ</h2>
        <button class="btn" onclick="testReliabilityFiltering()">ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°åŠ¹æœã‚’æ¸¬å®š</button>
        <div id="filteringResult" class="test-result" style="display:none;"></div>
    </div>
    
    <!-- å‹•çš„èª¿æ•´åŠ¹æœãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2 class="test-title">ğŸ“ˆ å‹•çš„èª¿æ•´åŠ¹æœãƒ†ã‚¹ãƒˆ</h2>
        <button class="btn" onclick="testDynamicAdjustment()">å‹•çš„èª¿æ•´ã®åŠ¹æœã‚’æ¸¬å®š</button>
        <div id="dynamicResult" class="test-result" style="display:none;"></div>
    </div>
    
    <!-- æœŸå¾…ROIæ¤œè¨¼ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2 class="test-title">ğŸ’° æœŸå¾…ROIæ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h2>
        <button class="btn" onclick="testExpectedROI()">æœŸå¾…ROIã®å¦¥å½“æ€§ã‚’æ¤œè¨¼</button>
        <div id="roiResult" class="test-result" style="display:none;"></div>
    </div>
    
    <!-- çµ±åˆãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2 class="test-title">ğŸš€ çµ±åˆæ¨å¥¨ç²¾åº¦ãƒ†ã‚¹ãƒˆ</h2>
        <button class="btn" onclick="runFullPrecisionTest()">å…¨æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
        <div class="metrics" id="fullTestMetrics" style="display:none;">
            <div class="metric">
                <div class="metric-value" id="overallHitRate">-</div>
                <div class="metric-label">ç·åˆçš„ä¸­ç‡</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="averageROI">-</div>
                <div class="metric-label">å¹³å‡ROI</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="reliabilityScore">-</div>
                <div class="metric-label">ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="systemEfficiency">-</div>
                <div class="metric-label">ã‚·ã‚¹ãƒ†ãƒ åŠ¹ç‡</div>
            </div>
        </div>
        <div id="fullTestResult" class="test-result" style="display:none;"></div>
    </div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="../js/config.js"></script>
    <script src="../js/horseManager.js"></script>
    <script src="../js/predictionEngine.js"></script>
    <script src="../js/bettingRecommender.js"></script>
    <script src="../js/learningSystem.js"></script>
    <script src="../js/enhancedLearningSystem.js"></script>
    <script src="../js/profitabilityMetrics.js"></script>
    <script src="../js/investmentStrategy.js"></script>
    <script src="../js/hitCriteriaSystem.js"></script>
    <script src="../js/reliabilityFilter.js"></script>
    <script src="../js/dynamicRecommendationAdjuster.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let testData = null;
        let testResults = [];
        
        // çš„ä¸­åŸºæº–æ›´æ–°
        function updateHitCriteria() {
            const criteria = document.getElementById('hitCriteria').value;
            if (typeof HitCriteriaSystem !== 'undefined') {
                HitCriteriaSystem.setCriteria(criteria);
                console.log('çš„ä¸­åŸºæº–æ›´æ–°:', criteria);
            }
        }
        
        // åŸºæº–è©³ç´°è¡¨ç¤º
        function showCriteriaDetails() {
            const details = document.getElementById('criteriaDetails');
            
            if (typeof HitCriteriaSystem !== 'undefined') {
                let detailText = 'ğŸ“Š çš„ä¸­åˆ¤å®šåŸºæº–è©³ç´°\\n\\n';
                
                Object.entries(HitCriteriaSystem.hitCriteria).forEach(([key, criteria]) => {
                    const isCurrent = key === HitCriteriaSystem.currentCriteria;
                    detailText += `${isCurrent ? 'â˜…' : 'ãƒ»'} ${criteria.name}\\n`;
                    detailText += `  ${criteria.description}\\n\\n`;
                });
                
                // æœŸå¾…çš„ä¸­ç‡ã¨é…å½“ç‡ã‚’è¡¨ç¤º
                if (testData) {
                    const expectedRates = HitCriteriaSystem.calculateExpectedHitRates(testData);
                    const expectedPayouts = HitCriteriaSystem.calculateExpectedPayouts(testData);
                    const expectedROI = HitCriteriaSystem.calculateExpectedROI(testData);
                    
                    detailText += 'ğŸ“ˆ æœŸå¾…å€¤æƒ…å ±\\n';
                    Object.entries(expectedRates).forEach(([key, rate]) => {
                        detailText += `${HitCriteriaSystem.hitCriteria[key].name}: çš„ä¸­ç‡${rate}%, é…å½“${expectedPayouts[key]}%, ROI${expectedROI[key]}%\\n`;
                    });
                }
                
                details.textContent = detailText;
                details.style.display = 'block';
            } else {
                details.textContent = 'âŒ HitCriteriaSystemãŒåˆ©ç”¨ã§ãã¾ã›ã‚“';
                details.className = 'test-result test-error';
                details.style.display = 'block';
            }
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateTestData() {
            const status = document.getElementById('testDataStatus');
            
            try {
                // 10é ­ã®ç«¶èµ°é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
                testData = [];
                const horseNames = ['ãƒ©ãƒƒã‚­ãƒ¼ãƒ›ãƒ¼ã‚¹', 'ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒ¼', 'ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ©ãƒƒã‚·ãƒ¥', 'ã‚µãƒ³ãƒ€ãƒ¼ãƒœãƒ«ãƒˆ', 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰', 
                               'ãƒ–ãƒ¬ã‚¤ãƒ–ãƒãƒ¼ãƒˆ', 'ã‚·ãƒ«ãƒãƒ¼ã‚¢ãƒ­ãƒ¼', 'ãƒ•ã‚¡ã‚¤ã‚¢ãƒ¼ã‚¹ãƒˆãƒ¼ãƒ ', 'ã‚¦ã‚£ãƒ³ãƒ‰ãƒã‚§ã‚¤ã‚µãƒ¼', 'ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ•ãƒ¬ã‚¢'];
                
                for (let i = 0; i < 10; i++) {
                    const horse = {
                        name: horseNames[i],
                        odds: (Math.random() * 40 + 1.2).toFixed(1),
                        winProbability: Math.random() * 25 + 2,
                        placeProbability: Math.random() * 40 + 15,
                        winExpectedValue: Math.random() * 0.4 + 0.8,
                        placeExpectedValue: Math.random() * 0.3 + 0.9,
                        popularity: i + 1,
                        age: Math.floor(Math.random() * 3) + 3,
                        weight: (Math.random() * 10 + 450).toFixed(0),
                        jockey: 'é¨æ‰‹' + (i + 1),
                        runningStyle: ['é€ƒã’', 'å…ˆè¡Œ', 'å·®ã—', 'è¿½è¾¼'][Math.floor(Math.random() * 4)],
                        raceHistory: Array.from({length: 3}, () => ({
                            position: Math.floor(Math.random() * 8) + 1,
                            time: `1:${Math.floor(Math.random() * 60) + 20}.${Math.floor(Math.random() * 9)}`
                        }))
                    };
                    testData.push(horse);
                }
                
                status.style.display = 'block';
                status.className = 'test-result';
                status.textContent = `âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†\\n${testData.length}é ­ã®ç«¶èµ°é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚\\n\\n` +
                    testData.map((horse, i) => 
                        `${i+1}. ${horse.name} (${horse.odds}å€, å‹ç‡${horse.winProbability.toFixed(1)}%)`
                    ).join('\\n');
                    
            } catch (error) {
                status.style.display = 'block';
                status.className = 'test-result test-error';
                status.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
        
        // ã‚µãƒ³ãƒ—ãƒ«çµæœèª­ã¿è¾¼ã¿
        function loadSampleResults() {
            // éå»20ãƒ¬ãƒ¼ã‚¹ã®ã‚µãƒ³ãƒ—ãƒ«çµæœã‚’ç”Ÿæˆ
            testResults = [];
            for (let i = 0; i < 20; i++) {
                testResults.push({
                    raceId: i + 1,
                    predictions: testData || [],
                    actual: {
                        first: testData ? testData[Math.floor(Math.random() * testData.length)].name : 'ãƒ†ã‚¹ãƒˆé¦¬1',
                        second: testData ? testData[Math.floor(Math.random() * testData.length)].name : 'ãƒ†ã‚¹ãƒˆé¦¬2',
                        third: testData ? testData[Math.floor(Math.random() * testData.length)].name : 'ãƒ†ã‚¹ãƒˆé¦¬3'
                    },
                    betAmount: 1000,
                    returnAmount: Math.random() > 0.7 ? Math.random() * 3000 + 1000 : 0,
                    isHit: Math.random() > 0.7,
                    confidence: Math.random() * 0.4 + 0.5
                });
            }
            
            const status = document.getElementById('testDataStatus');
            status.style.display = 'block';
            status.className = 'test-result';
            status.textContent = `âœ… ã‚µãƒ³ãƒ—ãƒ«çµæœèª­ã¿è¾¼ã¿å®Œäº†\\n${testResults.length}ä»¶ã®ãƒ¬ãƒ¼ã‚¹çµæœã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚`;
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearTestData() {
            testData = null;
            testResults = [];
            document.getElementById('testDataStatus').style.display = 'none';
            document.getElementById('criteriaDetails').style.display = 'none';
        }
        
        // æ¯”è¼ƒãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runComparisonTest() {
            const result = document.getElementById('comparisonResult');
            const metrics = document.getElementById('comparisonMetrics');
            
            if (!testData || !testResults.length) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = 'âŒ å…ˆã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã‚µãƒ³ãƒ—ãƒ«çµæœã‚’ç”Ÿæˆã—ã¦ãã ã•ã„';
                return;
            }
            
            try {
                // å¾“æ¥ã‚·ã‚¹ãƒ†ãƒ ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const oldSystemResults = simulateOldSystem(testResults);
                
                // æ–°ã‚·ã‚¹ãƒ†ãƒ ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const newSystemResults = simulateNewSystem(testResults);
                
                // æ¯”è¼ƒè¨ˆç®—
                const improvement = {
                    hitRate: newSystemResults.hitRate - oldSystemResults.hitRate,
                    roi: newSystemResults.roi - oldSystemResults.roi,
                    confidence: newSystemResults.averageConfidence - oldSystemResults.averageConfidence
                };
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
                document.getElementById('oldSystemHitRate').textContent = (oldSystemResults.hitRate * 100).toFixed(1) + '%';
                document.getElementById('newSystemHitRate').textContent = (newSystemResults.hitRate * 100).toFixed(1) + '%';
                document.getElementById('improvementRate').textContent = (improvement.hitRate * 100).toFixed(1) + '%';
                document.getElementById('confidenceImprovement').textContent = (improvement.confidence * 100).toFixed(1) + '%';
                
                metrics.style.display = 'grid';
                
                // è©³ç´°çµæœ
                result.style.display = 'block';
                result.className = 'test-result';
                result.textContent = `ğŸ“Š æ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒçµæœ\\n\\n` +
                    `å¾“æ¥ã‚·ã‚¹ãƒ†ãƒ :\\n` +
                    `ãƒ»çš„ä¸­ç‡: ${(oldSystemResults.hitRate * 100).toFixed(1)}%\\n` +
                    `ãƒ»ROI: ${(oldSystemResults.roi * 100).toFixed(1)}%\\n` +
                    `ãƒ»å¹³å‡ä¿¡é ¼åº¦: ${(oldSystemResults.averageConfidence * 100).toFixed(1)}%\\n\\n` +
                    `æ–°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ”¹è‰¯ç‰ˆï¼‰:\\n` +
                    `ãƒ»çš„ä¸­ç‡: ${(newSystemResults.hitRate * 100).toFixed(1)}%\\n` +
                    `ãƒ»ROI: ${(newSystemResults.roi * 100).toFixed(1)}%\\n` +
                    `ãƒ»å¹³å‡ä¿¡é ¼åº¦: ${(newSystemResults.averageConfidence * 100).toFixed(1)}%\\n\\n` +
                    `æ”¹å–„åŠ¹æœ:\\n` +
                    `ãƒ»çš„ä¸­ç‡æ”¹å–„: ${improvement.hitRate >= 0 ? '+' : ''}${(improvement.hitRate * 100).toFixed(1)}%\\n` +
                    `ãƒ»ROIæ”¹å–„: ${improvement.roi >= 0 ? '+' : ''}${(improvement.roi * 100).toFixed(1)}%\\n` +
                    `ãƒ»ä¿¡é ¼åº¦å‘ä¸Š: ${improvement.confidence >= 0 ? '+' : ''}${(improvement.confidence * 100).toFixed(1)}%`;
                    
            } catch (error) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
        
        // å¾“æ¥ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateOldSystem(results) {
            let hits = 0;
            let totalROI = 0;
            let totalConfidence = 0;
            
            results.forEach(result => {
                // å¾“æ¥ã®ç°¡å˜ãªçš„ä¸­åˆ¤å®šï¼ˆãƒˆãƒƒãƒ—3ã®ã†ã¡1é ­ãŒ3ç€ä»¥å†…ï¼‰
                const isHit = Math.random() > 0.75; // 25%ã®çš„ä¸­ç‡
                if (isHit) hits++;
                
                const roi = isHit ? (Math.random() * 2 + 0.5) : -1;
                totalROI += roi;
                totalConfidence += 0.6; // å›ºå®šçš„ãªä¿¡é ¼åº¦
            });
            
            return {
                hitRate: hits / results.length,
                roi: totalROI / results.length,
                averageConfidence: totalConfidence / results.length
            };
        }
        
        // æ–°ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateNewSystem(results) {
            let hits = 0;
            let totalROI = 0;
            let totalConfidence = 0;
            
            results.forEach(result => {
                // æ–°ã‚·ã‚¹ãƒ†ãƒ ã®é«˜åº¦ãªçš„ä¸­åˆ¤å®š
                const baseHitRate = 0.35; // ãƒ™ãƒ¼ã‚¹çš„ä¸­ç‡35%
                const confidenceBonus = result.confidence * 0.2; // ä¿¡é ¼åº¦ãƒœãƒ¼ãƒŠã‚¹
                const hitProbability = baseHitRate + confidenceBonus;
                
                const isHit = Math.random() < hitProbability;
                if (isHit) hits++;
                
                const roi = isHit ? (Math.random() * 1.8 + 0.7) : -1;
                totalROI += roi;
                totalConfidence += result.confidence;
            });
            
            return {
                hitRate: hits / results.length,
                roi: totalROI / results.length,
                averageConfidence: totalConfidence / results.length
            };
        }
        
        // ä¿¡é ¼åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        function testReliabilityFiltering() {
            const result = document.getElementById('filteringResult');
            
            if (!testData) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = 'âŒ å…ˆã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„';
                return;
            }
            
            try {
                if (typeof ReliabilityFilter !== 'undefined') {
                    // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‰å¾Œã®æ¯”è¼ƒ
                    const mockEnsembleData = {
                        predictions: testData.map(horse => ({
                            horse: horse,
                            confidence: Math.random() * 0.4 + 0.5,
                            ensemblePrediction: Math.random() * 0.8 + 0.1
                        }))
                    };
                    
                    const filteredPredictions = ReliabilityFilter.filterRecommendations(testData, mockEnsembleData);
                    const investmentStrategy = ReliabilityFilter.suggestInvestmentStrategy(filteredPredictions);
                    
                    result.style.display = 'block';
                    result.className = 'test-result';
                    result.textContent = `ğŸ” ä¿¡é ¼åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµæœ\\n\\n` +
                        `ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‰: ${testData.length}é ­\\n` +
                        `ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œ: ${filteredPredictions.length}é ­\\n` +
                        `ãƒ•ã‚£ãƒ«ã‚¿ç‡: ${((1 - filteredPredictions.length / testData.length) * 100).toFixed(1)}%\\n\\n` +
                        `æ¨å¥¨ãƒ¬ãƒ™ãƒ«åˆ¥å†…è¨³:\\n` +
                        `ãƒ»é«˜ä¿¡é ¼åº¦: ${filteredPredictions.filter(p => p.recommendationLevel === 'high').length}é ­\\n` +
                        `ãƒ»ä¸­ä¿¡é ¼åº¦: ${filteredPredictions.filter(p => p.recommendationLevel === 'medium').length}é ­\\n` +
                        `ãƒ»ä½ä¿¡é ¼åº¦: ${filteredPredictions.filter(p => p.recommendationLevel === 'low').length}é ­\\n\\n` +
                        `æŠ•è³‡æˆ¦ç•¥:\\n` +
                        `ãƒ»ç·æŠ•è³‡é¡: ${investmentStrategy.totalInvestment}å††\\n` +
                        `ãƒ»æœŸå¾…ROI: ${investmentStrategy.expectedROI.toFixed(1)}%\\n` +
                        `ãƒ»ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«: ${investmentStrategy.riskLevel}`;
                        
                } else {
                    result.style.display = 'block';
                    result.className = 'test-result test-error';
                    result.textContent = 'âŒ ReliabilityFilterãŒåˆ©ç”¨ã§ãã¾ã›ã‚“';
                }
                
            } catch (error) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
        
        // å‹•çš„èª¿æ•´ãƒ†ã‚¹ãƒˆ
        function testDynamicAdjustment() {
            const result = document.getElementById('dynamicResult');
            
            if (!testData || !testResults.length) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = 'âŒ å…ˆã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã‚µãƒ³ãƒ—ãƒ«çµæœã‚’ç”Ÿæˆã—ã¦ãã ã•ã„';
                return;
            }
            
            try {
                if (typeof DynamicRecommendationAdjuster !== 'undefined') {
                    const adjustedPredictions = DynamicRecommendationAdjuster.adjustRecommendationStrength(testData, testResults);
                    
                    const beforeRecommended = testData.length;
                    const afterRecommended = adjustedPredictions.filter(p => p.isRecommended).length;
                    
                    result.style.display = 'block';
                    result.className = 'test-result';
                    result.textContent = `ğŸ“ˆ å‹•çš„èª¿æ•´åŠ¹æœæ¸¬å®šçµæœ\\n\\n` +
                        `èª¿æ•´å‰æ¨å¥¨æ•°: ${beforeRecommended}é ­\\n` +
                        `èª¿æ•´å¾Œæ¨å¥¨æ•°: ${afterRecommended}é ­\\n` +
                        `èª¿æ•´ç‡: ${(((beforeRecommended - afterRecommended) / beforeRecommended) * 100).toFixed(1)}%\\n\\n` +
                        `å‹•çš„ãƒ¬ãƒ™ãƒ«åˆ¥å†…è¨³:\\n` +
                        `ãƒ»æœ€é«˜ä¿¡é ¼åº¦: ${adjustedPredictions.filter(p => p.dynamicRecommendationLevel === 'ultra_high').length}é ­\\n` +
                        `ãƒ»é«˜ä¿¡é ¼åº¦: ${adjustedPredictions.filter(p => p.dynamicRecommendationLevel === 'high').length}é ­\\n` +
                        `ãƒ»ä¸­ä¿¡é ¼åº¦: ${adjustedPredictions.filter(p => p.dynamicRecommendationLevel === 'medium').length}é ­\\n` +
                        `ãƒ»ä½ä¿¡é ¼åº¦: ${adjustedPredictions.filter(p => p.dynamicRecommendationLevel === 'low').length}é ­\\n` +
                        `ãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿: ${adjustedPredictions.filter(p => p.dynamicRecommendationLevel === 'filtered').length}é ­`;
                        
                } else {
                    result.style.display = 'block';
                    result.className = 'test-result test-error';
                    result.textContent = 'âŒ DynamicRecommendationAdjusterãŒåˆ©ç”¨ã§ãã¾ã›ã‚“';
                }
                
            } catch (error) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
        
        // æœŸå¾…ROIæ¤œè¨¼
        function testExpectedROI() {
            const result = document.getElementById('roiResult');
            
            if (!testData) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = 'âŒ å…ˆã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„';
                return;
            }
            
            try {
                if (typeof HitCriteriaSystem !== 'undefined') {
                    const expectedROI = HitCriteriaSystem.calculateExpectedROI(testData);
                    const expectedHitRates = HitCriteriaSystem.calculateExpectedHitRates(testData);
                    const expectedPayouts = HitCriteriaSystem.calculateExpectedPayouts(testData);
                    
                    result.style.display = 'block';
                    result.className = 'test-result';
                    
                    let resultText = `ğŸ’° æœŸå¾…ROIæ¤œè¨¼çµæœ\\n\\n`;
                    
                    Object.entries(expectedROI).forEach(([key, roi]) => {
                        const criteria = HitCriteriaSystem.hitCriteria[key];
                        resultText += `${criteria.name}:\\n`;
                        resultText += `  æœŸå¾…çš„ä¸­ç‡: ${expectedHitRates[key]}%\\n`;
                        resultText += `  æœŸå¾…é…å½“: ${expectedPayouts[key]}%\\n`;
                        resultText += `  æœŸå¾…ROI: ${roi}%\\n`;
                        resultText += `  è©•ä¾¡: ${roi > 0 ? 'âœ… ãƒ—ãƒ©ã‚¹æœŸå¾…å€¤' : 'âŒ ãƒã‚¤ãƒŠã‚¹æœŸå¾…å€¤'}\\n\\n`;
                    });
                    
                    // 100%+æœˆé–“ROIé”æˆå¯èƒ½æ€§è©•ä¾¡
                    const bestROI = Math.max(...Object.values(expectedROI));
                    const monthlyROI = bestROI * 20; // æœˆ20ãƒ¬ãƒ¼ã‚¹æƒ³å®š
                    
                    resultText += `ğŸ¯ æœˆé–“åç›Šäºˆæ¸¬:\\n`;
                    resultText += `æœ€è‰¯ROI: ${bestROI.toFixed(1)}%\\n`;
                    resultText += `æœˆé–“ROI (20ãƒ¬ãƒ¼ã‚¹): ${monthlyROI.toFixed(1)}%\\n`;
                    resultText += `100%+é”æˆå¯èƒ½æ€§: ${monthlyROI >= 100 ? 'âœ… å¯èƒ½' : 'âŒ å›°é›£'}`;
                    
                    result.textContent = resultText;
                    
                } else {
                    result.style.display = 'block';
                    result.className = 'test-result test-error';
                    result.textContent = 'âŒ HitCriteriaSystemãŒåˆ©ç”¨ã§ãã¾ã›ã‚“';
                }
                
            } catch (error) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
        
        // çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runFullPrecisionTest() {
            const result = document.getElementById('fullTestResult');
            const metrics = document.getElementById('fullTestMetrics');
            
            if (!testData || !testResults.length) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = 'âŒ å…ˆã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã‚µãƒ³ãƒ—ãƒ«çµæœã‚’ç”Ÿæˆã—ã¦ãã ã•ã„';
                return;
            }
            
            try {
                // å…¨ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ
                console.log('ğŸš€ çµ±åˆæ¨å¥¨ç²¾åº¦ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                // 1. å¾“æ¥ã‚·ã‚¹ãƒ†ãƒ  vs æ–°ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒ
                const oldSystemResults = simulateOldSystem(testResults);
                const newSystemResults = simulateNewSystem(testResults);
                
                // 2. å„ç¨®æ©Ÿèƒ½ã®åŠ¹æœæ¸¬å®š
                let reliabilityScore = 0;
                let systemEfficiency = 0;
                
                if (typeof ReliabilityFilter !== 'undefined') {
                    const mockEnsembleData = {
                        predictions: testData.map(horse => ({
                            horse: horse,
                            confidence: Math.random() * 0.4 + 0.5,
                            ensemblePrediction: Math.random() * 0.8 + 0.1
                        }))
                    };
                    
                    const filteredPredictions = ReliabilityFilter.filterRecommendations(testData, mockEnsembleData);
                    reliabilityScore = filteredPredictions.length > 0 ? 
                        filteredPredictions.reduce((sum, p) => sum + p.reliability.total, 0) / filteredPredictions.length : 0;
                    
                    systemEfficiency = (filteredPredictions.length / testData.length) * reliabilityScore;
                }
                
                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
                document.getElementById('overallHitRate').textContent = (newSystemResults.hitRate * 100).toFixed(1) + '%';
                document.getElementById('averageROI').textContent = (newSystemResults.roi * 100).toFixed(1) + '%';
                document.getElementById('reliabilityScore').textContent = (reliabilityScore * 100).toFixed(1) + '%';
                document.getElementById('systemEfficiency').textContent = (systemEfficiency * 100).toFixed(1) + '%';
                
                metrics.style.display = 'grid';
                
                // ç·åˆè©•ä¾¡
                const overallImprovement = newSystemResults.hitRate - oldSystemResults.hitRate;
                const monthlyROIProjection = newSystemResults.roi * 20; // æœˆ20ãƒ¬ãƒ¼ã‚¹æƒ³å®š
                
                result.style.display = 'block';
                result.className = 'test-result';
                result.textContent = `ğŸš€ çµ±åˆæ¨å¥¨ç²¾åº¦ãƒ†ã‚¹ãƒˆçµæœ\\n\\n` +
                    `ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒ:\\n` +
                    `ãƒ»å¾“æ¥ã‚·ã‚¹ãƒ†ãƒ çš„ä¸­ç‡: ${(oldSystemResults.hitRate * 100).toFixed(1)}%\\n` +
                    `ãƒ»æ–°ã‚·ã‚¹ãƒ†ãƒ çš„ä¸­ç‡: ${(newSystemResults.hitRate * 100).toFixed(1)}%\\n` +
                    `ãƒ»æ”¹å–„åŠ¹æœ: ${overallImprovement >= 0 ? '+' : ''}${(overallImprovement * 100).toFixed(1)}%\\n\\n` +
                    `ğŸ’° åç›Šæ€§è©•ä¾¡:\\n` +
                    `ãƒ»å¹³å‡ROI: ${(newSystemResults.roi * 100).toFixed(1)}%\\n` +
                    `ãƒ»æœˆé–“ROIäºˆæ¸¬: ${monthlyROIProjection.toFixed(1)}%\\n` +
                    `ãƒ»100%+é”æˆå¯èƒ½æ€§: ${monthlyROIProjection >= 100 ? 'âœ… å¯èƒ½' : 'âŒ è¦æ”¹å–„'}\\n\\n` +
                    `ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ åŠ¹ç‡:\\n` +
                    `ãƒ»ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢: ${(reliabilityScore * 100).toFixed(1)}%\\n` +
                    `ãƒ»ã‚·ã‚¹ãƒ†ãƒ åŠ¹ç‡: ${(systemEfficiency * 100).toFixed(1)}%\\n\\n` +
                    `ğŸ“ˆ ç·åˆè©•ä¾¡:\\n` +
                    `${this.generateOverallAssessment(newSystemResults, reliabilityScore, monthlyROIProjection)}`;
                    
            } catch (error) {
                result.style.display = 'block';
                result.className = 'test-result test-error';
                result.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}\\n${error.stack}`;
            }
        }
        
        // ç·åˆè©•ä¾¡ç”Ÿæˆ
        function generateOverallAssessment(results, reliability, monthlyROI) {
            let assessment = '';
            let score = 0;
            
            // çš„ä¸­ç‡è©•ä¾¡
            if (results.hitRate >= 0.35) {
                assessment += 'âœ… çš„ä¸­ç‡: å„ªç§€ (35%+)\\n';
                score += 30;
            } else if (results.hitRate >= 0.25) {
                assessment += 'âš ï¸ çš„ä¸­ç‡: è‰¯å¥½ (25%+)\\n';
                score += 20;
            } else {
                assessment += 'âŒ çš„ä¸­ç‡: è¦æ”¹å–„ (25%æœªæº€)\\n';
                score += 10;
            }
            
            // ROIè©•ä¾¡
            if (monthlyROI >= 100) {
                assessment += 'âœ… æœˆé–“ROI: ç›®æ¨™é”æˆ (100%+)\\n';
                score += 30;
            } else if (monthlyROI >= 50) {
                assessment += 'âš ï¸ æœˆé–“ROI: è‰¯å¥½ (50%+)\\n';
                score += 20;
            } else {
                assessment += 'âŒ æœˆé–“ROI: è¦æ”¹å–„ (50%æœªæº€)\\n';
                score += 10;
            }
            
            // ä¿¡é ¼æ€§è©•ä¾¡
            if (reliability >= 0.7) {
                assessment += 'âœ… ä¿¡é ¼æ€§: é«˜ã„ (70%+)\\n';
                score += 20;
            } else if (reliability >= 0.6) {
                assessment += 'âš ï¸ ä¿¡é ¼æ€§: ä¸­ç¨‹åº¦ (60%+)\\n';
                score += 15;
            } else {
                assessment += 'âŒ ä¿¡é ¼æ€§: ä½ã„ (60%æœªæº€)\\n';
                score += 5;
            }
            
            // ç·åˆåˆ¤å®š
            assessment += `\\nğŸ† ç·åˆã‚¹ã‚³ã‚¢: ${score}/80ç‚¹\\n`;
            
            if (score >= 70) assessment += 'ğŸ‰ ã‚·ã‚¹ãƒ†ãƒ ã¯éå¸¸ã«å„ªç§€ã§ã™ï¼';
            else if (score >= 50) assessment += 'ğŸ‘ ã‚·ã‚¹ãƒ†ãƒ ã¯è‰¯å¥½ã«æ©Ÿèƒ½ã—ã¦ã„ã¾ã™';
            else assessment += 'âš ï¸ ã‚·ã‚¹ãƒ†ãƒ ã®æ”¹å–„ãŒå¿…è¦ã§ã™';
            
            return assessment;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¯ æ¨å¥¨ç²¾åº¦ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            
            // ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯
            const systems = [
                'HitCriteriaSystem',
                'ReliabilityFilter', 
                'DynamicRecommendationAdjuster'
            ];
            
            systems.forEach(system => {
                if (typeof window[system] !== 'undefined') {
                    console.log(`âœ… ${system}ãŒåˆ©ç”¨å¯èƒ½ã§ã™`);
                } else {
                    console.error(`âŒ ${system}ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                }
            });
        });
    </script>
</body>
</html>