<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3é€£è¤‡ãƒ»3é€£å˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .horse-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 15px 0; }
        .horse-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
        .recommendation-card { background: #f8f9fa; border-left: 4px solid #007bff; padding: 15px; margin: 10px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦</h2>
        <p>æ–°ã—ãå®Ÿè£…ã—ãŸ3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨æ©Ÿèƒ½ã®å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚</p>
        <ul>
            <li>4é ­ä»¥ä¸Šã®å°ãŒã‚ã‚‹å ´åˆã®3é€£è¤‡æ¨å¥¨ç”Ÿæˆ</li>
            <li>3é€£å˜ï¼ˆç€é †å›ºå®šï¼‰æ¨å¥¨ç”Ÿæˆ</li>
            <li>æœŸå¾…å€¤è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼</li>
            <li>æ¨å¥¨æ¡ä»¶ï¼ˆ3é€£è¤‡:15%ä»¥ä¸Šã€3é€£å˜:8%ä»¥ä¸Šï¼‰ã®ç¢ºèª</li>
            <li>è¡¨ç¤ºå½¢å¼ã®ç¢ºèª</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‡ ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿è¨­å®š</h2>
        <button onclick="setupTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š</button>
        <button onclick="runTripleBoxTest()">3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        
        <div id="testDataDisplay" class="info test-result" style="display: none;">
            <h4>è¨­å®šã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</h4>
            <div id="horseList"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨çµæœ</h2>
        <div id="tripleBoxResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” è©³ç´°ãƒ­ã‚°</h2>
        <div id="detailLogs">
            <pre id="logDisplay">ãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</pre>
        </div>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ¢ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ -->
    <script>
        // ãƒ¢ãƒƒã‚¯ã‚³ãƒ³ãƒ•ã‚£ã‚°
        const CONFIG = {
            ODDS_THRESHOLDS: {
                VERY_LOW: 2.0,
                LOW: 4.0,
                MEDIUM: 10.0,
                HIGH: 25.0,
                VERY_HIGH: 50.0
            }
        };
        
        // ãƒ¢ãƒƒã‚¯å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ 
        class LearningSystem {
            static getLearningData() {
                return {
                    adjustments: { oddsWeight: 1.0, timeWeight: 1.0, jockeyWeight: 1.0 }
                };
            }
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æ ¼ç´
        let testPredictions = [];
        let testLogs = [];
        
        // ãƒ­ã‚°é–¢æ•°ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            testLogs.push(args.join(' '));
            originalConsoleLog.apply(console, args);
            updateLogDisplay();
        };
        
        function updateLogDisplay() {
            document.getElementById('logDisplay').textContent = testLogs.slice(-20).join('\n');
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®š
        function setupTestData() {
            testPredictions = [
                {
                    name: "ã‚µãƒ³ãƒ©ã‚¤ã‚ºãƒ›ãƒ¼ãƒ—",
                    odds: 2.1,
                    winProbability: 25.3,
                    placeProbability: 65.2,
                    winExpectedValue: 1.2
                },
                {
                    name: "ãƒŸãƒ©ã‚¯ãƒ«ã‚¹ã‚¿ãƒ¼",
                    odds: 4.5,
                    winProbability: 18.7,
                    placeProbability: 58.1,
                    winExpectedValue: 0.8
                },
                {
                    name: "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒœãƒ«ãƒˆ",
                    odds: 7.2,
                    winProbability: 12.4,
                    placeProbability: 45.3,
                    winExpectedValue: 0.9
                },
                {
                    name: "ã‚·ãƒ«ãƒãƒ¼ã‚¢ãƒ­ãƒ¼",
                    odds: 12.8,
                    winProbability: 8.1,
                    placeProbability: 38.7,
                    winExpectedValue: 1.0
                },
                {
                    name: "ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ",
                    odds: 18.4,
                    winProbability: 5.2,
                    placeProbability: 28.9,
                    winExpectedValue: 0.95
                },
                {
                    name: "ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚¦ã‚£ãƒ³ãƒ‰",
                    odds: 25.6,
                    winProbability: 3.8,
                    placeProbability: 22.1,
                    winExpectedValue: 0.97
                }
            ];
            
            // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
            const horseList = document.getElementById('horseList');
            horseList.innerHTML = testPredictions.map((horse, index) => `
                <div class="horse-card">
                    <strong>${index + 1}. ${horse.name}</strong><br>
                    ã‚ªãƒƒã‚º: ${horse.odds}å€ | å‹ç‡: ${horse.winProbability}% | è¤‡å‹ç‡: ${horse.placeProbability}%
                </div>
            `).join('');
            
            document.getElementById('testDataDisplay').style.display = 'block';
            
            testLogs = [];
            console.log('ğŸ‡ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ', { count: testPredictions.length });
        }
        
        // é¦¬ç•ªå–å¾—é–¢æ•°ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        function getHorseNumber(horseName) {
            const index = testPredictions.findIndex(h => h.name === horseName);
            return index !== -1 ? index + 1 : '?';
        }
        
        // 3é€£è¤‡ãƒ»3é€£å˜ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        function runTripleBoxTest() {
            if (testPredictions.length === 0) {
                alert('ã¾ãšãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }
            
            console.log('ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // BettingRecommenderã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ï¼ˆãƒ¢ãƒƒã‚¯èª¿æ•´æ¸ˆã¿ï¼‰
            const marks = BettingRecommender.classifyHorses(
                testPredictions, 
                [...testPredictions].sort((a, b) => b.winProbability - a.winProbability),
                [...testPredictions].sort((a, b) => b.winExpectedValue - a.winExpectedValue)
            );
            
            console.log('ğŸ… å°åˆ†é¡çµæœ', {
                honmei: marks.honmei?.name || 'ãªã—',
                taikou: marks.taikou?.name || 'ãªã—',
                tanana: marks.tanana?.name || 'ãªã—',
                renpuku: marks.renpuku?.name || 'ãªã—'
            });
            
            // 3é€£è¤‡æ¨å¥¨ç”Ÿæˆ
            const tripleBoxRecommendations = BettingRecommender.generateTripleBoxRecommendations(
                marks, 
                testPredictions, 
                getHorseNumber
            );
            
            // 3é€£å˜æ¨å¥¨ç”Ÿæˆ
            const tripleExactRecommendations = BettingRecommender.generateTripleExactRecommendations(
                marks, 
                testPredictions, 
                getHorseNumber
            );
            
            // çµæœè¡¨ç¤º
            displayTripleBoxResults([...tripleBoxRecommendations, ...tripleExactRecommendations], marks);
        }
        
        function displayTripleBoxResults(recommendations, marks) {
            const container = document.getElementById('tripleBoxResults');
            
            if (recommendations.length === 0) {
                container.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ 3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨ãªã—</h4>
                        <p>æ¡ä»¶ã‚’æº€ãŸã™çµ„ã¿åˆã‚ã›ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                        <p><strong>æ¡ä»¶:</strong> 3é ­ä»¥ä¸Šã®å° & 3é€£è¤‡åŠ¹ç‡15%ä»¥ä¸Š & 3é€£å˜åŠ¹ç‡8%ä»¥ä¸Š</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="test-result success">
                    <h4>âœ… 3é€£è¤‡ãƒ»3é€£å˜æ¨å¥¨ç”ŸæˆæˆåŠŸ</h4>
                    <p>æ¨å¥¨æ•°: ${recommendations.length}ä»¶</p>
                    <p>ç¨®åˆ¥: ${recommendations.filter(r => r.category === '3é€£è¤‡').length}ä»¶ã®3é€£è¤‡, ${recommendations.filter(r => r.category === '3é€£å˜').length}ä»¶ã®3é€£å˜</p>
                </div>
                
                <div class="test-result info">
                    <h4>ğŸ… å°åˆ†é¡</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div>â— æœ¬å‘½: ${marks.honmei?.name || 'ãªã—'}</div>
                        <div>â—‹ å¯¾æŠ—: ${marks.taikou?.name || 'ãªã—'}</div>
                        <div>â–² å˜ç©´: ${marks.tanana?.name || 'ãªã—'}</div>
                        <div>â–³ é€£è¤‡: ${marks.renpuku?.name || 'ãªã—'}</div>
                    </div>
                </div>
            `;
            
            recommendations.forEach((rec, index) => {
                html += `
                    <div class="recommendation-card">
                        <h4>ğŸ“‹ ${rec.category}æ¨å¥¨ #${index + 1}</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div>
                                <strong>å°:</strong> ${rec.mark}<br>
                                <strong>ã‚¿ã‚¤ãƒ—:</strong> ${rec.type}<br>
                                <strong>ä¿¡é ¼åº¦:</strong> ${rec.confidence}
                            </div>
                            <div>
                                <strong>é¦¬å:</strong><br>
                                ${rec.horse.replace(/- /g, '<br>')}
                            </div>
                            <div>
                                <strong>ã‚ªãƒƒã‚º:</strong> ${rec.odds}<br>
                                <strong>ç¢ºç‡:</strong> ${rec.probability}<br>
                                <strong>æ¨å¥¨é‡‘é¡:</strong> ${rec.amount}
                            </div>
                            <div>
                                <strong>åŠ¹ç‡:</strong> ${rec.efficiency ? rec.efficiency.toFixed(2) : 'N/A'}<br>
                                <span style="color: ${rec.efficiency > 1.0 ? 'green' : 'orange'};">
                                    ${rec.efficiency > 1.0 ? 'âœ… æœŸå¾…å€¤ãƒ—ãƒ©ã‚¹' : 'âš ï¸ æœŸå¾…å€¤æ³¨æ„'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function clearResults() {
            document.getElementById('tripleBoxResults').innerHTML = '';
            document.getElementById('testDataDisplay').style.display = 'none';
            testLogs = [];
            updateLogDisplay();
        }
    </script>
    
    <!-- bettingRecommender.jsã®ãƒ­ãƒ¼ãƒ‰ -->
    <script src="../js/bettingRecommender.js"></script>
    
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ 3é€£è¤‡æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
            
            // BettingRecommenderã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
            if (typeof BettingRecommender !== 'undefined') {
                console.log('âœ… BettingRecommenderã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
                
                // æ–°ã—ã„ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª
                if (typeof BettingRecommender.generateTripleBoxRecommendations === 'function') {
                    console.log('âœ… generateTripleBoxRecommendations ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã™');
                } else {
                    console.log('âŒ generateTripleBoxRecommendations ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                if (typeof BettingRecommender.calculateTripleBoxExpectedValue === 'function') {
                    console.log('âœ… calculateTripleBoxExpectedValue ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ã¾ã™');
                } else {
                    console.log('âŒ calculateTripleBoxExpectedValue ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } else {
                console.log('âŒ BettingRecommenderã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        });
    </script>
</body>
</html>