<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜å­¦ç¿’æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select, input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
    </style>
</head>
<body>
    <h1>ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜å­¦ç¿’æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆç›®çš„</h2>
        <p>3é€£è¤‡ãƒ»3é€£å˜ã®å­¦ç¿’æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <ul>
            <li>å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹•ä½œç¢ºèª</li>
            <li>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®è¨˜éŒ²ç¢ºèª</li>
            <li>åŠ¹ç‡é–¾å€¤ã®å‹•çš„èª¿æ•´ç¢ºèª</li>
            <li>çµ±è¨ˆè¡¨ç¤ºã®ç¢ºèª</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>ğŸ› ï¸ ãƒ†ã‚¹ãƒˆç’°å¢ƒè¨­å®š</h2>
        <button onclick="setupTestEnvironment()">ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–</button>
        <button onclick="clearTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
        
        <div id="testStatus" class="info test-section" style="display: none;">
            <h4>ãƒ†ã‚¹ãƒˆç’°å¢ƒçŠ¶æ…‹</h4>
            <div id="environmentInfo"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ² ãƒ†ã‚¹ãƒˆç”¨å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</h2>
        <p>å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã¨åŒã˜å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å­¦ç¿’ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        
        <div class="warning test-section">
            <h4>ğŸ‡ å®Ÿéš›ã®ç€é †çµæœ</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                <div class="form-group">
                    <label>1ç€é¦¬å</label>
                    <input type="text" id="actualFirst" placeholder="ä¾‹: ã‚µãƒ³ãƒ©ã‚¤ã‚ºãƒ›ãƒ¼ãƒ—" value="ã‚µãƒ³ãƒ©ã‚¤ã‚ºãƒ›ãƒ¼ãƒ—">
                </div>
                <div class="form-group">
                    <label>2ç€é¦¬å</label>
                    <input type="text" id="actualSecond" placeholder="ä¾‹: ãƒŸãƒ©ã‚¯ãƒ«ã‚¹ã‚¿ãƒ¼" value="ãƒŸãƒ©ã‚¯ãƒ«ã‚¹ã‚¿ãƒ¼">
                </div>
                <div class="form-group">
                    <label>3ç€é¦¬å</label>
                    <input type="text" id="actualThird" placeholder="ä¾‹: ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒœãƒ«ãƒˆ" value="ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒœãƒ«ãƒˆ">
                </div>
            </div>
        </div>
        
        <div class="warning test-section">
            <h4>ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜å­¦ç¿’çµæœå…¥åŠ›</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px;">
                <div class="form-group">
                    <label>ğŸ† 3é€£è¤‡çµæœ</label>
                    <select id="tripleBoxResult">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="hit">âœ… çš„ä¸­</option>
                        <option value="miss">âŒ å¤–ã‚Œ</option>
                        <option value="no-bet">â– è³¼å…¥ãªã—</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ 3é€£å˜çµæœ</label>
                    <select id="tripleExactResult">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="hit">âœ… çš„ä¸­</option>
                        <option value="miss">âŒ å¤–ã‚Œ</option>
                        <option value="no-bet">â– è³¼å…¥ãªã—</option>
                    </select>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>ğŸ’° 3é€£è¤‡é…å½“</label>
                    <input type="number" id="tripleBoxDividend" placeholder="ä¾‹: 1250">
                </div>
                <div class="form-group">
                    <label>ğŸ’° 3é€£å˜é…å½“</label>
                    <input type="number" id="tripleExactDividend" placeholder="ä¾‹: 15840">
                </div>
            </div>
        </div>
        
        <button onclick="runLearningTest()">ğŸ§  å­¦ç¿’ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="showTestStatistics()">ğŸ“Š å­¦ç¿’çµ±è¨ˆç¢ºèª</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="testResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
        <pre id="testLog">ãƒ†ã‚¹ãƒˆãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...\n</pre>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>

    <!-- å¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="../js/config.js"></script>
    <script src="../js/learningSystem.js"></script>
    
    <script>
        let testLogs = [];
        let testData = {
            horses: [
                { name: "ã‚µãƒ³ãƒ©ã‚¤ã‚ºãƒ›ãƒ¼ãƒ—", odds: 2.1 },
                { name: "ãƒŸãƒ©ã‚¯ãƒ«ã‚¹ã‚¿ãƒ¼", odds: 4.5 },
                { name: "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒœãƒ«ãƒˆ", odds: 7.2 },
                { name: "ã‚·ãƒ«ãƒãƒ¼ã‚¢ãƒ­ãƒ¼", odds: 12.8 },
                { name: "ã‚¯ãƒªãƒ ã‚¾ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ", odds: 18.4 }
            ]
        };
        
        function addTestLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            testLogs.push(`${timestamp} ${message}`);
            document.getElementById('testLog').textContent = testLogs.slice(-15).join('\n');
        }
        
        function clearLog() {
            testLogs = [];
            document.getElementById('testLog').textContent = 'ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...\n';
        }
        
        function setupTestEnvironment() {
            addTestLog('ğŸ”§ ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’åˆæœŸåŒ–ä¸­...');
            
            // LearningSystemã®åˆæœŸåŒ–ç¢ºèª
            if (typeof LearningSystem !== 'undefined') {
                addTestLog('âœ… LearningSystemã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã§ã™');
                
                // å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
                LearningSystem.initialize();
                addTestLog('âœ… LearningSystemåˆæœŸåŒ–å®Œäº†');
                
                // å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª
                if (typeof LearningSystem.processComplexBettingResults === 'function') {
                    addTestLog('âœ… processComplexBettingResults ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª');
                } else {
                    addTestLog('âŒ processComplexBettingResults ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                if (typeof LearningSystem.getComplexBettingThresholds === 'function') {
                    addTestLog('âœ… getComplexBettingThresholds ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª');
                } else {
                    addTestLog('âŒ getComplexBettingThresholds ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                if (typeof LearningSystem.showComplexBettingStats === 'function') {
                    addTestLog('âœ… showComplexBettingStats ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª');
                } else {
                    addTestLog('âŒ showComplexBettingStats ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // åˆæœŸé–¾å€¤ã‚’ç¢ºèª
                const thresholds = LearningSystem.getComplexBettingThresholds();
                addTestLog(`ğŸ“Š åˆæœŸé–¾å€¤: 3é€£è¤‡ãƒ¡ã‚¤ãƒ³=${thresholds.tripleBox.main}, 3é€£å˜ãƒ¡ã‚¤ãƒ³=${thresholds.tripleExact.main}`);
                
            } else {
                addTestLog('âŒ LearningSystemã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            const environmentInfo = document.getElementById('environmentInfo');
            environmentInfo.innerHTML = `
                <p><strong>ãƒ†ã‚¹ãƒˆé¦¬:</strong> ${testData.horses.map(h => h.name).join(', ')}</p>
                <p><strong>LearningSystem:</strong> ${typeof LearningSystem !== 'undefined' ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ æœªå¯¾å¿œ'}</p>
                <p><strong>ãƒ†ã‚¹ãƒˆæº–å‚™:</strong> âœ… å®Œäº†</p>
            `;
            
            document.getElementById('testStatus').style.display = 'block';
            addTestLog('ğŸ¯ ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–å®Œäº†');
        }
        
        function clearTestData() {
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('tripleBoxResult').value = '';
            document.getElementById('tripleExactResult').value = '';
            document.getElementById('tripleBoxDividend').value = '';
            document.getElementById('tripleExactDividend').value = '';
            
            addTestLog('ğŸ§¹ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }
        
        function runLearningTest() {
            addTestLog('ğŸ§  å­¦ç¿’ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const actualFirst = document.getElementById('actualFirst').value.trim();
            const actualSecond = document.getElementById('actualSecond').value.trim();
            const actualThird = document.getElementById('actualThird').value.trim();
            
            if (!actualFirst || !actualSecond || !actualThird) {
                addTestLog('âŒ 1-3ç€ã®é¦¬åã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ†ã‚¹ãƒˆç”¨ã®é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
            const mockHorses = testData.horses.map(h => ({
                name: h.name,
                odds: h.odds
            }));
            
            const firstHorse = mockHorses.find(h => h.name === actualFirst);
            const secondHorse = mockHorses.find(h => h.name === actualSecond);
            const thirdHorse = mockHorses.find(h => h.name === actualThird);
            
            if (!firstHorse || !secondHorse || !thirdHorse) {
                addTestLog('âŒ å…¥åŠ›ã•ã‚ŒãŸé¦¬åãŒãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«ã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            addTestLog(`ğŸ‡ ç€é †: 1ç€=${firstHorse.name}, 2ç€=${secondHorse.name}, 3ç€=${thirdHorse.name}`);
            
            // å­¦ç¿’å‰ã®é–¾å€¤ã‚’è¨˜éŒ²
            const beforeThresholds = LearningSystem.getComplexBettingThresholds();
            addTestLog(`ğŸ“Š å­¦ç¿’å‰é–¾å€¤: 3é€£è¤‡=${beforeThresholds.tripleBox.main.toFixed(3)}, 3é€£å˜=${beforeThresholds.tripleExact.main.toFixed(3)}`);
            
            try {
                // è¤‡é›‘é¦¬åˆ¸ç¨®ã®å­¦ç¿’ã‚’å®Ÿè¡Œ
                LearningSystem.processComplexBettingResults(firstHorse, secondHorse, thirdHorse);
                
                // å­¦ç¿’å¾Œã®é–¾å€¤ã‚’ç¢ºèª
                const afterThresholds = LearningSystem.getComplexBettingThresholds();
                addTestLog(`ğŸ“Š å­¦ç¿’å¾Œé–¾å€¤: 3é€£è¤‡=${afterThresholds.tripleBox.main.toFixed(3)}, 3é€£å˜=${afterThresholds.tripleExact.main.toFixed(3)}`);
                
                // é–¾å€¤å¤‰åŒ–ã‚’ç¢ºèª
                const tripleBoxChange = afterThresholds.tripleBox.main - beforeThresholds.tripleBox.main;
                const tripleExactChange = afterThresholds.tripleExact.main - beforeThresholds.tripleExact.main;
                
                if (Math.abs(tripleBoxChange) > 0.001 || Math.abs(tripleExactChange) > 0.001) {
                    addTestLog(`ğŸ“ˆ é–¾å€¤ãŒå­¦ç¿’ã«ã‚ˆã‚Šèª¿æ•´ã•ã‚Œã¾ã—ãŸ: 3é€£è¤‡${tripleBoxChange > 0 ? '+' : ''}${tripleBoxChange.toFixed(3)}, 3é€£å˜${tripleExactChange > 0 ? '+' : ''}${tripleExactChange.toFixed(3)}`);
                } else {
                    addTestLog('ğŸ“Š ä»Šå›ã®å­¦ç¿’ã§ã¯é–¾å€¤ã«å¤§ããªå¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }
                
                addTestLog('âœ… è¤‡é›‘é¦¬åˆ¸ç¨®å­¦ç¿’ãƒ†ã‚¹ãƒˆå®Œäº†');
                
                // çµæœã‚’è¡¨ç¤º
                showTestResults(beforeThresholds, afterThresholds);
                
            } catch (error) {
                addTestLog(`âŒ å­¦ç¿’ãƒ†ã‚¹ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('å­¦ç¿’ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        function showTestResults(beforeThresholds, afterThresholds) {
            const resultsContainer = document.getElementById('testResults');
            
            const tripleBoxResult = document.getElementById('tripleBoxResult').value;
            const tripleExactResult = document.getElementById('tripleExactResult').value;
            const tripleBoxDividend = document.getElementById('tripleBoxDividend').value;
            const tripleExactDividend = document.getElementById('tripleExactDividend').value;
            
            let html = `
                <div class="success test-section">
                    <h4>âœ… å­¦ç¿’ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>å…¥åŠ›ãƒ‡ãƒ¼ã‚¿:</strong></p>
                    <ul>
                        <li>3é€£è¤‡çµæœ: ${tripleBoxResult || 'ãªã—'}</li>
                        <li>3é€£å˜çµæœ: ${tripleExactResult || 'ãªã—'}</li>
                        <li>3é€£è¤‡é…å½“: ${tripleBoxDividend || 'ãªã—'}å††</li>
                        <li>3é€£å˜é…å½“: ${tripleExactDividend || 'ãªã—'}å††</li>
                    </ul>
                    
                    <p><strong>åŠ¹ç‡é–¾å€¤ã®å¤‰åŒ–:</strong></p>
                    <ul>
                        <li>3é€£è¤‡ãƒ¡ã‚¤ãƒ³: ${beforeThresholds.tripleBox.main.toFixed(3)} â†’ ${afterThresholds.tripleBox.main.toFixed(3)}</li>
                        <li>3é€£è¤‡ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ${beforeThresholds.tripleBox.formation.toFixed(3)} â†’ ${afterThresholds.tripleBox.formation.toFixed(3)}</li>
                        <li>3é€£å˜ãƒ¡ã‚¤ãƒ³: ${beforeThresholds.tripleExact.main.toFixed(3)} â†’ ${afterThresholds.tripleExact.main.toFixed(3)}</li>
                        <li>3é€£å˜ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ${beforeThresholds.tripleExact.formation.toFixed(3)} â†’ ${afterThresholds.tripleExact.formation.toFixed(3)}</li>
                    </ul>
                </div>
            `;
            
            resultsContainer.innerHTML = html;
        }
        
        function showTestStatistics() {
            if (typeof LearningSystem.showComplexBettingStats === 'function') {
                addTestLog('ğŸ“Š è¤‡é›‘é¦¬åˆ¸ç¨®çµ±è¨ˆã‚’è¡¨ç¤ºä¸­...');
                LearningSystem.showComplexBettingStats();
            } else {
                addTestLog('âŒ showComplexBettingStatsé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestLog('ğŸ¯ 3é€£è¤‡ãƒ»3é€£å˜å­¦ç¿’æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ');
        });
    </script>
</body>
</html>