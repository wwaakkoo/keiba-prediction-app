<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ€§èƒ½æ¸¬å®š</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-section { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { transform: translateY(-1px); }
        .result-card { background: #f8f9fa; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error-card { background: #f8f9fa; border-left: 4px solid #dc3545; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; }
        .metric-card { background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center; }
        .progress-bar { width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(45deg, #28a745, #20c997); transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Phase 3ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ€§èƒ½æ¸¬å®š</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½</h2>
            <p>Phase 1+2çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®ç¾åœ¨æ€§èƒ½ã‚’æ¸¬å®šã—ã€Phase 3æ”¹å–„ã®åŸºæº–ã‚’è¨­å®šã—ã¾ã™</p>
            
            <div class="btn-grid">
                <button class="btn" onclick="measureCurrentPerformance()">ğŸ“ˆ ç¾åœ¨æ€§èƒ½æ¸¬å®š</button>
                <button class="btn" onclick="testPredictionAccuracy()">ğŸ¯ äºˆæ¸¬ç²¾åº¦ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testInvestmentEfficiency()">ğŸ’° æŠ•è³‡åŠ¹ç‡ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testSystemResponse()">âš¡ ã‚·ã‚¹ãƒ†ãƒ å¿œç­”æ€§ãƒ†ã‚¹ãƒˆ</button>
            </div>
            
            <div id="performanceResults"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­¦ç¿’æº–å‚™ãƒ†ã‚¹ãƒˆ</h2>
            <p>Phase 3ã§å®Ÿè£…äºˆå®šã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­¦ç¿’æ©Ÿèƒ½ã®åŸºç›¤ãƒ†ã‚¹ãƒˆ</p>
            
            <div class="btn-grid">
                <button class="btn" onclick="testDataCollectionSpeed()">ğŸ“Š ãƒ‡ãƒ¼ã‚¿åé›†é€Ÿåº¦</button>
                <button class="btn" onclick="testLearningCapacity()">ğŸ§  å­¦ç¿’å®¹é‡ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn" onclick="testAdaptationSpeed()">ğŸ”„ é©å¿œé€Ÿåº¦ãƒ†ã‚¹ãƒˆ</button>
            </div>
            
            <div id="learningResults"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ æ€§èƒ½æŒ‡æ¨™ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>äºˆæ¸¬ç²¾åº¦</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="accuracyProgress" style="width: 0%"></div>
                    </div>
                    <span id="accuracyValue">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metric-card">
                    <h3>æŠ•è³‡åŠ¹ç‡</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="efficiencyProgress" style="width: 0%"></div>
                    </div>
                    <span id="efficiencyValue">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metric-card">
                    <h3>å¿œç­”é€Ÿåº¦</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="responseProgress" style="width: 0%"></div>
                    </div>
                    <span id="responseValue">æ¸¬å®šä¸­...</span>
                </div>
                <div class="metric-card">
                    <h3>å­¦ç¿’åŠ¹ç‡</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="learningProgress" style="width: 0%"></div>
                    </div>
                    <span id="learningValue">æ¸¬å®šä¸­...</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ Phase 3å®Ÿè£…å„ªå…ˆåº¦</h2>
            <div id="priorityAnalysis">
                <p>ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šå®Œäº†å¾Œã€æ”¹å–„å„ªå…ˆåº¦ã‚’è‡ªå‹•ç®—å‡ºã—ã¾ã™</p>
            </div>
        </div>
    </div>

    <script>
        // ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ€§èƒ½æ¸¬å®šã‚·ã‚¹ãƒ†ãƒ 
        let baselineMetrics = {
            predictionAccuracy: 0,
            investmentEfficiency: 0,
            systemResponse: 0,
            learningCapacity: 0
        };

        function measureCurrentPerformance() {
            console.log('ğŸ“Š Phase 1+2çµ±åˆã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½æ¸¬å®šé–‹å§‹');
            const results = document.getElementById('performanceResults');
            results.innerHTML = '<div class="result-card"><h4>æ€§èƒ½æ¸¬å®šå®Ÿè¡Œä¸­...</h4></div>';
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ç¾åœ¨ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè¡Œ
            const testData = generateTestHorseData();
            
            // Phase 1: ä¿¡é ¼åº¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ€§èƒ½
            let phase1Performance = 0;
            if (typeof ReliabilityFilter !== 'undefined') {
                const startTime = performance.now();
                const filtered = ReliabilityFilter.filterRecommendations(testData, null);
                const endTime = performance.now();
                phase1Performance = {
                    executionTime: endTime - startTime,
                    filteredCount: filtered.length,
                    originalCount: testData.length,
                    efficiency: filtered.length / testData.length
                };
            }
            
            // Phase 2: æŠ•è³‡æˆ¦ç•¥æœ€é©åŒ–æ€§èƒ½
            let phase2Performance = 0;
            if (typeof RiskManagementInvestmentSystem !== 'undefined') {
                const startTime = performance.now();
                const allocation = RiskManagementInvestmentSystem.calculateOptimalAllocation(testData);
                const endTime = performance.now();
                phase2Performance = {
                    executionTime: endTime - startTime,
                    totalInvestment: allocation.totalInvestment,
                    expectedReturn: allocation.expectedReturn,
                    portfolioRisk: allocation.portfolioRisk
                };
            }
            
            // çµæœè¡¨ç¤º
            results.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ“Š Phase 1+2çµ±åˆæ€§èƒ½æ¸¬å®šçµæœ</h4>
                    <p><strong>Phase 1æ€§èƒ½:</strong></p>
                    <ul>
                        <li>å®Ÿè¡Œæ™‚é–“: ${phase1Performance.executionTime?.toFixed(2) || 'N/A'}ms</li>
                        <li>ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°åŠ¹ç‡: ${((phase1Performance.efficiency || 0) * 100).toFixed(1)}%</li>
                        <li>æ¨å¥¨æ•°: ${phase1Performance.filteredCount || 0}/${phase1Performance.originalCount || 0}é ­</li>
                    </ul>
                    <p><strong>Phase 2æ€§èƒ½:</strong></p>
                    <ul>
                        <li>å®Ÿè¡Œæ™‚é–“: ${phase2Performance.executionTime?.toFixed(2) || 'N/A'}ms</li>
                        <li>æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³: ${((phase2Performance.expectedReturn || 0) * 100).toFixed(1)}%</li>
                        <li>ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒªã‚¹ã‚¯: ${((phase2Performance.portfolioRisk || 0) * 100).toFixed(1)}%</li>
                        <li>æŠ•è³‡é¡: ${(phase2Performance.totalInvestment || 0).toLocaleString()}å††</li>
                    </ul>
                </div>
            `;
            
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateMetrics('current', phase1Performance, phase2Performance);
        }

        function testPredictionAccuracy() {
            console.log('ğŸ¯ äºˆæ¸¬ç²¾åº¦ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // éå»ãƒ‡ãƒ¼ã‚¿ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const testCases = 50; // 50ãƒ¬ãƒ¼ã‚¹åˆ†ã®ãƒ†ã‚¹ãƒˆ
            let correctPredictions = 0;
            let totalPredictions = 0;
            
            for (let i = 0; i < testCases; i++) {
                const horses = generateTestHorseData(8 + Math.floor(Math.random() * 8)); // 8-16é ­
                
                // å®Ÿéš›ã®ç€é †ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆã‚ªãƒƒã‚ºã«åŸºã¥ãç¢ºç‡çš„çµæœï¼‰
                const actualResult = simulateRaceResult(horses);
                
                // ã‚·ã‚¹ãƒ†ãƒ äºˆæ¸¬å®Ÿè¡Œ
                if (typeof PredictionEngine !== 'undefined') {
                    // ç°¡æ˜“äºˆæ¸¬ï¼ˆå®Ÿéš›ã®ã‚¨ãƒ³ã‚¸ãƒ³ã¯è¤‡é›‘ï¼‰
                    const predictions = horses.map(horse => ({
                        name: horse.name,
                        winProbability: Math.max(1, 100 / parseFloat(horse.odds))
                    })).sort((a, b) => b.winProbability - a.winProbability);
                    
                    // ä¸Šä½3é ­äºˆæƒ³ã®ã†ã¡1é ­ãŒ3ç€ä»¥å†…ã«å…¥ã‚Œã°æˆåŠŸ
                    const top3Predictions = predictions.slice(0, 3);
                    const hit = top3Predictions.some(pred => 
                        [actualResult.first, actualResult.second, actualResult.third].includes(pred.name)
                    );
                    
                    if (hit) correctPredictions++;
                    totalPredictions++;
                }
            }
            
            const accuracy = totalPredictions > 0 ? correctPredictions / totalPredictions : 0;
            baselineMetrics.predictionAccuracy = accuracy;
            
            // çµæœè¡¨ç¤º
            document.getElementById('performanceResults').innerHTML += `
                <div class="result-card">
                    <h4>ğŸ¯ äºˆæ¸¬ç²¾åº¦ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>çš„ä¸­ç‡:</strong> ${(accuracy * 100).toFixed(1)}% (${correctPredictions}/${totalPredictions})</p>
                    <p><strong>è©•ä¾¡:</strong> ${accuracy > 0.25 ? 'è‰¯å¥½' : accuracy > 0.15 ? 'æ¨™æº–' : 'è¦æ”¹å–„'}</p>
                </div>
            `;
            
            updateProgressBar('accuracyProgress', 'accuracyValue', accuracy * 100, '% çš„ä¸­ç‡');
        }

        function testInvestmentEfficiency() {
            console.log('ğŸ’° æŠ•è³‡åŠ¹ç‡ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // ROIã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const testRaces = 30;
            let totalInvested = 0;
            let totalReturned = 0;
            
            for (let i = 0; i < testRaces; i++) {
                const horses = generateTestHorseData();
                
                // Phase 2æŠ•è³‡æˆ¦ç•¥é©ç”¨
                if (typeof RiskManagementInvestmentSystem !== 'undefined') {
                    const allocation = RiskManagementInvestmentSystem.calculateOptimalAllocation(horses, 10000);
                    totalInvested += allocation.totalInvestment;
                    
                    // çµæœã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæœŸå¾…å€¤ãƒ™ãƒ¼ã‚¹ï¼‰
                    const simulatedReturn = allocation.totalInvestment * (1 + allocation.expectedReturn) * (Math.random() * 0.8 + 0.6);
                    totalReturned += simulatedReturn;
                }
            }
            
            const roi = totalInvested > 0 ? (totalReturned - totalInvested) / totalInvested : 0;
            baselineMetrics.investmentEfficiency = Math.max(0, roi + 0.5); // æ­£è¦åŒ–
            
            document.getElementById('performanceResults').innerHTML += `
                <div class="result-card">
                    <h4>ğŸ’° æŠ•è³‡åŠ¹ç‡ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>ROI:</strong> ${(roi * 100).toFixed(1)}%</p>
                    <p><strong>ç·æŠ•è³‡é¡:</strong> ${totalInvested.toLocaleString()}å††</p>
                    <p><strong>ç·å›åé¡:</strong> ${totalReturned.toLocaleString()}å††</p>
                    <p><strong>è©•ä¾¡:</strong> ${roi > 0.1 ? 'å„ªç§€' : roi > 0 ? 'è‰¯å¥½' : 'è¦æ”¹å–„'}</p>
                </div>
            `;
            
            updateProgressBar('efficiencyProgress', 'efficiencyValue', Math.max(0, roi * 100 + 50), '% åŠ¹ç‡');
        }

        function testSystemResponse() {
            console.log('âš¡ ã‚·ã‚¹ãƒ†ãƒ å¿œç­”æ€§ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const iterations = 10;
            let totalTime = 0;
            
            for (let i = 0; i < iterations; i++) {
                const horses = generateTestHorseData();
                const startTime = performance.now();
                
                // å…¨ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œ
                if (typeof ReliabilityFilter !== 'undefined') {
                    ReliabilityFilter.filterRecommendations(horses, null);
                }
                if (typeof RiskManagementInvestmentSystem !== 'undefined') {
                    RiskManagementInvestmentSystem.calculateOptimalAllocation(horses);
                }
                
                const endTime = performance.now();
                totalTime += (endTime - startTime);
            }
            
            const averageTime = totalTime / iterations;
            const responseScore = Math.max(0, Math.min(100, 100 - averageTime / 10)); // 1ç§’=10ç‚¹æ¸›ç‚¹
            baselineMetrics.systemResponse = responseScore / 100;
            
            document.getElementById('performanceResults').innerHTML += `
                <div class="result-card">
                    <h4>âš¡ ã‚·ã‚¹ãƒ†ãƒ å¿œç­”æ€§ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>å¹³å‡å®Ÿè¡Œæ™‚é–“:</strong> ${averageTime.toFixed(2)}ms</p>
                    <p><strong>å¿œç­”æ€§ã‚¹ã‚³ã‚¢:</strong> ${responseScore.toFixed(1)}/100</p>
                    <p><strong>è©•ä¾¡:</strong> ${responseScore > 80 ? 'é«˜é€Ÿ' : responseScore > 60 ? 'æ¨™æº–' : 'è¦æœ€é©åŒ–'}</p>
                </div>
            `;
            
            updateProgressBar('responseProgress', 'responseValue', responseScore, '/100 å¿œç­”æ€§');
        }

        function testDataCollectionSpeed() {
            console.log('ğŸ“Š ãƒ‡ãƒ¼ã‚¿åé›†é€Ÿåº¦ãƒ†ã‚¹ãƒˆ');
            
            // LocalStorageèª­ã¿æ›¸ãé€Ÿåº¦ãƒ†ã‚¹ãƒˆ
            const testData = generateLargeTestData(1000);
            
            const writeStart = performance.now();
            localStorage.setItem('phase3_test_data', JSON.stringify(testData));
            const writeTime = performance.now() - writeStart;
            
            const readStart = performance.now();
            const readData = JSON.parse(localStorage.getItem('phase3_test_data'));
            const readTime = performance.now() - readStart;
            
            localStorage.removeItem('phase3_test_data');
            
            document.getElementById('learningResults').innerHTML = `
                <div class="result-card">
                    <h4>ğŸ“Š ãƒ‡ãƒ¼ã‚¿åé›†é€Ÿåº¦ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>æ›¸ãè¾¼ã¿æ™‚é–“:</strong> ${writeTime.toFixed(2)}ms (1000ä»¶)</p>
                    <p><strong>èª­ã¿è¾¼ã¿æ™‚é–“:</strong> ${readTime.toFixed(2)}ms (1000ä»¶)</p>
                    <p><strong>è©•ä¾¡:</strong> ${writeTime < 50 && readTime < 20 ? 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­¦ç¿’å¯¾å¿œå¯èƒ½' : 'æœ€é©åŒ–æ¨å¥¨'}</p>
                </div>
            `;
        }

        function testLearningCapacity() {
            console.log('ğŸ§  å­¦ç¿’å®¹é‡ãƒ†ã‚¹ãƒˆ');
            
            // æ—¢å­˜å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºç¢ºèª
            const learningData = JSON.stringify(LearningSystem?.getLearningData() || {});
            const currentSize = new Blob([learningData]).size;
            
            // æ‹¡å¼µå¯èƒ½æ€§ãƒ†ã‚¹ãƒˆ
            const maxCapacity = 5 * 1024 * 1024; // 5MBæƒ³å®š
            const utilizationRate = currentSize / maxCapacity;
            
            baselineMetrics.learningCapacity = Math.max(0, 1 - utilizationRate);
            
            document.getElementById('learningResults').innerHTML += `
                <div class="result-card">
                    <h4>ğŸ§  å­¦ç¿’å®¹é‡ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>ç¾åœ¨ä½¿ç”¨é‡:</strong> ${(currentSize / 1024).toFixed(1)}KB</p>
                    <p><strong>ä½¿ç”¨ç‡:</strong> ${(utilizationRate * 100).toFixed(1)}%</p>
                    <p><strong>æ®‹ã‚Šå®¹é‡:</strong> ${((maxCapacity - currentSize) / 1024 / 1024).toFixed(1)}MB</p>
                    <p><strong>è©•ä¾¡:</strong> ${utilizationRate < 0.7 ? 'ååˆ†ãªä½™è£•' : 'å®¹é‡æœ€é©åŒ–æ¨å¥¨'}</p>
                </div>
            `;
            
            updateProgressBar('learningProgress', 'learningValue', (1 - utilizationRate) * 100, '% ä½™è£•');
        }

        function testAdaptationSpeed() {
            console.log('ğŸ”„ é©å¿œé€Ÿåº¦ãƒ†ã‚¹ãƒˆ');
            
            // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿æ›´æ–°é€Ÿåº¦ãƒ†ã‚¹ãƒˆ
            const testUpdates = 100;
            const startTime = performance.now();
            
            for (let i = 0; i < testUpdates; i++) {
                // ç°¡æ˜“å­¦ç¿’æ›´æ–°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const mockResult = {
                    first: `Horse${Math.floor(Math.random() * 10) + 1}`,
                    second: `Horse${Math.floor(Math.random() * 10) + 1}`,
                    third: `Horse${Math.floor(Math.random() * 10) + 1}`
                };
                
                // å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°ï¼ˆå®Ÿéš›ã®å‡¦ç†ã¯ç°¡ç•¥åŒ–ï¼‰
                if (typeof LearningSystem !== 'undefined') {
                    // å®Ÿéš›ã®æ›´æ–°ã¯è¡Œã‚ãšã€å‡¦ç†æ™‚é–“ã®ã¿æ¸¬å®š
                }
            }
            
            const endTime = performance.now();
            const adaptationTime = endTime - startTime;
            const adaptationScore = Math.max(0, Math.min(100, 100 - adaptationTime / 100));
            
            document.getElementById('learningResults').innerHTML += `
                <div class="result-card">
                    <h4>ğŸ”„ é©å¿œé€Ÿåº¦ãƒ†ã‚¹ãƒˆçµæœ</h4>
                    <p><strong>100å›æ›´æ–°æ™‚é–“:</strong> ${adaptationTime.toFixed(2)}ms</p>
                    <p><strong>é©å¿œé€Ÿåº¦ã‚¹ã‚³ã‚¢:</strong> ${adaptationScore.toFixed(1)}/100</p>
                    <p><strong>è©•ä¾¡:</strong> ${adaptationScore > 80 ? 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯¾å¿œå¯èƒ½' : 'æœ€é©åŒ–å¿…è¦'}</p>
                </div>
            `;
        }

        function updateProgressBar(progressId, valueId, percentage, suffix) {
            document.getElementById(progressId).style.width = Math.min(100, percentage) + '%';
            document.getElementById(valueId).textContent = percentage.toFixed(1) + suffix;
        }

        function updateMetrics(type, phase1Data, phase2Data) {
            if (type === 'current') {
                // ç¾åœ¨ã®æ€§èƒ½ã‚’ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è¨­å®š
                analyzePriority();
            }
        }

        function analyzePriority() {
            const priorities = [];
            
            if (baselineMetrics.predictionAccuracy < 0.25) {
                priorities.push({ 
                    system: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿæ¢°å­¦ç¿’', 
                    priority: 'HIGH',
                    reason: 'äºˆæ¸¬ç²¾åº¦ãŒç›®æ¨™å€¤(25%)ã‚’ä¸‹å›ã£ã¦ã„ã‚‹',
                    expectedImprovement: '+10%ç²¾åº¦å‘ä¸Š'
                });
            }
            
            if (baselineMetrics.investmentEfficiency < 0.15) {
                priorities.push({ 
                    system: 'å¸‚å ´ç’°å¢ƒé©å¿œå‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ', 
                    priority: 'HIGH',
                    reason: 'ROIãŒç›®æ¨™å€¤(15%)ã‚’ä¸‹å›ã£ã¦ã„ã‚‹',
                    expectedImprovement: '+20%åç›Šå‘ä¸Š'
                });
            }
            
            if (baselineMetrics.systemResponse < 0.8) {
                priorities.push({ 
                    system: 'å¤šæ¬¡å…ƒç‰¹å¾´é‡åˆ†ææœ€é©åŒ–', 
                    priority: 'MEDIUM',
                    reason: 'ã‚·ã‚¹ãƒ†ãƒ å¿œç­”æ€§ã«æ”¹å–„ä½™åœ°',
                    expectedImprovement: '+50%é«˜é€ŸåŒ–'
                });
            }
            
            priorities.push({ 
                system: 'A/Bãƒ†ã‚¹ãƒˆæˆ¦ç•¥æ¯”è¼ƒ', 
                priority: 'MEDIUM',
                reason: 'æˆ¦ç•¥æœ€é©åŒ–ã®ç¶™ç¶šçš„æ”¹å–„',
                expectedImprovement: '+5%åŠ¹ç‡å‘ä¸Š'
            });
            
            priorities.push({ 
                system: 'å€‹åˆ¥ãƒ¬ãƒ¼ã‚¹ç‰¹æ€§å¯¾å¿œ', 
                priority: 'LOW',
                reason: 'ç‰¹æ®Šã‚±ãƒ¼ã‚¹å¯¾å¿œã®ç²¾åº¦å‘ä¸Š',
                expectedImprovement: '+3%ç²¾åº¦å‘ä¸Š'
            });
            
            // å„ªå…ˆåº¦è¡¨ç¤º
            const priorityHtml = priorities.map(p => `
                <div class="result-card" style="border-left-color: ${
                    p.priority === 'HIGH' ? '#dc3545' : 
                    p.priority === 'MEDIUM' ? '#ffc107' : '#28a745'
                }">
                    <h4>${p.system} [${p.priority}]</h4>
                    <p><strong>ç†ç”±:</strong> ${p.reason}</p>
                    <p><strong>æœŸå¾…åŠ¹æœ:</strong> ${p.expectedImprovement}</p>
                </div>
            `).join('');
            
            document.getElementById('priorityAnalysis').innerHTML = `
                <h4>ğŸ“Š Phase 3å®Ÿè£…å„ªå…ˆåº¦åˆ†æçµæœ</h4>
                ${priorityHtml}
                <div class="result-card">
                    <h4>ğŸ¯ æ¨å¥¨å®Ÿè£…é †åº</h4>
                    <ol>
                        ${priorities.filter(p => p.priority === 'HIGH').map(p => `<li>${p.system}</li>`).join('')}
                        ${priorities.filter(p => p.priority === 'MEDIUM').map(p => `<li>${p.system}</li>`).join('')}
                        ${priorities.filter(p => p.priority === 'LOW').map(p => `<li>${p.system}</li>`).join('')}
                    </ol>
                </div>
            `;
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function generateTestHorseData(count = 10) {
            const horses = [];
            for (let i = 1; i <= count; i++) {
                horses.push({
                    name: `TestHorse${i}`,
                    odds: Math.random() * 20 + 1,
                    popularity: i,
                    age: Math.floor(Math.random() * 6) + 3,
                    weight: Math.floor(Math.random() * 100) + 400,
                    winProbability: Math.random() * 80 + 5
                });
            }
            return horses;
        }

        function simulateRaceResult(horses) {
            // ã‚ªãƒƒã‚ºã«åŸºã¥ãç¢ºç‡çš„ãªçµæœç”Ÿæˆ
            const weighted = horses.map(horse => ({
                name: horse.name,
                weight: 1 / parseFloat(horse.odds)
            }));
            
            const results = [];
            const remaining = [...weighted];
            
            for (let pos = 0; pos < 3; pos++) {
                const totalWeight = remaining.reduce((sum, h) => sum + h.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (let i = 0; i < remaining.length; i++) {
                    random -= remaining[i].weight;
                    if (random <= 0) {
                        results.push(remaining[i].name);
                        remaining.splice(i, 1);
                        break;
                    }
                }
            }
            
            return {
                first: results[0],
                second: results[1],
                third: results[2]
            };
        }

        function generateLargeTestData(size) {
            const data = [];
            for (let i = 0; i < size; i++) {
                data.push({
                    id: i,
                    raceData: generateTestHorseData(),
                    timestamp: Date.now(),
                    result: Math.random()
                });
            }
            return data;
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª Phase 3ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
        });
    </script>
</body>
</html>