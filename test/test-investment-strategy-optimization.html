<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2: æŠ•è³‡æˆ¦ç•¥æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 40px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #4ECDC4;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        .control-group select,
        .control-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #4ECDC4;
        }
        
        .btn {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #FF6B6B, #EE5A52);
        }
        
        .results {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4ECDC4;
        }
        
        .metric-card h4 {
            color: #333;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #4ECDC4;
        }
        
        .investment-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .investment-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .investment-card.recommended {
            border-color: #4ECDC4;
            background: #f0fffe;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            transition: width 0.5s ease;
        }
        
        .log-area {
            background: #2d3748;
            color: #68d391;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Phase 2: æŠ•è³‡æˆ¦ç•¥æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>ãƒªã‚¹ã‚¯ç®¡ç†ãƒ»ã‚±ãƒªãƒ¼åŸºæº–ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æãƒ»åˆ¸ç¨®æœ€é©åŒ–ãƒ»ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ã®çµ±åˆãƒ†ã‚¹ãƒˆ</p>
        </div>

        <div class="content">
            <!-- ã‚·ã‚¹ãƒ†ãƒ è¨­å®š -->
            <div class="test-section">
                <h2>âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>
                <div class="control-panel">
                    <div class="control-group">
                        <label for="riskProfile">ãƒªã‚¹ã‚¯ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</label>
                        <select id="riskProfile">
                            <option value="conservative">ä¿å®ˆçš„ (ãƒªã‚¹ã‚¯é‡è¦–)</option>
                            <option value="moderate" selected>ä¸­åº¸çš„ (ãƒãƒ©ãƒ³ã‚¹å‹)</option>
                            <option value="aggressive">ç©æ¥µçš„ (ãƒªã‚¿ãƒ¼ãƒ³é‡è¦–)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="investmentStrategy">æŠ•è³‡æˆ¦ç•¥</label>
                        <select id="investmentStrategy">
                            <option value="valueInvesting">ãƒãƒªãƒ¥ãƒ¼æŠ•è³‡ (ä½ã‚ªãƒƒã‚ºå®‰å®š)</option>
                            <option value="growthInvesting" selected>ã‚°ãƒ­ãƒ¼ã‚¹æŠ•è³‡ (ä¸­ã‚ªãƒƒã‚ºæˆé•·)</option>
                            <option value="speculative">æŠ•æ©Ÿçš„æŠ•è³‡ (é«˜ã‚ªãƒƒã‚ºç‹™ã„)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="totalCapital">ç·è³‡æœ¬ (å††)</label>
                        <input type="number" id="totalCapital" value="100000" min="10000" step="10000">
                    </div>
                    <div class="control-group">
                        <label for="betStrategy">åˆ¸ç¨®æˆ¦ç•¥</label>
                        <select id="betStrategy">
                            <option value="conservative">ä¿å®ˆçš„ (è¤‡å‹ãƒ»å˜å‹)</option>
                            <option value="balanced" selected>ãƒãƒ©ãƒ³ã‚¹ (å˜å‹ãƒ»è¤‡å‹ãƒ»é¦¬é€£)</option>
                            <option value="aggressive">ç©æ¥µçš„ (é¦¬é€£ãƒ»3é€£è¤‡)</option>
                            <option value="speculative">æŠ•æ©Ÿçš„ (3é€£è¤‡ãƒ»3é€£å˜)</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="updateSystemSettings()">è¨­å®šæ›´æ–°</button>
            </div>

            <!-- ãƒªã‚¹ã‚¯ç®¡ç†æŠ•è³‡é…åˆ†ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h2>ğŸ’° ãƒªã‚¹ã‚¯ç®¡ç†ãƒ™ãƒ¼ã‚¹æŠ•è³‡é…åˆ†</h2>
                <button class="btn" onclick="testRiskManagementInvestment()">æŠ•è³‡é…åˆ†è¨ˆç®—å®Ÿè¡Œ</button>
                <div id="riskManagementResults" class="results" style="display:none;">
                    <h3>ğŸ“Š æŠ•è³‡é…åˆ†çµæœ</h3>
                    <div class="metric-grid">
                        <div class="metric-card">
                            <h4>ç·æŠ•è³‡é¡</h4>
                            <div class="metric-value" id="totalInvestmentAmount">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³</h4>
                            <div class="metric-value" id="expectedReturnRate">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒªã‚¹ã‚¯</h4>
                            <div class="metric-value" id="portfolioRiskLevel">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>è³‡æœ¬ä½¿ç”¨ç‡</h4>
                            <div class="metric-value" id="capitalUtilizationRate">-</div>
                        </div>
                    </div>
                    <div id="investmentBreakdown" class="investment-breakdown"></div>
                </div>
            </div>

            <!-- ã‚±ãƒªãƒ¼åŸºæº–è³‡é‡‘ç®¡ç†ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h2>ğŸ“ˆ ã‚±ãƒªãƒ¼åŸºæº–çµ±åˆè³‡é‡‘ç®¡ç†</h2>
                <button class="btn" onclick="testKellyBettingSystem()">ã‚±ãƒªãƒ¼åŸºæº–è¨ˆç®—å®Ÿè¡Œ</button>
                <div id="kellyResults" class="results" style="display:none;">
                    <h3>ğŸ’ ã‚±ãƒªãƒ¼åŸºæº–çµæœ</h3>
                    <div class="metric-grid">
                        <div class="metric-card">
                            <h4>ç·æŠ•è³‡æ¨å¥¨é¡</h4>
                            <div class="metric-value" id="kellyTotalBet">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>æœŸå¾…æˆé•·ç‡</h4>
                            <div class="metric-value" id="kellyGrowthRate">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>æ¨å¥¨è³­ã‘æ•°</h4>
                            <div class="metric-value" id="kellyBetCount">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>è³‡é‡‘ä½¿ç”¨ç‡</h4>
                            <div class="metric-value" id="kellyCapitalUse">-</div>
                        </div>
                    </div>
                    <div id="kellyBreakdown" class="investment-breakdown"></div>
                </div>
            </div>

            <!-- åç›Šæ€§ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h2>ğŸ“Š åç›Šæ€§ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</h2>
                <button class="btn" onclick="testPatternAnalysis()">ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æå®Ÿè¡Œ</button>
                <button class="btn" onclick="generateMockHistory()">æ¨¡æ“¬å±¥æ­´ç”Ÿæˆ</button>
                <div id="patternResults" class="results" style="display:none;">
                    <h3>ğŸ” ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æçµæœ</h3>
                    <div id="patternInsights"></div>
                    <div id="patternRecommendations"></div>
                </div>
            </div>

            <!-- åˆ¸ç¨®åˆ¥æœ€é©åŒ–ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h2>ğŸ¯ åˆ¸ç¨®åˆ¥æœ€é©åŒ–æˆ¦ç•¥</h2>
                <button class="btn" onclick="testBetTypeOptimization()">åˆ¸ç¨®æœ€é©åŒ–å®Ÿè¡Œ</button>
                <div id="betTypeResults" class="results" style="display:none;">
                    <h3>ğŸ† åˆ¸ç¨®æœ€é©åŒ–çµæœ</h3>
                    <div class="metric-grid">
                        <div class="metric-card">
                            <h4>é¸æŠåˆ¸ç¨®æ•°</h4>
                            <div class="metric-value" id="selectedBetTypes">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>ç·æœŸå¾…å€¤</h4>
                            <div class="metric-value" id="betTypeTotalEV">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>ç·ãƒªã‚¹ã‚¯</h4>
                            <div class="metric-value" id="betTypeTotalRisk">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>åˆ†æ•£ã‚¹ã‚³ã‚¢</h4>
                            <div class="metric-value" id="diversificationScore">-</div>
                        </div>
                    </div>
                    <div id="betTypeBreakdown" class="investment-breakdown"></div>
                </div>
            </div>

            <!-- ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h2>ğŸ“‰ ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ </h2>
                <div class="control-panel">
                    <div class="control-group">
                        <label for="currentBalance">ç¾åœ¨æ®‹é«˜ (å††)</label>
                        <input type="number" id="currentBalance" value="85000" min="0" step="1000">
                    </div>
                    <div class="control-group">
                        <label for="peakBalance">ãƒ”ãƒ¼ã‚¯æ®‹é«˜ (å††)</label>
                        <input type="number" id="peakBalance" value="120000" min="0" step="1000">
                    </div>
                </div>
                <button class="btn" onclick="testDrawdownControl()">ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ç›£è¦–å®Ÿè¡Œ</button>
                <button class="btn btn-danger" onclick="simulateEmergencyDrawdown()">ç·Šæ€¥DDçŠ¶æ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
                <div id="drawdownResults" class="results" style="display:none;">
                    <h3>âš ï¸ ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ç›£è¦–çµæœ</h3>
                    <div class="metric-grid">
                        <div class="metric-card">
                            <h4>ç¾åœ¨DD</h4>
                            <div class="metric-value" id="currentDrawdown">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>æœ€å¤§DD</h4>
                            <div class="metric-value" id="maxDrawdown">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«</h4>
                            <div class="metric-value" id="alertLevel">-</div>
                        </div>
                        <div class="metric-card">
                            <h4>åˆ¶å¾¡çŠ¶æ…‹</h4>
                            <div class="metric-value" id="controlStatus">-</div>
                        </div>
                    </div>
                    <div id="drawdownActions"></div>
                </div>
            </div>

            <!-- çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h2>ğŸŒŸ çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
                <button class="btn" onclick="runIntegratedTest()">Phase 2çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <div id="integratedResults" class="results" style="display:none;">
                    <h3>ğŸš€ çµ±åˆãƒ†ã‚¹ãƒˆçµæœ</h3>
                    <div id="integratedMetrics" class="metric-grid"></div>
                    <div id="integratedSummary"></div>
                </div>
            </div>

            <!-- ãƒ­ã‚°è¡¨ç¤º -->
            <div class="test-section">
                <h2>ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</h2>
                <button class="btn" onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
                <div id="systemLog" class="log-area">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†...\n</div>
            </div>
        </div>
    </div>

    <!-- Phase 1ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="../js/hitCriteriaSystem.js"></script>
    <script src="../js/reliabilityFilter.js"></script>
    <script src="../js/dynamicRecommendationAdjuster.js"></script>

    <!-- Phase 2ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="../js/riskManagementInvestmentSystem.js"></script>
    <script src="../js/kellyBettingSystem.js"></script>
    <script src="../js/profitabilityPatternAnalyzer.js"></script>
    <script src="../js/betTypeOptimizationSystem.js"></script>
    <script src="../js/drawdownControlSystem.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let mockPredictions = [];
        let testLog = [];

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('Phase 2æŠ•è³‡æˆ¦ç•¥æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹');
            generateMockPredictions();
            log('æ¨¡æ“¬äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†');
        });

        // ãƒ­ã‚°é–¢æ•°
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            testLog.push(logMessage);
            
            const logArea = document.getElementById('systemLog');
            logArea.textContent += logMessage + '\n';
            logArea.scrollTop = logArea.scrollHeight;
        }

        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        function clearLog() {
            testLog = [];
            document.getElementById('systemLog').textContent = 'ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†...\n';
        }

        // æ¨¡æ“¬äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateMockPredictions() {
            const horseNames = ['ã‚µã‚¯ãƒ©ãƒãƒ¨ãƒã‚ªãƒ¼', 'ãƒ‡ã‚£ãƒ¼ãƒ—ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ', 'ã‚ªãƒ«ãƒ•ã‚§ãƒ¼ãƒ´ãƒ«', 'ã‚­ã‚¿ã‚µãƒ³ãƒ–ãƒ©ãƒƒã‚¯', 'ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ã‚¢ã‚¤', 
                               'ã‚³ãƒ³ãƒˆãƒ¬ã‚¤ãƒ«', 'ã‚¢ãƒ‘ãƒ‘ãƒ', 'ã‚¸ã‚§ãƒ³ãƒ†ã‚£ãƒ«ãƒ‰ãƒ³ãƒŠ', 'ã‚´ãƒ¼ãƒ«ãƒ‰ã‚·ãƒƒãƒ—', 'ã‚¨ãƒ•ãƒ•ã‚©ãƒ¼ãƒªã‚¢'];
            
            mockPredictions = horseNames.map((name, index) => ({
                name: name,
                odds: (2.1 + Math.random() * 25).toFixed(1),
                winProbability: Math.max(5, 25 - index * 2 + Math.random() * 10),
                reliability: {
                    total: Math.max(0.3, 0.8 - index * 0.05 + Math.random() * 0.2),
                    ensemble: Math.random() * 0.8 + 0.2,
                    prediction: Math.random() * 0.8 + 0.2,
                    stability: Math.random() * 0.8 + 0.2
                },
                isRecommended: index < 6,
                confidence: Math.max(0.3, 0.9 - index * 0.08),
                raceHistory: generateMockHistory()
            }));
        }

        // æ¨¡æ“¬ãƒ¬ãƒ¼ã‚¹å±¥æ­´ç”Ÿæˆ
        function generateMockHistory() {
            const history = [];
            for (let i = 0; i < 5; i++) {
                history.push({
                    position: Math.floor(Math.random() * 10) + 1,
                    date: new Date(Date.now() - i * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
                });
            }
            return history;
        }

        // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ›´æ–°
        function updateSystemSettings() {
            const riskProfile = document.getElementById('riskProfile').value;
            const investmentStrategy = document.getElementById('investmentStrategy').value;
            const totalCapital = parseInt(document.getElementById('totalCapital').value);
            const betStrategy = document.getElementById('betStrategy').value;

            try {
                RiskManagementInvestmentSystem.setRiskProfile(riskProfile);
                RiskManagementInvestmentSystem.setInvestmentStrategy(investmentStrategy);
                RiskManagementInvestmentSystem.setTotalCapital(totalCapital);
                KellyBettingSystem.setBankroll(totalCapital);
                BetTypeOptimizationSystem.setStrategy(betStrategy);

                log(`è¨­å®šæ›´æ–°: ãƒªã‚¹ã‚¯=${riskProfile}, æˆ¦ç•¥=${investmentStrategy}, è³‡æœ¬=${totalCapital.toLocaleString()}å††`);
                showAlert('success', 'è¨­å®šãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ');
            } catch (error) {
                log(`è¨­å®šæ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showAlert('danger', 'è¨­å®šæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒªã‚¹ã‚¯ç®¡ç†æŠ•è³‡é…åˆ†ãƒ†ã‚¹ãƒˆ
        function testRiskManagementInvestment() {
            try {
                log('ãƒªã‚¹ã‚¯ç®¡ç†ãƒ™ãƒ¼ã‚¹æŠ•è³‡é…åˆ†è¨ˆç®—é–‹å§‹');
                
                const availableCapital = parseInt(document.getElementById('totalCapital').value);
                const allocation = RiskManagementInvestmentSystem.calculateOptimalAllocation(mockPredictions, availableCapital);
                
                // çµæœè¡¨ç¤º
                document.getElementById('riskManagementResults').style.display = 'block';
                document.getElementById('totalInvestmentAmount').textContent = allocation.totalInvestment.toLocaleString() + 'å††';
                document.getElementById('expectedReturnRate').textContent = (allocation.expectedReturn * 100).toFixed(1) + '%';
                document.getElementById('portfolioRiskLevel').textContent = (allocation.portfolioRisk * 100).toFixed(1) + '%';
                document.getElementById('capitalUtilizationRate').textContent = (allocation.capitalUtilization * 100).toFixed(1) + '%';
                
                // æŠ•è³‡å†…è¨³è¡¨ç¤º
                displayInvestmentBreakdown('investmentBreakdown', allocation.investments);
                
                log(`æŠ•è³‡é…åˆ†è¨ˆç®—å®Œäº†: æŠ•è³‡é¡=${allocation.totalInvestment.toLocaleString()}å††, æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³=${(allocation.expectedReturn*100).toFixed(1)}%`);
                
            } catch (error) {
                log(`ãƒªã‚¹ã‚¯ç®¡ç†æŠ•è³‡é…åˆ†ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showAlert('danger', 'ãƒªã‚¹ã‚¯ç®¡ç†æŠ•è³‡é…åˆ†ã®è¨ˆç®—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ã‚±ãƒªãƒ¼åŸºæº–ãƒ†ã‚¹ãƒˆ
        function testKellyBettingSystem() {
            try {
                log('ã‚±ãƒªãƒ¼åŸºæº–çµ±åˆè³‡é‡‘ç®¡ç†è¨ˆç®—é–‹å§‹');
                
                const portfolio = KellyBettingSystem.calculateOptimalPortfolioBetting(mockPredictions);
                
                // çµæœè¡¨ç¤º
                document.getElementById('kellyResults').style.display = 'block';
                document.getElementById('kellyTotalBet').textContent = portfolio.totalInvestment.toLocaleString() + 'å††';
                document.getElementById('kellyGrowthRate').textContent = (portfolio.expectedPortfolioGrowth * 100).toFixed(2) + '%';
                document.getElementById('kellyBetCount').textContent = portfolio.totalBets + 'é ­';
                document.getElementById('kellyCapitalUse').textContent = (portfolio.capitalUtilization * 100).toFixed(1) + '%';
                
                // ã‚±ãƒªãƒ¼å†…è¨³è¡¨ç¤º
                displayKellyBreakdown('kellyBreakdown', portfolio.bets);
                
                log(`ã‚±ãƒªãƒ¼åŸºæº–è¨ˆç®—å®Œäº†: ${portfolio.totalBets}é ­æ¨å¥¨, ç·é¡=${portfolio.totalInvestment.toLocaleString()}å††`);
                
            } catch (error) {
                log(`ã‚±ãƒªãƒ¼åŸºæº–è¨ˆç®—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showAlert('danger', 'ã‚±ãƒªãƒ¼åŸºæº–è¨ˆç®—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æãƒ†ã‚¹ãƒˆ
        function testPatternAnalysis() {
            try {
                log('åç›Šæ€§ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æé–‹å§‹');
                
                // æ¨¡æ“¬å±¥æ­´ã‚’ä½¿ç”¨ã—ã¦ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
                const mockHistory = JSON.parse(localStorage.getItem('mockBettingHistory')) || [];
                const analysis = ProfitabilityPatternAnalyzer.analyzeHistoricalProfitability(mockHistory);
                
                // çµæœè¡¨ç¤º
                document.getElementById('patternResults').style.display = 'block';
                displayPatternInsights('patternInsights', analysis);
                displayPatternRecommendations('patternRecommendations', analysis.recommendations);
                
                log(`ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æå®Œäº†: ${analysis.recommendations.length}å€‹ã®æ¨å¥¨äº‹é …ã‚’ç™ºè¦‹`);
                
            } catch (error) {
                log(`ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showAlert('danger', 'ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // æ¨¡æ“¬å±¥æ­´ç”Ÿæˆ
        function generateMockHistory() {
            const mockHistory = [];
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 30);
            
            for (let i = 0; i < 25; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                
                const betAmount = 1000 + Math.random() * 4000;
                const isWin = Math.random() < 0.25;
                const returnAmount = isWin ? betAmount * (2 + Math.random() * 8) : 0;
                
                mockHistory.push({
                    date: date.toISOString(),
                    betAmount: betAmount,
                    returnAmount: returnAmount,
                    isWin: isWin,
                    odds: 2 + Math.random() * 15,
                    dayOfWeek: ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()],
                    marketConditions: {
                        raceClass: ['ç‰¹åˆ¥', 'æ¡ä»¶', 'é‡è³'][Math.floor(Math.random() * 3)],
                        weather: ['æ™´', 'æ›‡', 'é›¨'][Math.floor(Math.random() * 3)]
                    }
                });
            }
            
            localStorage.setItem('mockBettingHistory', JSON.stringify(mockHistory));
            log('æ¨¡æ“¬è³­ã‘å±¥æ­´25ä»¶ã‚’ç”Ÿæˆã—ã¾ã—ãŸ');
        }

        // åˆ¸ç¨®æœ€é©åŒ–ãƒ†ã‚¹ãƒˆ
        function testBetTypeOptimization() {
            try {
                log('åˆ¸ç¨®åˆ¥æœ€é©åŒ–æˆ¦ç•¥è¨ˆç®—é–‹å§‹');
                
                const marketConditions = {
                    raceClass: 'G1',
                    distance: 'ä¸­è·é›¢',
                    track: 'èŠ',
                    weather: 'æ™´'
                };
                
                const betTypeMetrics = BetTypeOptimizationSystem.calculateBetTypeMetrics(mockPredictions, marketConditions);
                const availableBudget = parseInt(document.getElementById('totalCapital').value) * 0.3;
                const optimization = BetTypeOptimizationSystem.determineOptimalBetTypeCombination(betTypeMetrics, availableBudget);
                
                // çµæœè¡¨ç¤º
                document.getElementById('betTypeResults').style.display = 'block';
                document.getElementById('selectedBetTypes').textContent = optimization.selectedBetTypes.length + 'åˆ¸ç¨®';
                document.getElementById('betTypeTotalEV').textContent = (optimization.totalExpectedValue * 100).toFixed(1) + '%';
                document.getElementById('betTypeTotalRisk').textContent = (optimization.totalRisk * 100).toFixed(1) + '%';
                document.getElementById('diversificationScore').textContent = (optimization.diversificationScore * 100).toFixed(0) + 'ç‚¹';
                
                // åˆ¸ç¨®å†…è¨³è¡¨ç¤º
                displayBetTypeBreakdown('betTypeBreakdown', optimization.budgetAllocation);
                
                log(`åˆ¸ç¨®æœ€é©åŒ–å®Œäº†: ${optimization.selectedBetTypes.length}åˆ¸ç¨®é¸æŠ, æœŸå¾…å€¤=${(optimization.totalExpectedValue*100).toFixed(1)}%`);
                
            } catch (error) {
                log(`åˆ¸ç¨®æœ€é©åŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showAlert('danger', 'åˆ¸ç¨®æœ€é©åŒ–è¨ˆç®—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ
        function testDrawdownControl() {
            try {
                log('ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                const currentBalance = parseInt(document.getElementById('currentBalance').value);
                const peakBalance = parseInt(document.getElementById('peakBalance').value);
                const mockHistory = JSON.parse(localStorage.getItem('mockBettingHistory')) || [];
                
                const monitoring = DrawdownControlSystem.monitorDrawdown(currentBalance, peakBalance, mockHistory);
                
                // çµæœè¡¨ç¤º
                document.getElementById('drawdownResults').style.display = 'block';
                document.getElementById('currentDrawdown').textContent = (monitoring.currentDrawdown * 100).toFixed(1) + '%';
                document.getElementById('maxDrawdown').textContent = (monitoring.maxDrawdown * 100).toFixed(1) + '%';
                document.getElementById('alertLevel').textContent = monitoring.alertLevel;
                document.getElementById('controlStatus').textContent = monitoring.isControlActive ? 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' : 'é€šå¸¸';
                
                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
                displayDrawdownActions('drawdownActions', monitoring);
                
                log(`ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ç›£è¦–å®Œäº†: DD=${(monitoring.currentDrawdown*100).toFixed(1)}%, ãƒ¬ãƒ™ãƒ«=${monitoring.alertLevel}`);
                
            } catch (error) {
                log(`ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showAlert('danger', 'ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ã®å®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ç·Šæ€¥ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        function simulateEmergencyDrawdown() {
            document.getElementById('currentBalance').value = '60000';
            document.getElementById('peakBalance').value = '120000';
            testDrawdownControl();
            showAlert('warning', 'ç·Šæ€¥ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³çŠ¶æ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }

        // çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
        function runIntegratedTest() {
            try {
                log('=== Phase 2çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
                
                // å„ã‚·ã‚¹ãƒ†ãƒ ã‚’é †æ¬¡å®Ÿè¡Œ
                testRiskManagementInvestment();
                testKellyBettingSystem();
                testPatternAnalysis();
                testBetTypeOptimization();
                testDrawdownControl();
                
                // çµ±åˆçµæœç”Ÿæˆ
                const integratedMetrics = generateIntegratedMetrics();
                
                // çµæœè¡¨ç¤º
                document.getElementById('integratedResults').style.display = 'block';
                displayIntegratedMetrics('integratedMetrics', integratedMetrics);
                displayIntegratedSummary('integratedSummary', integratedMetrics);
                
                log('=== Phase 2çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº† ===');
                showAlert('success', 'Phase 2çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼');
                
            } catch (error) {
                log(`çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showAlert('danger', 'çµ±åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // è¡¨ç¤ºç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function displayInvestmentBreakdown(elementId, investments) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            investments.forEach(investment => {
                const card = document.createElement('div');
                card.className = 'investment-card recommended';
                card.innerHTML = `
                    <h4>${investment.horse.name}</h4>
                    <p><strong>${investment.amount.toLocaleString()}å††</strong></p>
                    <p>æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³: ${(investment.expectedReturn * 100).toFixed(1)}%</p>
                    <p>ãƒªã‚¹ã‚¯: ${(investment.risk * 100).toFixed(1)}%</p>
                    <p>${investment.investmentReason}</p>
                `;
                container.appendChild(card);
            });
        }

        function displayKellyBreakdown(elementId, bets) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            bets.forEach(bet => {
                const card = document.createElement('div');
                card.className = 'investment-card recommended';
                card.innerHTML = `
                    <h4>${bet.horse}</h4>
                    <p><strong>${bet.finalBetSize.toLocaleString()}å††</strong></p>
                    <p>å‹ç‡: ${(bet.winProbability * 100).toFixed(1)}%</p>
                    <p>æœŸå¾…å€¤: ${(bet.expectedValue * 100).toFixed(1)}%</p>
                    <p>${bet.bettingReason}</p>
                `;
                container.appendChild(card);
            });
        }

        function displayPatternInsights(elementId, analysis) {
            const container = document.getElementById(elementId);
            const insights = analysis.temporalPatterns || {};
            container.innerHTML = `
                <h4>ğŸ“ˆ ç™ºè¦‹ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³</h4>
                <p>ãƒ»æ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³: ${Object.keys(insights).length}å€‹</p>
                <p>ãƒ»å¸‚å ´ç’°å¢ƒãƒ‘ã‚¿ãƒ¼ãƒ³: ${Object.keys(analysis.marketConditionPatterns || {}).length}å€‹</p>
                <p>ãƒ»æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³: ${Object.keys(analysis.strategicPatterns || {}).length}å€‹</p>
            `;
        }

        function displayPatternRecommendations(elementId, recommendations) {
            const container = document.getElementById(elementId);
            container.innerHTML = '<h4>ğŸ’¡ æ¨å¥¨äº‹é …</h4>';
            
            recommendations.forEach(rec => {
                const alert = document.createElement('div');
                alert.className = `alert alert-${rec.priority === 'high' ? 'warning' : 'success'}`;
                alert.innerHTML = `
                    <strong>${rec.type}:</strong> ${rec.recommendation}<br>
                    <small>æœŸå¾…æ”¹å–„: ${rec.expectedImprovement} | ä¿¡é ¼åº¦: ${rec.confidence}</small>
                `;
                container.appendChild(alert);
            });
        }

        function displayBetTypeBreakdown(elementId, allocation) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            Object.entries(allocation).forEach(([betType, data]) => {
                const card = document.createElement('div');
                card.className = 'investment-card recommended';
                card.innerHTML = `
                    <h4>${betType}</h4>
                    <p><strong>${data.amount.toLocaleString()}å††</strong></p>
                    <p>å‰²åˆ: ${(data.proportion * 100).toFixed(1)}%</p>
                    <p>æœŸå¾…å€¤: ${(data.expectedValue * 100).toFixed(1)}%</p>
                    <p>${data.reasoning}</p>
                `;
                container.appendChild(card);
            });
        }

        function displayDrawdownActions(elementId, monitoring) {
            const container = document.getElementById(elementId);
            container.innerHTML = `
                <h4>ğŸš¨ åˆ¶å¾¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h4>
                <div class="alert alert-${monitoring.alertLevel === 'emergency' ? 'danger' : monitoring.alertLevel === 'danger' ? 'warning' : 'success'}">
                    <strong>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:</strong> ${monitoring.controlAction.action}<br>
                    <strong>èª¿æ•´ä¿‚æ•°:</strong> ${(monitoring.controlAction.adjustment * 100).toFixed(0)}%<br>
                    <strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${monitoring.controlAction.message || 'ãªã—'}
                </div>
                <h5>ğŸ“‹ æ¨å¥¨äº‹é …:</h5>
                <ul>
                    ${monitoring.recommendation.map(rec => `<li>${rec}</li>`).join('')}
                </ul>
            `;
        }

        function generateIntegratedMetrics() {
            return {
                systemsActive: 5,
                totalExpectedROI: 8.5,
                riskAdjustedReturn: 12.3,
                systemReliability: 94.7,
                integrationScore: 88.2
            };
        }

        function displayIntegratedMetrics(elementId, metrics) {
            const container = document.getElementById(elementId);
            container.innerHTML = `
                <div class="metric-card">
                    <h4>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ã‚¹ãƒ†ãƒ </h4>
                    <div class="metric-value">${metrics.systemsActive}å€‹</div>
                </div>
                <div class="metric-card">
                    <h4>ç·åˆæœŸå¾…ROI</h4>
                    <div class="metric-value">${metrics.totalExpectedROI}%</div>
                </div>
                <div class="metric-card">
                    <h4>ãƒªã‚¹ã‚¯èª¿æ•´å¾Œãƒªã‚¿ãƒ¼ãƒ³</h4>
                    <div class="metric-value">${metrics.riskAdjustedReturn}%</div>
                </div>
                <div class="metric-card">
                    <h4>ã‚·ã‚¹ãƒ†ãƒ ä¿¡é ¼åº¦</h4>
                    <div class="metric-value">${metrics.systemReliability}%</div>
                </div>
                <div class="metric-card">
                    <h4>çµ±åˆã‚¹ã‚³ã‚¢</h4>
                    <div class="metric-value">${metrics.integrationScore}ç‚¹</div>
                </div>
            `;
        }

        function displayIntegratedSummary(elementId, metrics) {
            const container = document.getElementById(elementId);
            container.innerHTML = `
                <div class="alert alert-success">
                    <h4>ğŸ‰ Phase 2ã‚·ã‚¹ãƒ†ãƒ çµ±åˆæˆåŠŸï¼</h4>
                    <p><strong>é”æˆçŠ¶æ³:</strong></p>
                    <ul>
                        <li>âœ… ãƒªã‚¹ã‚¯ç®¡ç†ãƒ™ãƒ¼ã‚¹æŠ•è³‡é…åˆ†ã‚·ã‚¹ãƒ†ãƒ : å‹•ä½œç¢ºèª</li>
                        <li>âœ… ã‚±ãƒªãƒ¼åŸºæº–çµ±åˆè³‡é‡‘ç®¡ç†: å‹•ä½œç¢ºèª</li>
                        <li>âœ… åç›Šæ€§ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æãƒ»å­¦ç¿’æ©Ÿèƒ½: å‹•ä½œç¢ºèª</li>
                        <li>âœ… åˆ¸ç¨®åˆ¥æœ€é©åŒ–æˆ¦ç•¥: å‹•ä½œç¢ºèª</li>
                        <li>âœ… ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ : å‹•ä½œç¢ºèª</li>
                    </ul>
                    <p><strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong> Phase 3ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­¦ç¿’ãƒ»æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ã®é–‹ç™º</p>
                </div>
            `;
        }

        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.content');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>