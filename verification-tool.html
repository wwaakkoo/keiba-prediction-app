<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡ ç«¶é¦¬äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: bold;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab.active {
            color: #2980b9;
            border-bottom-color: #2980b9;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        .prediction-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ecf0f1;
            border-radius: 6px;
        }
        .prediction-header {
            background: #34495e;
            color: white;
            font-weight: bold;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .results-table th, .results-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .results-table th {
            background: #34495e;
            color: white;
        }
        .summary-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 10px 0;
            text-align: center;
        }
        .summary-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .import-export {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .notification {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .notification.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .notification.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>ğŸ‡ ç«¶é¦¬äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('input')">ğŸ“ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</button>
            <button class="tab" onclick="switchTab('results')">ğŸ“Š çµæœåˆ†æ</button>
            <button class="tab" onclick="switchTab('summary')">ğŸ“ˆ ç·åˆè©•ä¾¡</button>
            <button class="tab" onclick="switchTab('export')">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</button>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã‚¿ãƒ– -->
        <div id="input" class="tab-content active">
            <h2>ğŸ“‹ ãƒ¬ãƒ¼ã‚¹æƒ…å ±ãƒ»äºˆæ¸¬çµæœå…¥åŠ›</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- ãƒ¬ãƒ¼ã‚¹åŸºæœ¬æƒ…å ± -->
                <div>
                    <h3>ğŸ ãƒ¬ãƒ¼ã‚¹åŸºæœ¬æƒ…å ±</h3>
                    <div class="form-group">
                        <label>é–‹å‚¬æ—¥</label>
                        <input type="date" id="raceDate" required>
                    </div>
                    <div class="form-group">
                        <label>ç«¶é¦¬å ´</label>
                        <select id="raceCourse" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="æœ­å¹Œ">æœ­å¹Œ</option>
                            <option value="å‡½é¤¨">å‡½é¤¨</option>
                            <option value="ç¦å³¶">ç¦å³¶</option>
                            <option value="æ–°æ½Ÿ">æ–°æ½Ÿ</option>
                            <option value="æ±äº¬">æ±äº¬</option>
                            <option value="ä¸­å±±">ä¸­å±±</option>
                            <option value="ä¸­äº¬">ä¸­äº¬</option>
                            <option value="äº¬éƒ½">äº¬éƒ½</option>
                            <option value="é˜ªç¥">é˜ªç¥</option>
                            <option value="å°å€‰">å°å€‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ãƒ¬ãƒ¼ã‚¹å</label>
                        <input type="text" id="raceName" placeholder="ä¾‹: ç¬¬1R æ–°é¦¬æˆ¦" required>
                    </div>
                    <div class="form-group">
                        <label>å‡ºèµ°é ­æ•°</label>
                        <input type="number" id="horseCount" min="2" max="18" value="8" required>
                    </div>
                    <div class="form-group">
                        <label>é¦¬å ´çŠ¶æ…‹</label>
                        <select id="trackCondition">
                            <option value="è‰¯">è‰¯</option>
                            <option value="ç¨é‡">ç¨é‡</option>
                            <option value="é‡">é‡</option>
                            <option value="ä¸è‰¯">ä¸è‰¯</option>
                        </select>
                    </div>
                </div>
                
                <!-- å®Ÿéš›ã®çµæœ -->
                <div>
                    <h3>ğŸ† å®Ÿéš›ã®çµæœ</h3>
                    <div class="form-group">
                        <label>1ç€é¦¬ç•ª</label>
                        <input type="number" id="firstPlace" min="1" max="18" required>
                    </div>
                    <div class="form-group">
                        <label>2ç€é¦¬ç•ª</label>
                        <input type="number" id="secondPlace" min="1" max="18" required>
                    </div>
                    <div class="form-group">
                        <label>3ç€é¦¬ç•ª</label>
                        <input type="number" id="thirdPlace" min="1" max="18" required>
                    </div>
                    <div class="form-group">
                        <label>å˜å‹æ‰•æˆ»é‡‘ï¼ˆå††ï¼‰</label>
                        <input type="number" id="winPayback" min="0" placeholder="ä¾‹: 280">
                    </div>
                    <div class="form-group">
                        <label>è¤‡å‹æ‰•æˆ»é‡‘ï¼ˆå††ï¼‰</label>
                        <input type="number" id="placePayback" min="0" placeholder="ä¾‹: 150">
                    </div>
                </div>
            </div>

            <!-- äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿å…¥åŠ› -->
            <div style="margin-top: 30px;">
                <h3>ğŸ¯ äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿</h3>
                <div class="prediction-row prediction-header">
                    <div>é¦¬ç•ª</div>
                    <div>åŸºæœ¬ã‚¹ã‚³ã‚¢</div>
                    <div>ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«</div>
                    <div>å‹ç‡(%)</div>
                    <div>è¤‡å‹ç‡(%)</div>
                    <div>ã‚ªãƒƒã‚º</div>
                </div>
                <div id="predictionRows"></div>
                <button class="btn btn-success" onclick="generatePredictionRows()">ğŸ äºˆæ¸¬è¡Œã‚’ç”Ÿæˆ</button>
                <button class="btn" onclick="loadFromApp()">ğŸ“± ã‚¢ãƒ—ãƒªã‹ã‚‰èª­ã¿è¾¼ã¿</button>
                <button class="btn btn-warning" onclick="loadFromClipboard()">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰èª­ã¿è¾¼ã¿</button>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="saveRaceData()">ğŸ’¾ ã“ã®ãƒ¬ãƒ¼ã‚¹ã‚’ä¿å­˜</button>
                <button class="btn btn-warning" onclick="clearForm()">ğŸ—‘ï¸ ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢</button>
            </div>
        </div>

        <!-- çµæœåˆ†æã‚¿ãƒ– -->
        <div id="results" class="tab-content">
            <h2>ğŸ“Š ãƒ¬ãƒ¼ã‚¹åˆ¥çµæœåˆ†æ</h2>
            <div id="raceResultsList"></div>
        </div>

        <!-- ç·åˆè©•ä¾¡ã‚¿ãƒ– -->
        <div id="summary" class="tab-content">
            <h2>ğŸ“ˆ å…¨ä½“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç·åˆè©•ä¾¡</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="displaySummary()">ğŸ“Š åŸºæœ¬çµ±è¨ˆ</button>
                <button class="btn btn-warning" onclick="analyzePlacePredictions()">ğŸ¯ è¤‡å‹äºˆæƒ³è©³ç´°åˆ†æ</button>
            </div>
            <div id="overallSummary"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ– -->
        <div id="export" class="tab-content">
            <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
            
            <div class="import-export">
                <h3>ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
                <p>æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚</p>
                <button class="btn" onclick="exportToCSV()">ğŸ“Š CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button class="btn" onclick="exportToJSON()">ğŸ“„ JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>
            
            <div class="import-export">
                <h3>ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h3>
                <p>ä»¥å‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
                <input type="file" id="importFile" accept=".json,.csv" style="margin-bottom: 10px;">
                <br>
                <button class="btn" onclick="importData()">ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿</button>
            </div>
            
            <div class="import-export">
                <h3>ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                <button class="btn btn-danger" onclick="clearAllData()">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                <p style="color: #e74c3c; font-size: 0.9em;">â€»ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“</p>
            </div>
        </div>
    </div>

    <div id="notifications"></div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨
        let verificationData = JSON.parse(localStorage.getItem('horseVerificationData') || '[]');
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'results') {
                displayResults();
            } else if (tabName === 'summary') {
                displaySummary();
            }
        }
        
        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message, type = 'success') {
            const notificationDiv = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notificationDiv.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // äºˆæ¸¬è¡Œç”Ÿæˆ
        function generatePredictionRows() {
            const horseCount = parseInt(document.getElementById('horseCount').value) || 8;
            const container = document.getElementById('predictionRows');
            container.innerHTML = '';
            
            for (let i = 1; i <= horseCount; i++) {
                const row = document.createElement('div');
                row.className = 'prediction-row';
                row.innerHTML = `
                    <input type="number" value="${i}" readonly style="background: #f8f9fa;">
                    <input type="number" id="score_${i}" step="0.1" placeholder="0.0" min="0" max="100">
                    <input type="number" id="ensemble_${i}" step="0.1" placeholder="0.0" min="0" max="100">
                    <input type="number" id="winRate_${i}" step="0.1" placeholder="0.0" min="0" max="100">
                    <input type="number" id="placeRate_${i}" step="0.1" placeholder="0.0" min="0" max="100">
                    <input type="number" id="odds_${i}" step="0.1" placeholder="0.0" min="1">
                `;
                container.appendChild(row);
            }
        }
        
        // ã‚¢ãƒ—ãƒªã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆåŒä¸€ã‚¿ãƒ–ã§ã®é€£æºç”¨ï¼‰
        function loadFromApp() {
            if (typeof PredictionEngine !== 'undefined' && PredictionEngine.currentPredictions) {
                loadPredictionData(PredictionEngine.currentPredictions);
                showNotification('ğŸ¯ ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‹ã‚‰äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
            } else {
                showNotification('âš ï¸ ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚åŒä¸€ã‚¿ãƒ–ã§index.htmlã‹ã‚‰ç§»å‹•ã—ã¦ãã ã•ã„ã€‚', 'error');
            }
        }
        
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰èª­ã¿è¾¼ã¿
        async function loadFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                const data = JSON.parse(text);
                
                if (Array.isArray(data) && data.length > 0 && data[0].score !== undefined) {
                    loadPredictionData(data);
                    showNotification('ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                } else {
                    showNotification('âš ï¸ æ­£ã—ã„äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“', 'error');
                }
            } catch (error) {
                showNotification('âš ï¸ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š
        function loadPredictionData(predictions) {
            const horseCount = predictions.length;
            document.getElementById('horseCount').value = horseCount;
            generatePredictionRows();
            
            predictions.forEach((horse, index) => {
                const horseNum = index + 1;
                const scoreInput = document.getElementById(`score_${horseNum}`);
                const ensembleInput = document.getElementById(`ensemble_${horseNum}`);
                const winRateInput = document.getElementById(`winRate_${horseNum}`);
                const placeRateInput = document.getElementById(`placeRate_${horseNum}`);
                const oddsInput = document.getElementById(`odds_${horseNum}`);
                
                if (scoreInput) scoreInput.value = horse.score || 0;
                if (ensembleInput) ensembleInput.value = horse.enhancedScore || horse.score || 0;
                if (winRateInput) winRateInput.value = horse.winProbability || 0;
                if (placeRateInput) placeRateInput.value = horse.placeProbability || 0;
                if (oddsInput) oddsInput.value = horse.odds || 0;
            });
        }
        
        // ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveRaceData() {
            const raceData = {
                id: Date.now(),
                date: document.getElementById('raceDate').value,
                course: document.getElementById('raceCourse').value,
                name: document.getElementById('raceName').value,
                horseCount: parseInt(document.getElementById('horseCount').value),
                trackCondition: document.getElementById('trackCondition').value,
                results: {
                    first: parseInt(document.getElementById('firstPlace').value),
                    second: parseInt(document.getElementById('secondPlace').value),
                    third: parseInt(document.getElementById('thirdPlace').value),
                    winPayback: parseInt(document.getElementById('winPayback').value) || 0,
                    placePayback: parseInt(document.getElementById('placePayback').value) || 0
                },
                predictions: [],
                analysis: {}
            };
            
            // äºˆæ¸¬ãƒ‡ãƒ¼ã‚¿åé›†
            for (let i = 1; i <= raceData.horseCount; i++) {
                const scoreEl = document.getElementById(`score_${i}`);
                const ensembleEl = document.getElementById(`ensemble_${i}`);
                const winRateEl = document.getElementById(`winRate_${i}`);
                const placeRateEl = document.getElementById(`placeRate_${i}`);
                const oddsEl = document.getElementById(`odds_${i}`);
                
                if (scoreEl && scoreEl.value) {
                    raceData.predictions.push({
                        horseNumber: i,
                        score: parseFloat(scoreEl.value) || 0,
                        ensembleScore: parseFloat(ensembleEl.value) || 0,
                        winRate: parseFloat(winRateEl.value) || 0,
                        placeRate: parseFloat(placeRateEl.value) || 0,
                        odds: parseFloat(oddsEl.value) || 0
                    });
                }
            }
            
            // åˆ†æè¨ˆç®—
            raceData.analysis = calculateRaceAnalysis(raceData);
            
            // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            verificationData.push(raceData);
            localStorage.setItem('horseVerificationData', JSON.stringify(verificationData));
            
            showNotification(`ğŸ“Š ãƒ¬ãƒ¼ã‚¹${verificationData.length}ä»¶ç›®ã‚’ä¿å­˜ã—ã¾ã—ãŸ`);
            clearForm();
        }
        
        // ãƒ¬ãƒ¼ã‚¹åˆ†æè¨ˆç®—
        function calculateRaceAnalysis(raceData) {
            const analysis = {
                scoreAccuracy: false,
                ensembleAccuracy: false,
                winPredictionHit: false,
                placePredictionHit: false,
                topScoreHorse: 0,
                topEnsembleHorse: 0,
                roi: 0
            };
            
            if (raceData.predictions.length === 0) return analysis;
            
            // æœ€é«˜ã‚¹ã‚³ã‚¢é¦¬
            const topScoreHorse = raceData.predictions.reduce((prev, current) => 
                prev.score > current.score ? prev : current
            );
            analysis.topScoreHorse = topScoreHorse.horseNumber;
            analysis.scoreAccuracy = topScoreHorse.horseNumber === raceData.results.first;
            
            // æœ€é«˜ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ã‚¹ã‚³ã‚¢é¦¬
            const topEnsembleHorse = raceData.predictions.reduce((prev, current) => 
                prev.ensembleScore > current.ensembleScore ? prev : current
            );
            analysis.topEnsembleHorse = topEnsembleHorse.horseNumber;
            analysis.ensembleAccuracy = topEnsembleHorse.horseNumber === raceData.results.first;
            
            // è¤‡å‹çš„ä¸­ãƒã‚§ãƒƒã‚¯
            const topPlaceHorses = raceData.predictions
                .sort((a, b) => b.placeRate - a.placeRate)
                .slice(0, 3)
                .map(h => h.horseNumber);
            
            analysis.placePredictionHit = [raceData.results.first, raceData.results.second, raceData.results.third]
                .some(place => topPlaceHorses.includes(place));
            
            // ROIè¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const investment = 100; // ä»®æƒ³æŠ•è³‡é¡
            let returns = 0;
            
            if (analysis.scoreAccuracy && raceData.results.winPayback) {
                returns = raceData.results.winPayback;
            } else if (analysis.placePredictionHit && raceData.results.placePayback) {
                returns = raceData.results.placePayback;
            }
            
            analysis.roi = ((returns - investment) / investment) * 100;
            
            return analysis;
        }
        
        // çµæœè¡¨ç¤º
        function displayResults() {
            const container = document.getElementById('raceResultsList');
            container.innerHTML = '';
            
            if (verificationData.length === 0) {
                container.innerHTML = '<p>ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã‚¿ãƒ–ã‹ã‚‰ãƒ¬ãƒ¼ã‚¹çµæœã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>';
                return;
            }
            
            verificationData.forEach((race, index) => {
                const raceDiv = document.createElement('div');
                raceDiv.className = 'container';
                raceDiv.innerHTML = `
                    <h3>ãƒ¬ãƒ¼ã‚¹ ${index + 1}: ${race.name} (${race.date})</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                        <div>
                            <strong>åŸºæœ¬æƒ…å ±</strong><br>
                            ç«¶é¦¬å ´: ${race.course}<br>
                            é¦¬å ´: ${race.trackCondition}<br>
                            å‡ºèµ°: ${race.horseCount}é ­
                        </div>
                        <div>
                            <strong>çµæœ</strong><br>
                            1ç€: ${race.results.first}ç•ª<br>
                            2ç€: ${race.results.second}ç•ª<br>
                            3ç€: ${race.results.third}ç•ª
                        </div>
                        <div>
                            <strong>çš„ä¸­çŠ¶æ³</strong><br>
                            åŸºæœ¬ã‚¹ã‚³ã‚¢: ${race.analysis.scoreAccuracy ? 'âœ…' : 'âŒ'}<br>
                            ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«: ${race.analysis.ensembleAccuracy ? 'âœ…' : 'âŒ'}<br>
                            è¤‡å‹äºˆæƒ³: ${race.analysis.placePredictionHit ? 'âœ…' : 'âŒ'}<br>
                            ROI: ${race.analysis.roi.toFixed(1)}%
                        </div>
                    </div>
                `;
                container.appendChild(raceDiv);
            });
        }
        
        // ç·åˆè©•ä¾¡è¡¨ç¤º
        function displaySummary() {
            const container = document.getElementById('overallSummary');
            container.innerHTML = '';
            
            if (verificationData.length === 0) {
                container.innerHTML = '<p>åˆ†æã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            
            // ç·åˆçµ±è¨ˆè¨ˆç®—
            const totalRaces = verificationData.length;
            const scoreHits = verificationData.filter(r => r.analysis.scoreAccuracy).length;
            const ensembleHits = verificationData.filter(r => r.analysis.ensembleAccuracy).length;
            const placeHits = verificationData.filter(r => r.analysis.placePredictionHit).length;
            const avgROI = verificationData.reduce((sum, r) => sum + r.analysis.roi, 0) / totalRaces;
            
            const scoreAccuracy = (scoreHits / totalRaces) * 100;
            const ensembleAccuracy = (ensembleHits / totalRaces) * 100;
            const placeAccuracy = (placeHits / totalRaces) * 100;
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div class="summary-card">
                        <div>ç·ãƒ¬ãƒ¼ã‚¹æ•°</div>
                        <div class="summary-value">${totalRaces}</div>
                        <div>ãƒ¬ãƒ¼ã‚¹</div>
                    </div>
                    <div class="summary-card">
                        <div>åŸºæœ¬ã‚¹ã‚³ã‚¢çš„ä¸­ç‡</div>
                        <div class="summary-value">${scoreAccuracy.toFixed(1)}%</div>
                        <div>${scoreHits}/${totalRaces} ãƒ¬ãƒ¼ã‚¹</div>
                    </div>
                    <div class="summary-card">
                        <div>ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«çš„ä¸­ç‡</div>
                        <div class="summary-value">${ensembleAccuracy.toFixed(1)}%</div>
                        <div>${ensembleHits}/${totalRaces} ãƒ¬ãƒ¼ã‚¹</div>
                    </div>
                    <div class="summary-card">
                        <div>è¤‡å‹äºˆæƒ³çš„ä¸­ç‡</div>
                        <div class="summary-value">${placeAccuracy.toFixed(1)}%</div>
                        <div>${placeHits}/${totalRaces} ãƒ¬ãƒ¼ã‚¹</div>
                    </div>
                    <div class="summary-card">
                        <div>å¹³å‡ROI</div>
                        <div class="summary-value">${avgROI.toFixed(1)}%</div>
                        <div>${avgROI >= 0 ? 'åˆ©ç›Š' : 'æå¤±'}</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>ğŸ“Š è©³ç´°åˆ†æ</h3>
                    <table class="results-table">
                        <tr>
                            <th>è©•ä¾¡é …ç›®</th>
                            <th>åŸºæœ¬ã‚¹ã‚³ã‚¢</th>
                            <th>ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«</th>
                            <th>æ”¹å–„åº¦</th>
                        </tr>
                        <tr>
                            <td>1ç€çš„ä¸­ç‡</td>
                            <td>${scoreAccuracy.toFixed(1)}%</td>
                            <td>${ensembleAccuracy.toFixed(1)}%</td>
                            <td style="color: ${ensembleAccuracy > scoreAccuracy ? 'green' : 'red'}">
                                ${(ensembleAccuracy - scoreAccuracy).toFixed(1)}%
                            </td>
                        </tr>
                    </table>
                </div>
            `;
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function clearForm() {
            document.getElementById('raceDate').value = '';
            document.getElementById('raceCourse').value = '';
            document.getElementById('raceName').value = '';
            document.getElementById('horseCount').value = '8';
            document.getElementById('trackCondition').value = 'è‰¯';
            document.getElementById('firstPlace').value = '';
            document.getElementById('secondPlace').value = '';
            document.getElementById('thirdPlace').value = '';
            document.getElementById('winPayback').value = '';
            document.getElementById('placePayback').value = '';
            document.getElementById('predictionRows').innerHTML = '';
        }
        
        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportToCSV() {
            if (verificationData.length === 0) {
                showNotification('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            const headers = ['æ—¥ä»˜', 'ç«¶é¦¬å ´', 'ãƒ¬ãƒ¼ã‚¹å', 'åŸºæœ¬ã‚¹ã‚³ã‚¢çš„ä¸­', 'ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«çš„ä¸­', 'è¤‡å‹çš„ä¸­', 'ROI'];
            const rows = verificationData.map(race => [
                race.date,
                race.course,
                race.name,
                race.analysis.scoreAccuracy ? '1' : '0',
                race.analysis.ensembleAccuracy ? '1' : '0',
                race.analysis.placePredictionHit ? '1' : '0',
                race.analysis.roi.toFixed(2)
            ]);
            
            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `horse_verification_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportToJSON() {
            if (verificationData.length === 0) {
                showNotification('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(verificationData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `horse_verification_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    verificationData = data;
                    localStorage.setItem('horseVerificationData', JSON.stringify(verificationData));
                    showNotification(`${data.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
                } catch (error) {
                    showNotification('ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
        function clearAllData() {
            if (confirm('æœ¬å½“ã«å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                verificationData = [];
                localStorage.removeItem('horseVerificationData');
                showNotification('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                displayResults();
                displaySummary();
            }
        }
        
        // è¤‡å‹äºˆæƒ³è©³ç´°åˆ†æ
        function analyzePlacePredictions() {
            const container = document.getElementById('overallSummary');
            
            if (verificationData.length === 0) {
                container.innerHTML = '<p>åˆ†æã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            
            // è¤‡å‹äºˆæƒ³ã®è©³ç´°åˆ†æ
            const placeAnalysis = {
                totalPredictions: 0,
                popularityAnalysis: { // äººæ°—å±¤åˆ†æ
                    favorite: { count: 0, hits: 0, odds: [] },     // 1-3ç•ªäººæ°—
                    midrange: { count: 0, hits: 0, odds: [] },     // 4-6ç•ªäººæ°—
                    outsider: { count: 0, hits: 0, odds: [] }      // 7ç•ªäººæ°—ä»¥ä¸‹
                },
                oddsAnalysis: { // ã‚ªãƒƒã‚ºåˆ†æ
                    low: { count: 0, hits: 0, range: '1.0-2.0å€' },    // 100-200å††
                    medium: { count: 0, hits: 0, range: '2.0-5.0å€' }, // 200-500å††
                    high: { count: 0, hits: 0, range: '5.0å€ä»¥ä¸Š' }    // 500å††ä»¥ä¸Š
                },
                hitPatterns: [] // çš„ä¸­ãƒ‘ã‚¿ãƒ¼ãƒ³
            };
            
            verificationData.forEach(race => {
                if (race.predictions && race.predictions.length > 0) {
                    // è¤‡å‹ç‡ã§ã‚½ãƒ¼ãƒˆ
                    const sortedByPlace = race.predictions
                        .sort((a, b) => b.placeRate - a.placeRate)
                        .slice(0, 3); // ä¸Šä½3é ­
                    
                    sortedByPlace.forEach(horse => {
                        placeAnalysis.totalPredictions++;
                        
                        // äººæ°—å±¤åˆ†æï¼ˆã‚ªãƒƒã‚ºãƒ™ãƒ¼ã‚¹ï¼‰
                        const odds = horse.odds || 0;
                        if (odds <= 3) {
                            placeAnalysis.popularityAnalysis.favorite.count++;
                            placeAnalysis.popularityAnalysis.favorite.odds.push(odds);
                            if ([race.results.first, race.results.second, race.results.third].includes(horse.horseNumber)) {
                                placeAnalysis.popularityAnalysis.favorite.hits++;
                            }
                        } else if (odds <= 7) {
                            placeAnalysis.popularityAnalysis.midrange.count++;
                            placeAnalysis.popularityAnalysis.midrange.odds.push(odds);
                            if ([race.results.first, race.results.second, race.results.third].includes(horse.horseNumber)) {
                                placeAnalysis.popularityAnalysis.midrange.hits++;
                            }
                        } else {
                            placeAnalysis.popularityAnalysis.outsider.count++;
                            placeAnalysis.popularityAnalysis.outsider.odds.push(odds);
                            if ([race.results.first, race.results.second, race.results.third].includes(horse.horseNumber)) {
                                placeAnalysis.popularityAnalysis.outsider.hits++;
                            }
                        }
                        
                        // ã‚ªãƒƒã‚ºåˆ†æï¼ˆè¤‡å‹æƒ³å®šé…å½“ï¼‰
                        const estimatedPlaceOdds = odds * 0.4; // æ¦‚ç®—è¤‡å‹é…å½“
                        if (estimatedPlaceOdds <= 2.0) {
                            placeAnalysis.oddsAnalysis.low.count++;
                            if ([race.results.first, race.results.second, race.results.third].includes(horse.horseNumber)) {
                                placeAnalysis.oddsAnalysis.low.hits++;
                            }
                        } else if (estimatedPlaceOdds <= 5.0) {
                            placeAnalysis.oddsAnalysis.medium.count++;
                            if ([race.results.first, race.results.second, race.results.third].includes(horse.horseNumber)) {
                                placeAnalysis.oddsAnalysis.medium.hits++;
                            }
                        } else {
                            placeAnalysis.oddsAnalysis.high.count++;
                            if ([race.results.first, race.results.second, race.results.third].includes(horse.horseNumber)) {
                                placeAnalysis.oddsAnalysis.high.hits++;
                            }
                        }
                    });
                    
                    // çš„ä¸­ãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜éŒ²
                    const hitPattern = {
                        raceIndex: verificationData.indexOf(race),
                        top3Predictions: sortedByPlace.map(h => ({ 
                            horseNumber: h.horseNumber, 
                            placeRate: h.placeRate, 
                            odds: h.odds 
                        })),
                        actualResult: [race.results.first, race.results.second, race.results.third],
                        hitCount: sortedByPlace.filter(h => 
                            [race.results.first, race.results.second, race.results.third].includes(h.horseNumber)
                        ).length
                    };
                    placeAnalysis.hitPatterns.push(hitPattern);
                }
            });
            
            // çµæœè¡¨ç¤º
            container.innerHTML = `
                <div class="summary-card">
                    <h3>ğŸ¯ è¤‡å‹äºˆæƒ³è©³ç´°åˆ†æ</h3>
                    <p>ç·äºˆæƒ³æ•°: ${placeAnalysis.totalPredictions}é ­</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h4>ğŸ‘‘ äººæ°—å±¤åˆ¥åˆ†æ</h4>
                        <table class="results-table">
                            <tr><th>äººæ°—å±¤</th><th>äºˆæƒ³æ•°</th><th>çš„ä¸­æ•°</th><th>çš„ä¸­ç‡</th><th>å¹³å‡ã‚ªãƒƒã‚º</th></tr>
                            <tr>
                                <td>äººæ°—é¦¬(1-3ç•ª)</td>
                                <td>${placeAnalysis.popularityAnalysis.favorite.count}</td>
                                <td>${placeAnalysis.popularityAnalysis.favorite.hits}</td>
                                <td>${placeAnalysis.popularityAnalysis.favorite.count > 0 ? 
                                    ((placeAnalysis.popularityAnalysis.favorite.hits / placeAnalysis.popularityAnalysis.favorite.count) * 100).toFixed(1) : '0.0'}%</td>
                                <td>${placeAnalysis.popularityAnalysis.favorite.odds.length > 0 ? 
                                    (placeAnalysis.popularityAnalysis.favorite.odds.reduce((a,b) => a+b, 0) / placeAnalysis.popularityAnalysis.favorite.odds.length).toFixed(1) : '0.0'}å€</td>
                            </tr>
                            <tr>
                                <td>ä¸­äººæ°—(4-6ç•ª)</td>
                                <td>${placeAnalysis.popularityAnalysis.midrange.count}</td>
                                <td>${placeAnalysis.popularityAnalysis.midrange.hits}</td>
                                <td>${placeAnalysis.popularityAnalysis.midrange.count > 0 ? 
                                    ((placeAnalysis.popularityAnalysis.midrange.hits / placeAnalysis.popularityAnalysis.midrange.count) * 100).toFixed(1) : '0.0'}%</td>
                                <td>${placeAnalysis.popularityAnalysis.midrange.odds.length > 0 ? 
                                    (placeAnalysis.popularityAnalysis.midrange.odds.reduce((a,b) => a+b, 0) / placeAnalysis.popularityAnalysis.midrange.odds.length).toFixed(1) : '0.0'}å€</td>
                            </tr>
                            <tr>
                                <td>ç©´é¦¬(7ç•ªä»¥ä¸‹)</td>
                                <td>${placeAnalysis.popularityAnalysis.outsider.count}</td>
                                <td>${placeAnalysis.popularityAnalysis.outsider.hits}</td>
                                <td>${placeAnalysis.popularityAnalysis.outsider.count > 0 ? 
                                    ((placeAnalysis.popularityAnalysis.outsider.hits / placeAnalysis.popularityAnalysis.outsider.count) * 100).toFixed(1) : '0.0'}%</td>
                                <td>${placeAnalysis.popularityAnalysis.outsider.odds.length > 0 ? 
                                    (placeAnalysis.popularityAnalysis.outsider.odds.reduce((a,b) => a+b, 0) / placeAnalysis.popularityAnalysis.outsider.odds.length).toFixed(1) : '0.0'}å€</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div>
                        <h4>ğŸ’° è¤‡å‹é…å½“åŠ¹ç‡åˆ†æ</h4>
                        <table class="results-table">
                            <tr><th>é…å½“ãƒ¬ãƒ³ã‚¸</th><th>äºˆæƒ³æ•°</th><th>çš„ä¸­æ•°</th><th>çš„ä¸­ç‡</th><th>åŠ¹ç‡</th></tr>
                            <tr>
                                <td>${placeAnalysis.oddsAnalysis.low.range}</td>
                                <td>${placeAnalysis.oddsAnalysis.low.count}</td>
                                <td>${placeAnalysis.oddsAnalysis.low.hits}</td>
                                <td>${placeAnalysis.oddsAnalysis.low.count > 0 ? 
                                    ((placeAnalysis.oddsAnalysis.low.hits / placeAnalysis.oddsAnalysis.low.count) * 100).toFixed(1) : '0.0'}%</td>
                                <td style="color: red;">ä½åŠ¹ç‡</td>
                            </tr>
                            <tr>
                                <td>${placeAnalysis.oddsAnalysis.medium.range}</td>
                                <td>${placeAnalysis.oddsAnalysis.medium.count}</td>
                                <td>${placeAnalysis.oddsAnalysis.medium.hits}</td>
                                <td>${placeAnalysis.oddsAnalysis.medium.count > 0 ? 
                                    ((placeAnalysis.oddsAnalysis.medium.hits / placeAnalysis.oddsAnalysis.medium.count) * 100).toFixed(1) : '0.0'}%</td>
                                <td style="color: orange;">ä¸­åŠ¹ç‡</td>
                            </tr>
                            <tr>
                                <td>${placeAnalysis.oddsAnalysis.high.range}</td>
                                <td>${placeAnalysis.oddsAnalysis.high.count}</td>
                                <td>${placeAnalysis.oddsAnalysis.high.hits}</td>
                                <td>${placeAnalysis.oddsAnalysis.high.count > 0 ? 
                                    ((placeAnalysis.oddsAnalysis.high.hits / placeAnalysis.oddsAnalysis.high.count) * 100).toFixed(1) : '0.0'}%</td>
                                <td style="color: green;">é«˜åŠ¹ç‡</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4>ğŸ“Š çš„ä¸­ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="results-table">
                            <tr><th>ãƒ¬ãƒ¼ã‚¹</th><th>è¤‡å‹äºˆæƒ³ä¸Šä½3é ­</th><th>å®Ÿéš›ã®çµæœ</th><th>çš„ä¸­æ•°</th></tr>
                            ${placeAnalysis.hitPatterns.map(pattern => `
                                <tr>
                                    <td>R${pattern.raceIndex + 1}</td>
                                    <td>${pattern.top3Predictions.map(p => `${p.horseNumber}ç•ª(${p.placeRate}%)`).join(', ')}</td>
                                    <td>${pattern.actualResult.join('-')}</td>
                                    <td style="color: ${pattern.hitCount >= 2 ? 'green' : pattern.hitCount === 1 ? 'orange' : 'red'}">
                                        ${pattern.hitCount}/3
                                    </td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                </div>
            `;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('raceDate').value = today;
            generatePredictionRows();
        });
    </script>
</body>
</html>