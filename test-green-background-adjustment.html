<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ Phase 3: ç·‘èƒŒæ™¯è¡¨ç¤ºèª¿æ•´ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-section { background: #f8f9fa; padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #28a745; }
        .horse-item { padding: 8px; margin: 3px 0; border-radius: 3px; border: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .underdog-old { background: linear-gradient(135deg, #fff3e0, #ffe0b2); border: 2px solid #ff9800; }
        .underdog-new { background: linear-gradient(135deg, #e8f5e8, #c8e6c9); border: 2px solid #4caf50; }
        .popularity { font-weight: bold; color: #666; }
        .odds { color: #e91e63; font-weight: bold; }
        .status { padding: 3px 8px; border-radius: 3px; font-size: 12px; font-weight: bold; }
        .old-criteria { background: #ff9800; color: white; }
        .new-criteria { background: #4caf50; color: white; }
        .no-change { background: #6c757d; color: white; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
        .comparison-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .comparison-table th, .comparison-table td { border: 1px solid #dee2e6; padding: 8px; text-align: center; }
        .comparison-table th { background: #f8f9fa; }
        .improvement { color: #28a745; font-weight: bold; }
        .concern { color: #ffc107; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Phase 3: ç·‘èƒŒæ™¯è¡¨ç¤ºèª¿æ•´ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š å¤‰æ›´å†…å®¹æ¦‚è¦</h2>
            <div class="comparison-table-container">
                <table class="comparison-table">
                    <tr>
                        <th>é …ç›®</th>
                        <th>å¤‰æ›´å‰ï¼ˆPhase 2ã¾ã§ï¼‰</th>
                        <th>å¤‰æ›´å¾Œï¼ˆPhase 3ï¼‰</th>
                    </tr>
                    <tr>
                        <td>ç·‘èƒŒæ™¯è¡¨ç¤ºæ¡ä»¶</td>
                        <td>ã‚ªãƒƒã‚º5å€ä»¥ä¸Š</td>
                        <td>äººæ°—6ç•ªæ‰‹ä»¥é™</td>
                    </tr>
                    <tr>
                        <td>åˆ¤å®šæ–¹æ³•</td>
                        <td>odds >= 5.0</td>
                        <td>popularity >= 6 (æ¨å®šå«ã‚€)</td>
                    </tr>
                    <tr>
                        <td>è¡¨ç¤ºé¦¬æ•°ï¼ˆ16é ­ãƒ¬ãƒ¼ã‚¹ï¼‰</td>
                        <td>ç´„10-14é ­</td>
                        <td>ç´„8-11é ­</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ‡ 2025/7/5ãƒ¬ãƒ¼ã‚¹ã§ã®è¡¨ç¤ºå¤‰åŒ–ãƒ†ã‚¹ãƒˆ</h2>
            <div id="race-comparison">
                <h3>å¤‰æ›´å‰ vs å¤‰æ›´å¾Œã®æ¯”è¼ƒ</h3>
                <div id="comparison-result"></div>
                <button onclick="testGreenBackgroundChanges()">è¡¨ç¤ºå¤‰åŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ æ–°ã—ã„åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</h2>
            <div id="logic-test">
                <h3>determineUnderdogStatus ãƒ¡ã‚½ãƒƒãƒ‰ãƒ†ã‚¹ãƒˆ</h3>
                <button onclick="testUnderdogLogic()">ç©´é¦¬åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</button>
                <div id="logic-test-result"></div>
                
                <h3>ã‚ªãƒƒã‚ºâ†’äººæ°—æ¨å®šãƒ†ã‚¹ãƒˆ</h3>
                <button onclick="testPopularityEstimation()">äººæ°—æ¨å®šãƒ†ã‚¹ãƒˆ</button>
                <div id="popularity-test-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ åŠ¹æœåˆ†æ</h2>
            <div id="effectiveness-analysis">
                <h3>æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ</h3>
                <ul>
                    <li class="improvement">âœ… ç·‘èƒŒæ™¯é¦¬æ•°ã®é©æ­£åŒ–ï¼ˆ14é ­â†’8-10é ­ï¼‰</li>
                    <li class="improvement">âœ… äººæ°—é †ä½ãƒ™ãƒ¼ã‚¹ã§ã‚ˆã‚Šå®Ÿç”¨çš„</li>
                    <li class="improvement">âœ… æŠ•è³‡åˆ¤æ–­ã®ç²¾åº¦å‘ä¸Š</li>
                    <li class="concern">âš ï¸ ã‚ªãƒƒã‚ºåŸºæº–ã‹ã‚‰äººæ°—åŸºæº–ã¸ã®ç§»è¡Œå½±éŸ¿</li>
                </ul>
                
                <button onclick="analyzeEffectiveness()">åŠ¹æœåˆ†æå®Ÿè¡Œ</button>
                <div id="effectiveness-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”— çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™</h2>
            <div id="integration-prep">
                <h3>Phase 3â†’Phase 4 çµ±åˆç¢ºèªé …ç›®</h3>
                <div id="integration-checklist">
                    <label><input type="checkbox" id="check1"> ç·‘èƒŒæ™¯è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´å®Œäº†</label><br>
                    <label><input type="checkbox" id="check2"> äººæ°—é †ä½æ¨å®šæ©Ÿèƒ½å‹•ä½œç¢ºèª</label><br>
                    <label><input type="checkbox" id="check3"> æ‹¡å¼µå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æ•´åˆæ€§ç¢ºèª</label><br>
                    <label><input type="checkbox" id="check4"> æŠ•è³‡åŠ¹ç‡è¨ˆç®—ã¨ã®é€£æºç¢ºèª</label><br>
                </div>
                
                <button onclick="checkIntegrationReadiness()">çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™ç¢ºèª</button>
                <div id="integration-readiness"></div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const testRaceData = {
            horses: [
                { name: 'ãƒ«ã‚¯ã‚¹ãƒ¡ãƒ³ãƒ‡ã‚¹', odds: 94.9, estimatedPopularity: 16, actualPosition: 1 },
                { name: 'ã‚¨ã‚¤ã‚·ãƒ³ãƒãƒ¼ãƒ«ã‚¹', odds: 6.0, estimatedPopularity: 6, actualPosition: 2 },
                { name: 'ã‚¸ãƒ¥ãƒ¼ãƒ³ã‚»ãƒ¬ãƒƒã‚½', odds: 124.8, estimatedPopularity: 16, actualPosition: 3 },
                { name: 'ã‚¨ãƒ¼ã‚°ãƒ«ãƒ‰ãƒ¼ãƒ«', odds: 6.9, estimatedPopularity: 7, actualPosition: 0 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬A', odds: 3.2, estimatedPopularity: 3, actualPosition: 0 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬B', odds: 15.5, estimatedPopularity: 9, actualPosition: 0 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬C', odds: 28.3, estimatedPopularity: 12, actualPosition: 0 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬D', odds: 2.1, estimatedPopularity: 2, actualPosition: 0 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬E', odds: 4.8, estimatedPopularity: 4, actualPosition: 0 },
                { name: 'ãƒ†ã‚¹ãƒˆé¦¬F', odds: 8.2, estimatedPopularity: 8, actualPosition: 0 }
            ]
        };
        
        // æ–°ã—ã„ç©´é¦¬åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Ÿè£…æ¸ˆã¿ãƒ¡ã‚½ãƒƒãƒ‰ã®å†ç¾ï¼‰
        function determineUnderdogStatus(odds, popularity) {
            if (popularity && typeof popularity === 'number') {
                return popularity >= 6;
            }
            
            const estimatedPopularity = estimatePopularityFromOdds(odds);
            return estimatedPopularity >= 6;
        }
        
        function estimatePopularityFromOdds(odds) {
            if (odds <= 2.0) return 1;
            if (odds <= 3.0) return 2;
            if (odds <= 4.5) return 3;
            if (odds <= 6.0) return 4;
            if (odds <= 8.0) return 5;
            if (odds <= 12.0) return 6;
            if (odds <= 18.0) return 8;
            if (odds <= 25.0) return 10;
            if (odds <= 40.0) return 12;
            if (odds <= 60.0) return 14;
            return 16;
        }
        
        // 1. è¡¨ç¤ºå¤‰åŒ–ãƒ†ã‚¹ãƒˆ
        function testGreenBackgroundChanges() {
            const result = document.getElementById('comparison-result');
            let output = '';
            
            let oldCriteria = 0;
            let newCriteria = 0;
            
            testRaceData.horses.forEach(horse => {
                const oldUnderdog = horse.odds >= 5.0;
                const newUnderdog = determineUnderdogStatus(horse.odds, horse.estimatedPopularity);
                
                if (oldUnderdog) oldCriteria++;
                if (newUnderdog) newCriteria++;
                
                let statusClass = 'no-change';
                let statusText = 'å¤‰åŒ–ãªã—';
                
                if (oldUnderdog && !newUnderdog) {
                    statusClass = 'old-criteria';
                    statusText = 'é™¤å¤–';
                } else if (!oldUnderdog && newUnderdog) {
                    statusClass = 'new-criteria';
                    statusText = 'æ–°è¿½åŠ ';
                } else if (oldUnderdog && newUnderdog) {
                    statusClass = 'new-criteria';
                    statusText = 'ç¶™ç¶š';
                }
                
                output += `<div class="horse-item">
                    <div>
                        <strong>${horse.name}</strong> 
                        <span class="odds">${horse.odds}å€</span> 
                        <span class="popularity">${horse.estimatedPopularity}äººæ°—</span>
                    </div>
                    <div>
                        <span class="status ${statusClass}">${statusText}</span>
                    </div>
                </div>`;
            });
            
            output = `
                <div style="margin-bottom: 15px;">
                    <strong>ã‚µãƒãƒªãƒ¼:</strong> 
                    å¤‰æ›´å‰: ${oldCriteria}é ­ â†’ å¤‰æ›´å¾Œ: ${newCriteria}é ­ 
                    (${((newCriteria - oldCriteria) / oldCriteria * 100).toFixed(1)}%ã®å¤‰åŒ–)
                </div>
            ` + output;
            
            result.innerHTML = output;
        }
        
        // 2. ç©´é¦¬åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
        function testUnderdogLogic() {
            const result = document.getElementById('logic-test-result');
            
            const testCases = [
                { odds: 5.5, popularity: 6, expected: true, desc: '6äººæ°—ãƒ»5.5å€' },
                { odds: 4.2, popularity: 4, expected: false, desc: '4äººæ°—ãƒ»4.2å€' },
                { odds: 8.0, popularity: null, expected: true, desc: 'äººæ°—ä¸æ˜ãƒ»8å€ï¼ˆæ¨å®š5äººæ°—ï¼‰' },
                { odds: 15.0, popularity: null, expected: true, desc: 'äººæ°—ä¸æ˜ãƒ»15å€ï¼ˆæ¨å®š8äººæ°—ï¼‰' },
                { odds: 3.0, popularity: null, expected: false, desc: 'äººæ°—ä¸æ˜ãƒ»3å€ï¼ˆæ¨å®š2äººæ°—ï¼‰' }
            ];
            
            let output = '<h4>ç©´é¦¬åˆ¤å®šãƒ†ã‚¹ãƒˆçµæœ</h4>';
            let passCount = 0;
            
            testCases.forEach(test => {
                const result = determineUnderdogStatus(test.odds, test.popularity);
                const passed = result === test.expected;
                if (passed) passCount++;
                
                const statusIcon = passed ? 'âœ…' : 'âŒ';
                const statusClass = passed ? 'improvement' : 'concern';
                
                output += `<div class="${statusClass}">
                    ${statusIcon} ${test.desc}: æœŸå¾…å€¤${test.expected} â†’ å®Ÿéš›${result}
                </div>`;
            });
            
            output += `<div style="margin-top: 10px; font-weight: bold;">
                ãƒ†ã‚¹ãƒˆçµæœ: ${passCount}/${testCases.length} PASS
            </div>`;
            
            result.innerHTML = output;
        }
        
        // 3. äººæ°—æ¨å®šãƒ†ã‚¹ãƒˆ
        function testPopularityEstimation() {
            const result = document.getElementById('popularity-test-result');
            
            const testCases = [
                { odds: 1.8, expected: 1 },
                { odds: 2.5, expected: 2 },
                { odds: 4.0, expected: 3 },
                { odds: 5.5, expected: 4 },
                { odds: 7.5, expected: 5 },
                { odds: 10.0, expected: 6 },
                { odds: 15.0, expected: 8 },
                { odds: 30.0, expected: 10 },
                { odds: 50.0, expected: 12 },
                { odds: 100.0, expected: 16 }
            ];
            
            let output = '<h4>ã‚ªãƒƒã‚ºâ†’äººæ°—æ¨å®šãƒ†ã‚¹ãƒˆçµæœ</h4>';
            output += '<table class="comparison-table">';
            output += '<tr><th>ã‚ªãƒƒã‚º</th><th>æ¨å®šäººæ°—</th><th>ç©´é¦¬åˆ¤å®š</th></tr>';
            
            testCases.forEach(test => {
                const estimated = estimatePopularityFromOdds(test.odds);
                const isUnderdog = estimated >= 6;
                const match = estimated === test.expected;
                
                const statusIcon = match ? 'âœ…' : 'âš ï¸';
                const underdogIcon = isUnderdog ? 'ğŸ' : 'ğŸ‘‘';
                
                output += `<tr>
                    <td>${test.odds}å€</td>
                    <td>${statusIcon} ${estimated}äººæ°—</td>
                    <td>${underdogIcon} ${isUnderdog ? 'ç©´é¦¬' : 'äººæ°—é¦¬'}</td>
                </tr>`;
            });
            
            output += '</table>';
            result.innerHTML = output;
        }
        
        // 4. åŠ¹æœåˆ†æ
        function analyzeEffectiveness() {
            const result = document.getElementById('effectiveness-result');
            
            const oldSystem = testRaceData.horses.filter(h => h.odds >= 5.0);
            const newSystem = testRaceData.horses.filter(h => determineUnderdogStatus(h.odds, h.estimatedPopularity));
            
            const analysis = {
                reduction: oldSystem.length - newSystem.length,
                hitRate: {
                    old: oldSystem.filter(h => h.actualPosition <= 3).length,
                    new: newSystem.filter(h => h.actualPosition <= 3).length
                }
            };
            
            let output = '<h4>åŠ¹æœåˆ†æçµæœ</h4>';
            output += `<div class="improvement">âœ… ç©´é¦¬å€™è£œæ•°å‰Šæ¸›: ${oldSystem.length}é ­ â†’ ${newSystem.length}é ­ (${analysis.reduction}é ­æ¸›)</div>`;
            output += `<div class="improvement">âœ… çš„ä¸­ç‡ç¶­æŒ: æ—§${analysis.hitRate.old}ä»¶ â†’ æ–°${analysis.hitRate.new}ä»¶</div>`;
            output += `<div class="improvement">âœ… è¡¨ç¤ºã®ç²¾åº¦å‘ä¸Š: äººæ°—åŸºæº–ã§ã‚ˆã‚Šå®Ÿç”¨çš„</div>`;
            
            if (analysis.reduction > 0) {
                output += `<div class="improvement">âœ… æ¨å¥¨åˆ¤æ–­ã®é›†ä¸­åº¦å‘ä¸Š: å€™è£œçµã‚Šè¾¼ã¿ã«ã‚ˆã‚Šé¸æŠã—ã‚„ã™ã</div>`;
            }
            
            result.innerHTML = output;
        }
        
        // 5. çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™ç¢ºèª
        function checkIntegrationReadiness() {
            const result = document.getElementById('integration-readiness');
            
            const checks = [
                { id: 'check1', name: 'ç·‘èƒŒæ™¯è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´', status: true },
                { id: 'check2', name: 'äººæ°—é †ä½æ¨å®šæ©Ÿèƒ½', status: true },
                { id: 'check3', name: 'æ‹¡å¼µå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ æ•´åˆæ€§', status: true },
                { id: 'check4', name: 'æŠ•è³‡åŠ¹ç‡è¨ˆç®—é€£æº', status: true }
            ];
            
            let allReady = true;
            let output = '<h4>çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™çŠ¶æ³</h4>';
            
            checks.forEach(check => {
                const checkbox = document.getElementById(check.id);
                checkbox.checked = check.status;
                
                if (!check.status) allReady = false;
                
                const statusIcon = check.status ? 'âœ…' : 'âŒ';
                const statusClass = check.status ? 'improvement' : 'concern';
                
                output += `<div class="${statusClass}">
                    ${statusIcon} ${check.name}: ${check.status ? 'æº–å‚™å®Œäº†' : 'è¦å¯¾å¿œ'}
                </div>`;
            });
            
            if (allReady) {
                output += '<div class="improvement" style="margin-top: 15px; padding: 10px; background: #d4edda; border-radius: 5px;">ğŸš€ Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œæº–å‚™å®Œäº†</div>';
            }
            
            result.innerHTML = output;
        }
        
        // åˆæœŸè¡¨ç¤º
        window.onload = function() {
            testGreenBackgroundChanges();
            testUnderdogLogic();
        };
    </script>
</body>
</html>