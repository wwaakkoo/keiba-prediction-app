# 競馬予測アプリ TODO リスト

## 🚨 緊急（最優先）

### [x] AI API統合の完全実装 ✅ **完了**
- **ファイル**: `js/aiRecommendationService.js`
- **箇所**: `generateRecommendation()` メソッド（30-40行目付近）
- **現状**: ~~模擬実装のみ~~ → **実装完了**
- **完了作業**:
  - [x] Claude API実際の呼び出し処理
  - [x] レート制限・タイムアウト処理
  - [x] APIキー管理システム
  - [x] エラーハンドリング強化

### [x] エラーハンドリング強化 ✅ **完了**
- **ファイル**: `js/dataConverter.js`, `js/aiRecommendationService.js`
- **高リスク箇所**: 
  - `aiRecommendationService.js:356` - HTTP エラー処理
  - `dataConverter.js` - 複数のcatch文の復旧処理不足
- **完了作業**:
  - [x] 段階的エラー復旧処理追加
  - [x] ユーザーフレンドリーなエラーメッセージ
  - [x] データ部分抽出失敗時の代替処理

### [x] データ検証機能追加 ✅ **完了**
- **ファイル**: `js/dataConverter.js`
- **完了作業**:
  - [x] 異常オッズ検出（0倍、1000倍超等）
  - [x] 異常タイム検出（物理的に不可能な記録）
  - [x] データ整合性チェック機能

---

## 🔥 高優先

### [ ] ペース分析機能追加
- **ファイル**: `js/raceAnalysisEngine.js`
- **必要作業**:
  - [ ] ラップタイム分析機能
  - [ ] セクションタイム考慮機能
  - [ ] ペース変化による着順影響分析
  - [ ] `PaceAnalyzer`クラス新規作成

### [x] 複雑馬券種対応 ✅ **完了**
- **ファイル**: `js/bettingRecommender.js`
- **完了作業**:
  - [x] 3連複推奨機能 ✅ **実装完了**
  - [x] 3連単推奨機能 ✅ **実装完了**
  - [x] 組み合わせ期待値計算 ✅ **実装完了**
  - [ ] WIN5等特殊馬券対応

### [ ] モバイルUI最適化
- **ファイル**: `styles/main.css`, `index.html`
- **必要作業**:
  - [ ] タッチ操作最適化
  - [ ] 画面回転時レイアウト調整
  - [ ] スワイプジェスチャー対応
  - [ ] 片手操作モード

---

## 📈 中優先

### [ ] 馬場差分析実装
- **ファイル**: `js/raceAnalysisEngine.js`
- **必要作業**:
  - [ ] 同日他レースとの馬場差比較
  - [ ] 時間経過による馬場変化考慮
  - [ ] 馬場状態の定量化

### [ ] 高度な学習機能
- **ファイル**: `js/learningSystem.js`
- **必要作業**:
  - [ ] 過学習防止アルゴリズム
  - [ ] 特徴量自動発見機能
  - [ ] アンサンブル学習
  - [ ] クロスバリデーション

### [ ] アクセシビリティ改善
- **必要作業**:
  - [ ] スクリーンリーダー対応
  - [ ] キーボードナビゲーション
  - [ ] 色覚異常対応
  - [ ] 音声入力対応

### [ ] パフォーマンス最適化
- **必要作業**:
  - [ ] 大量データ表示の仮想化
  - [ ] 画像遅延読み込み
  - [ ] コード分割・lazy loading
  - [ ] メモリ使用量最適化

---

## 🔧 低優先

### [ ] データソース拡張
- **ファイル**: `js/dataConverter.js`
- **必要作業**:
  - [ ] 競馬ブック対応
  - [ ] JRA公式データ対応
  - [ ] PDF・画像データ抽出

### [ ] 高度な資金管理
- **ファイル**: `js/bettingRecommender.js`
- **必要作業**:
  - [ ] ケリー基準実装
  - [ ] リスク分散投資法
  - [ ] 資金推移グラフ
  - [ ] 損益管理システム

### [ ] 環境条件分析
- **ファイル**: `js/raceAnalysisEngine.js`
- **必要作業**:
  - [ ] 風向・風速・湿度分析
  - [ ] 季節要因分析
  - [ ] 開催時刻影響分析

### [ ] リアルタイム機能
- **新規ファイル**: `js/realtimeSystem.js`
- **必要作業**:
  - [ ] リアルタイムオッズ取得
  - [ ] オッズ変動アラート
  - [ ] レース直前予想更新

---

## 🎯 特別プロジェクト

### [ ] 血統分析システム統合
- **参照ブランチ**: `feature/pedigree-extraction`
- **必要作業**:
  - [ ] 完成版血統機能をメインブランチに統合
  - [ ] 血統データベース統合
  - [ ] 配合理論実装

### [ ] ダークモード対応
- **新規ファイル**: `styles/dark-theme.css`
- **必要作業**:
  - [ ] ダーク・ライトテーマ切り替え
  - [ ] 目に優しい配色
  - [ ] ユーザー設定保存

### [ ] マルチレース分析
- **新規ファイル**: `js/multiRaceAnalyzer.js`
- **必要作業**:
  - [ ] 複数レース同時分析
  - [ ] 1日収支シミュレーション

---

## 🐛 バグ修正

### [x] 数値計算のNaN処理 ✅ **完了**
- **箇所**: 複数ファイル
- **問題**: ~~`parseFloat(horse.odds) || 10` 等のNaN検証不足~~ → **型安全性向上で解決**
- **修正**: 適切なバリデーション追加

### [ ] LocalStorage容量制限対策
- **ファイル**: `js/learningSystem.js`
- **問題**: 学習データ蓄積による容量上限到達
- **修正**: データ圧縮・古いデータ自動削除

### [ ] ブラウザ互換性
- **箇所**: ES6機能使用箇所
- **修正**: ポリフィル追加、古いブラウザ対応

---

## 📋 実装チェックリスト

### 新機能実装時の必須事項
- [x] エラーハンドリング実装
- [ ] ユニットテスト作成
- [ ] パフォーマンステスト実施
- [x] 既存機能への影響確認
- [ ] ドキュメント更新
- [ ] ユーザビリティテスト

### コーディング規約チェック
- [x] 既存のコメントスタイル維持
- [x] ログ出力の一貫性保持
- [x] 変数・関数命名規約準拠
- [x] インデント・スペース統一

---

## 📊 進捗管理

### 完成度目標（2025-06-28更新）
- [x] データ抽出: 95% → **99%** ✅
- [x] AI推奨: 90% → **98%** ✅
- [x] 機械学習: 95% → **99%** ✅
- [x] レース分析: 85% → **95%** ✅
- [x] 買い目推奨: 90% → **98%** ✅
- [x] UI/UX: 92% → **98%** ✅

### マイルストーン
- [x] v1.1: AI API統合完了 ✅ **達成**
- [ ] v1.2: ペース分析機能追加
- [ ] v1.3: 複雑馬券対応
- [ ] v1.4: モバイル最適化完了
- [ ] v2.0: 血統分析統合

---

## 📝 メモ

### 重要な注意事項
- 血統機能は `feature/pedigree-extraction` ブランチに完成版保存済み
- 現在は `feature/error-handling-clean` ブランチで開発継続
- 既存の学習データ互換性を必ず保持
- パフォーマンスへの影響を常に監視

### 最新の完了事項（2025-06-28）
- ✅ AI API統合完全実装
- ✅ エラーハンドリング強化（ErrorHandlingSystem）
- ✅ データ検証機能追加（型安全性向上）
- ✅ 予測エンジン確率正規化
- ✅ 学習システム脚質・レースレベル対応

### 参考リンク
- [開発ロードマップ詳細](./DEVELOPMENT_ROADMAP.md)
- [プロジェクト設定](./CLAUDE.md)
- [エラーハンドリング作業計画](./WORK_PLAN.md)

**最終更新**: 2025-06-28