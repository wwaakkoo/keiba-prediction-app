# 期待値ベース買い目システム開発計画

## 📋 プロジェクト概要

**目的**: 高精度な複勝予想（81.8%）を活用しながら、トリガミ問題を解決する期待値ベースの買い目システムを構築

**現在の問題点**:
- 複勝予想的中率81.8%だが、総回収率11.8%（-5,280円）
- 人気馬偏重（低配当）により資金効率が悪い
- 3連複BOXやワイドの的中率6.1%と低迷

## 🎯 開発戦略

### 期待値ベースアプローチ
```
期待値 = 的中確率 × オッズ
期待値 ≥ 1.3 → 買い推奨
期待値 < 1.0 → 見送り
```

### 人気層×スコア組み合わせルール
- **人気馬（1-3番人気）**: スコア90%以上でないと買わない
- **中人気（4-6番人気）**: スコア70%以上を推奨（メインターゲット）
- **穴馬（7番人気以下）**: スコア50%以上で補助的に活用

## 🔧 実装フェーズ

### Phase 1: 期待値計算システム（最重要）
- [ ] スコア→的中確率変換機能
- [ ] 期待値計算エンジン
- [ ] 馬券種別期待値評価
- [ ] 過去データによるキャリブレーション

### Phase 2: 買い目フィルタリング（効果大）
- [ ] 人気層×スコアフィルター
- [ ] 期待値閾値フィルター
- [ ] 馬券種別適性判定
- [ ] 買い目候補生成

### Phase 3: 見送り判定ロジック（収益改善）
- [ ] レース全体の期待値評価
- [ ] 見送り条件設定
- [ ] 投資効率判定
- [ ] 資金管理統合

### Phase 4: 動的買い方変更（最適化）
- [ ] 複勝1点/2点動的切り替え
- [ ] ワイド組み合わせ最適化
- [ ] 投資額動的調整
- [ ] パフォーマンス追跡

## 📊 成功指標

### 目標KPI
- **的中率**: 30%以上（現状6.1%から大幅改善）
- **回収率**: 110%以上（現状11.8%から大幅改善）
- **見送り率**: 30-50%（優良レースの選別）
- **期待値精度**: 実績期待値との誤差±10%以内

### 測定項目
- 人気層別成績
- 期待値レンジ別成績
- 馬券種別効率
- 月間収支推移

## 🎨 設計思想

### 「精度×妙味」のバランス
- 高精度な複勝予想を基盤に
- 配当効率を重視したフィルタリング
- データドリブンな意思決定

### 「見送り」の概念
- 毎レース買わない勇気
- 優良機会への資金集中
- 長期的な資金効率向上

### 動的な戦略変更
- レース構造に応じた柔軟な対応
- 固定的な買い方からの脱却
- 継続的な学習と改善

## 🔬 検証計画

### 過去データ検証
- 11レース実績データでの検証
- 期待値計算の精度確認
- フィルタリング効果の測定

### 実運用テスト
- 少額での実運用テスト
- パフォーマンス追跡
- 戦略の段階的改善

## 📈 期待効果

### 短期効果（1-2ヶ月）
- トリガミ問題の解決
- 見送り機能による損失抑制
- 買い目精度の向上

### 中長期効果（3-6ヶ月）
- 期待値精度の向上
- 季節・コース別最適化
- 安定した収益基盤の構築

## 💻 技術仕様

### 主要コンポーネント
- `ExpectedValueCalculator`: 期待値計算エンジン
- `BettingFilter`: 買い目フィルタリング
- `RaceEvaluator`: レース評価・見送り判定
- `DynamicBettingStrategy`: 動的買い方変更

### データ構造
```javascript
{
  horse: {
    number: 1,
    score: 75.5,
    odds: 4.2,
    popularity: 5,
    expectedValue: 1.26,
    probability: 0.3,
    recommendation: 'buy'
  },
  race: {
    totalExpectedValue: 1.15,
    recommendation: 'participate',
    strategy: 'place_2_horses',
    budget: 500
  }
}
```

---

**開発開始日**: 2024年1月
**開発チーム**: Claude Code
**目標完成日**: Phase 1-2 完了を優先